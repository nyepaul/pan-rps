<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Retirement Planning System</title>

    <!-- Password Manager Site Identification -->
    <meta name="application-name" content="Retirement Planning System - rps.pan2.app">
    <meta property="og:site_name" content="rps.pan2.app">
    <link rel="canonical" href="https://rps.pan2.app/login">

    <link rel="stylesheet" href="/css/login.css">
</head>
<body>
    <div class="login-container" style="position: relative;">
        <div class="version-badge">...</div>
        <h1 style="margin-bottom: 30px;">Welcome Back</h1>
        
        <div id="message"></div>
        
        <!-- Login Form -->
        <form id="loginForm" action="https://rps.pan2.app/api/auth/login" method="post">
            <input type="hidden" name="site" value="rps.pan2.app">
            <div class="form-group">
                <label for="loginUsername">Username</label>
                <input type="text" id="loginUsername" name="username" required autocomplete="username">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" name="password" required autocomplete="current-password">
            </div>
            <div style="text-align: right; margin-bottom: 15px;">
                <a href="/account-recovery" style="color: #3b82f6; text-decoration: none; font-size: 14px;">Forgot Password?</a>
            </div>
            <button type="submit" id="loginBtn">Login</button>
            <div class="login-spinner" id="loginSpinner">
                <div class="spinner"></div>
                <span class="spinner-text">Validating credentials...</span>
            </div>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="hidden" action="https://rps.pan2.app/api/auth/register" method="post">
            <input type="hidden" name="site" value="rps.pan2.app">
            <div class="form-group">
                <label for="registerUsername">Username</label>
                <input type="text" id="registerUsername" name="username" required autocomplete="username">
                <small>3-50 characters, letters, numbers, hyphens, underscores only</small>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" name="email" required autocomplete="email">
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" name="password" required autocomplete="new-password">
                <small>Min 8 characters, with uppercase, lowercase, and number</small>
            </div>
            <button type="submit" id="registerBtn">Register</button>
            <div class="login-spinner" id="registerSpinner">
                <div class="spinner"></div>
                <span class="spinner-text">Creating account...</span>
            </div>
        </form>

        <!-- Password Reset Request Form -->
        <form id="resetRequestForm" class="hidden">
            <div class="form-group">
                <label for="resetUsername">Username</label>
                <input type="text" id="resetUsername" required autocomplete="username">
            </div>
            <div class="form-group">
                <label for="resetEmail">Email Address</label>
                <input type="email" id="resetEmail" required autocomplete="email">
                <small>Enter the email address associated with your account</small>
            </div>
            <button type="submit" id="resetRequestBtn">Send Reset Link</button>
        </form>

        <!-- Password Reset Form -->
        <form id="resetPasswordForm" class="hidden">
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" required autocomplete="new-password">
                <small>Min 8 characters, with uppercase, lowercase, and number</small>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm New Password</label>
                <input type="password" id="confirmPassword" required autocomplete="new-password">
            </div>
            <button type="submit" id="resetPasswordBtn">Reset Password</button>
        </form>

        <!-- Resend Verification Form -->
        <form id="resendVerificationForm" class="hidden">
            <div class="form-group">
                <label for="resendEmail">Email Address</label>
                <input type="email" id="resendEmail" required autocomplete="email">
                <small>Enter the email address used during registration</small>
            </div>
            <button type="submit" id="resendBtn">Send Verification Link</button>
        </form>

        <div class="toggle-form">
            <div id="registrationToggle">
                <span id="toggleText">Don't have an account? </span>
                <a href="#" id="toggleLink">Register</a>
            </div>
            <div id="resendLinkContainer">
                <a href="#" id="resendToggle">Resend Verification?</a>
            </div>
            <div id="backToLoginLink" class="hidden">
                <a href="#" id="backToLogin">Back to Login</a>
            </div>
        </div>
    </div>

    <!-- Recovery Code Modal -->
    <div id="recoveryModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 10000; padding: 20px;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 500px; width: 100%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <h2 style="color: #1e40af; margin-bottom: 20px;">üîê Your Recovery Code</h2>
            <p style="color: #374151; margin-bottom: 15px; line-height: 1.5;">
                This is your master recovery code. Because your data is <strong>end-to-end encrypted</strong>, if you forget your password, this code is the <strong>ONLY</strong> way to regain access to your account and preserve your data.
            </p>
            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px;">
                <span id="recoveryCodeText" style="font-family: monospace; font-size: 24px; font-weight: bold; letter-spacing: 2px; color: #2563eb;">XXXX-XXXX-XXXX-XXXX</span>
            </div>
            <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin-bottom: 25px;">
                <p style="color: #92400e; font-size: 14px; font-weight: 600;">
                    ‚ö†Ô∏è Warning: Store this code in a safe place (like a password manager). It will not be shown again.
                </p>
            </div>
            <button id="closeRecoveryModal" style="background: #2563eb; color: white; border: none; padding: 12px; border-radius: 6px; width: 100%; font-weight: bold; cursor: pointer;">
                I have saved my recovery code
            </button>
        </div>
    </div>
    
    <script src="/js/login.js"></script>
</body>
</html>