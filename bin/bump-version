#!/bin/bash
# Bump version number in centralized config and cache-busting

if [ $# -eq 0 ]; then
    echo "Usage: ./bin/bump-version <new_version> [release_notes]"
    echo "Example: ./bin/bump-version 3.10.0 'Add new feature X'"
    exit 1
fi

NEW_VERSION=$1
RELEASE_NOTES=${2:-"Bug fixes and improvements"}
RELEASE_DATE=$(date +%Y-%m-%d)

# Update centralized version.json
cat > src/static/version.json <<EOF
{
    "version": "$NEW_VERSION",
    "release_date": "$RELEASE_DATE",
    "release_notes": "$RELEASE_NOTES"
}
EOF

# Update index.html cache-busting parameter (keep this build-time update)
sed -i "s|/js/main.js?v=.*\"|/js/main.js?v=$NEW_VERSION\"|g" src/static/index.html

echo "âœ… Version bumped to $NEW_VERSION"
echo "ðŸ“… Release date: $RELEASE_DATE"
echo "ðŸ“ Notes: $RELEASE_NOTES"
echo ""
echo "Modified files:"
echo "  - src/static/version.json"
echo "  - src/static/index.html (cache busting)"
echo ""
echo "Don't forget to commit and deploy:"
echo "  git add src/static/version.json src/static/index.html"
echo "  git commit -m 'chore: bump version to $NEW_VERSION'"
echo "  git push"
echo "  sudo ./bin/deploy"