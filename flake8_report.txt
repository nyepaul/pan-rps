src/__version__.py:8:80: E501 line too long (85 > 79 characters)
    _version_file = os.path.join(os.path.dirname(__file__), "static", "version.json")
                                                                               ^
src/app.py:37:80: E501 line too long (83 > 79 characters)
    """Generate human-readable description for network access based on endpoint."""
                                                                               ^
src/app.py:122:13: W503 line break before binary operator
            or request.path.startswith("/js/")
            ^
src/app.py:123:13: W503 line break before binary operator
            or request.path.startswith("/images/")
            ^
src/app.py:124:13: W503 line break before binary operator
            or request.path.endswith(".ico")
            ^
src/app.py:155:80: E501 line too long (81 > 79 characters)
                                        inactive_duration.total_seconds() / 60, 1
                                                                               ^
src/app.py:183:80: E501 line too long (87 > 79 characters)
        """Log all network access to the application, even without user interaction."""
                                                                               ^
src/app.py:187:13: W503 line break before binary operator
            or request.path.startswith("/js/")
            ^
src/app.py:188:13: W503 line break before binary operator
            or request.path.startswith("/images/")
            ^
src/app.py:189:13: W503 line break before binary operator
            or request.path.startswith("/fonts/")
            ^
src/app.py:190:13: W503 line break before binary operator
            or request.path.endswith(".ico")
            ^
src/app.py:191:13: W503 line break before binary operator
            or request.path.endswith(".png")
            ^
src/app.py:192:13: W503 line break before binary operator
            or request.path.endswith(".jpg")
            ^
src/app.py:193:13: W503 line break before binary operator
            or request.path.endswith(".svg")
            ^
src/app.py:194:13: W503 line break before binary operator
            or request.path.endswith(".woff")
            ^
src/app.py:195:13: W503 line break before binary operator
            or request.path.endswith(".woff2")
            ^
src/app.py:215:80: E501 line too long (86 > 79 characters)
            details={"endpoint": path, "method": method, "_description": description},
                                                                               ^
src/app.py:250:80: E501 line too long (85 > 79 characters)
                "%(asctime)s %(levelname)s: %(message)s [in %(pathname)s:%(lineno)d]"
                                                                               ^
src/app.py:308:80: E501 line too long (108 > 79 characters)
            "style-src 'self' 'unsafe-inline' https://unpkg.com",  # unsafe-inline kept for style attributes
                                                                               ^
src/app.py:309:80: E501 line too long (100 > 79 characters)
            "img-src 'self' data: https://*.tile.openstreetmap.org https://*.basemaps.cartocdn.com",
                                                                               ^
src/app.py:311:80: E501 line too long (98 > 79 characters)
            "connect-src 'self' https://*.tile.openstreetmap.org https://*.basemaps.cartocdn.com",
                                                                               ^
src/auth/admin_required.py:39:80: E501 line too long (87 > 79 characters)
                details={"reason": "Not admin", "attempted_endpoint": str(f.__name__)},
                                                                               ^
src/auth/models.py:87:80: E501 line too long (88 > 79 characters)
        return bcrypt.hashpw(password.encode("utf-8"), bcrypt.gensalt()).decode("utf-8")
                                                                               ^
src/auth/models.py:106:80: E501 line too long (83 > 79 characters)
        row = db.execute_one("SELECT * FROM users WHERE username = ?", (username,))
                                                                               ^
src/auth/models.py:132:80: E501 line too long (88 > 79 characters)
        token = jwt.encode(payload, current_app.config["SECRET_KEY"], algorithm="HS256")
                                                                               ^
src/auth/models.py:169:80: E501 line too long (131 > 79 characters)
                    """
                    INSERT INTO users (username, email, password_hash, is_active, is_admin, is_super_admin, created_at, updated_at, 
                                     encrypted_dek, dek_iv, recovery_encrypted_dek, recovery_iv, recovery_salt,
                                     email_encrypted_dek, email_iv, email_salt, preferences, email_verified)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/auth/models.py:169:132: W291 trailing whitespace
                    """
                    INSERT INTO users (username, email, password_hash, is_active, is_admin, is_super_admin, created_at, updated_at, 
                                     encrypted_dek, dek_iv, recovery_encrypted_dek, recovery_iv, recovery_salt,
                                     email_encrypted_dek, email_iv, email_salt, preferences, email_verified)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                                                                           ^
src/auth/models.py:170:80: E501 line too long (111 > 79 characters)
                    """
                    INSERT INTO users (username, email, password_hash, is_active, is_admin, is_super_admin, created_at, updated_at, 
                                     encrypted_dek, dek_iv, recovery_encrypted_dek, recovery_iv, recovery_salt,
                                     email_encrypted_dek, email_iv, email_salt, preferences, email_verified)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/auth/models.py:171:80: E501 line too long (108 > 79 characters)
                    """
                    INSERT INTO users (username, email, password_hash, is_active, is_admin, is_super_admin, created_at, updated_at, 
                                     encrypted_dek, dek_iv, recovery_encrypted_dek, recovery_iv, recovery_salt,
                                     email_encrypted_dek, email_iv, email_salt, preferences, email_verified)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/auth/models.py:172:80: E501 line too long (81 > 79 characters)
                    """
                    INSERT INTO users (username, email, password_hash, is_active, is_admin, is_super_admin, created_at, updated_at, 
                                     encrypted_dek, dek_iv, recovery_encrypted_dek, recovery_iv, recovery_salt,
                                     email_encrypted_dek, email_iv, email_salt, preferences, email_verified)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/auth/models.py:201:80: E501 line too long (82 > 79 characters)
                    """
                    UPDATE users
                    SET username = ?, email = ?, password_hash = ?, is_active = ?,
                        is_admin = ?, is_super_admin = ?, last_login = ?, encrypted_dek = ?, dek_iv = ?,
                        recovery_encrypted_dek = ?, recovery_iv = ?, recovery_salt = ?,
                        email_encrypted_dek = ?, email_iv = ?, email_salt = ?, preferences = ?,
                        email_verified = ?
                    WHERE id = ?
                """,
                       
                                
                      ^
src/auth/models.py:202:80: E501 line too long (104 > 79 characters)
                    """
                    UPDATE users
                    SET username = ?, email = ?, password_hash = ?, is_active = ?,
                        is_admin = ?, is_super_admin = ?, last_login = ?, encrypted_dek = ?, dek_iv = ?,
                        recovery_encrypted_dek = ?, recovery_iv = ?, recovery_salt = ?,
                        email_encrypted_dek = ?, email_iv = ?, email_salt = ?, preferences = ?,
                        email_verified = ?
                    WHERE id = ?
                """,
                       
                                
                      ^
src/auth/models.py:203:80: E501 line too long (87 > 79 characters)
                    """
                    UPDATE users
                    SET username = ?, email = ?, password_hash = ?, is_active = ?,
                        is_admin = ?, is_super_admin = ?, last_login = ?, encrypted_dek = ?, dek_iv = ?,
                        recovery_encrypted_dek = ?, recovery_iv = ?, recovery_salt = ?,
                        email_encrypted_dek = ?, email_iv = ?, email_salt = ?, preferences = ?,
                        email_verified = ?
                    WHERE id = ?
                """,
                       
                                
                      ^
src/auth/models.py:204:80: E501 line too long (95 > 79 characters)
                    """
                    UPDATE users
                    SET username = ?, email = ?, password_hash = ?, is_active = ?,
                        is_admin = ?, is_super_admin = ?, last_login = ?, encrypted_dek = ?, dek_iv = ?,
                        recovery_encrypted_dek = ?, recovery_iv = ?, recovery_salt = ?,
                        email_encrypted_dek = ?, email_iv = ?, email_salt = ?, preferences = ?,
                        email_verified = ?
                    WHERE id = ?
                """,
                       
                                
                      ^
src/auth/models.py:276:80: E501 line too long (93 > 79 characters)
        """Get decrypted DEK using password, handling legacy salt and iteration migration."""
                                                                               ^
src/auth/models.py:311:80: E501 line too long (82 > 79 characters)
                        # Re-encrypt with new salt AND 600k iterations immediately
                                                                               ^
src/auth/models.py:322:45: W291 trailing whitespace
                                """
                                UPDATE users 
                                SET encrypted_dek = ?, dek_iv = ? 
                                WHERE id = ?
                            """,
                                   
        ^
src/auth/models.py:323:66: W291 trailing whitespace
                                """
                                UPDATE users 
                                SET encrypted_dek = ?, dek_iv = ? 
                                WHERE id = ?
                            """,
                                   
                             ^
src/auth/models.py:333:80: E501 line too long (105 > 79 characters)
                            f"Migrated user {self.username} to new encryption config (salt + iterations)"
                                                                               ^
src/auth/models.py:340:80: E501 line too long (83 > 79 characters)
        raise ValueError("Failed to decrypt encryption key with provided password")
                                                                               ^
src/auth/models.py:347:80: E501 line too long (83 > 79 characters)
        """Update the user's password and re-encrypt DEK.

        Args:
            new_password: The new password to set
            old_password: The current password (required if user has encrypted DEK)

        Raises:
            ValueError: If old_password is required but not provided, or if old_password is incorrect
        """
                                                         

             
      ^
src/auth/models.py:350:80: E501 line too long (101 > 79 characters)
        """Update the user's password and re-encrypt DEK.

        Args:
            new_password: The new password to set
            old_password: The current password (required if user has encrypted DEK)

        Raises:
            ValueError: If old_password is required but not provided, or if old_password is incorrect
        """
                                                         

             
      ^
src/auth/models.py:377:80: E501 line too long (82 > 79 characters)
                # Encrypt the base64 string of the DEK (to match existing pattern)
                                                                               ^
src/auth/models.py:389:80: E501 line too long (87 > 79 characters)
                raise ValueError(f"Failed to re-encrypt data encryption key: {str(e)}")
                                                                               ^
src/auth/models.py:456:80: E501 line too long (88 > 79 characters)
        token = jwt.encode(payload, current_app.config["SECRET_KEY"], algorithm="HS256")
                                                                               ^
src/auth/models.py:459:80: E501 line too long (87 > 79 characters)
        # For now, we store the full token to maintain compatibility with existing flow
                                                                               ^
src/auth/models.py:494:80: E501 line too long (96 > 79 characters)
        # If the token in DB doesn't match, it means a new one was requested or password changed
                                                                               ^
src/auth/models.py:530:80: E501 line too long (83 > 79 characters)
        row = db.execute_one("SELECT * FROM users WHERE reset_token = ?", (token,))
                                                                               ^
src/auth/models.py:615:80: E501 line too long (86 > 79 characters)
                "INSERT OR IGNORE INTO user_groups (user_id, group_id) VALUES (?, ?)",
                                                                               ^
src/auth/models.py:631:80: E501 line too long (87 > 79 characters)
                "INSERT OR IGNORE INTO admin_groups (user_id, group_id) VALUES (?, ?)",
                                                                               ^
src/auth/models.py:663:80: E501 line too long (80 > 79 characters)
            "SELECT email FROM users WHERE is_super_admin = 1 AND is_active = 1"
                                                                               ^
src/auth/models.py:699:80: E501 line too long (80 > 79 characters)
        chars = string.ascii_uppercase + string.digits.replace("0", "").replace(
                                                                               ^
src/auth/models.py:714:80: E501 line too long (120 > 79 characters)
                """
                INSERT INTO password_reset_requests (user_id, status, request_ip, created_at, support_token, expires_at)
                VALUES (?, 'pending', ?, ?, ?, ?)
            """,
                   
                                                           ^
src/auth/models.py:733:48: W291 trailing whitespace
            cursor = conn.execute("""
                SELECT r.*, u.username, u.email 
                FROM password_reset_requests r
                JOIN users u ON r.user_id = u.id
                WHERE r.status = 'pending'
                ORDER BY r.created_at DESC
            """)
                                     
         ^
src/auth/models.py:757:47: W291 trailing whitespace
                """
                UPDATE password_reset_requests 
                SET status = ?, processed_at = ?, processed_by = ?
                WHERE id = ?
            """,
                   
                          ^
src/auth/routes.py:15:1: F401 'typing.Any' imported but unused
from typing import Any
^
src/auth/routes.py:41:80: E501 line too long (82 > 79 characters)
            username.replace("\\", "\\\\").replace("%", "\\%").replace("_", "\\_")
                                                                               ^
src/auth/routes.py:57:80: E501 line too long (84 > 79 characters)
                    row["last_attempt"].replace("Z", "+00:00").replace("+00:00", "")
                                                                               ^
src/auth/routes.py:59:80: E501 line too long (88 > 79 characters)
                unlock_time = last_attempt + timedelta(minutes=LOCKOUT_DURATION_MINUTES)
                                                                               ^
src/auth/routes.py:60:80: E501 line too long (82 > 79 characters)
                remaining = (unlock_time - datetime.utcnow()).total_seconds() / 60
                                                                               ^
src/auth/routes.py:83:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one uppercase letter")
                                                                               ^
src/auth/routes.py:85:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one lowercase letter")
                                                                               ^
src/auth/routes.py:104:80: E501 line too long (86 > 79 characters)
                "Username can only contain letters, numbers, hyphens, and underscores"
                                                                               ^
src/auth/routes.py:113:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one uppercase letter")
                                                                               ^
src/auth/routes.py:115:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one lowercase letter")
                                                                               ^
src/auth/routes.py:136:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:147:80: E501 line too long (86 > 79 characters)
    # Create user object first to get the correct salt (derived from username + email)
                                                                               ^
src/auth/routes.py:181:80: E501 line too long (81 > 79 characters)
        # Generate recovery code so user can recover data if they forget password
                                                                               ^
src/auth/routes.py:184:80: E501 line too long (87 > 79 characters)
        recovery_kek = EncryptionService.get_recovery_kek(recovery_code, recovery_salt)
                                                                               ^
src/auth/routes.py:229:80: E501 line too long (94 > 79 characters)
        "message": "Registration successful. Please check your email to verify your account.",
                                                                               ^
src/auth/routes.py:237:80: E501 line too long (142 > 79 characters)
            "SAVE THIS CODE SECURELY. It is the ONLY way to recover your data if you forget your password. This code will not be shown again."
                                                                               ^
src/auth/routes.py:252:80: E501 line too long (82 > 79 characters)
        # We need to decode the token to find the user first to call confirm_email
                                                                               ^
src/auth/routes.py:279:80: E501 line too long (83 > 79 characters)
                    {"message": "Email verified successfully. You can now log in."}
                                                                               ^
src/auth/routes.py:286:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:298:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:308:80: E501 line too long (83 > 79 characters)
                {"username": data.username, "remaining_minutes": remaining_minutes}
                                                                               ^
src/auth/routes.py:315:80: E501 line too long (133 > 79 characters)
                    "error": f"Account temporarily locked due to too many failed attempts. Try again in {remaining_minutes} minutes."
                                                                               ^
src/auth/routes.py:354:80: E501 line too long (80 > 79 characters)
    # Check email verification (Legacy users might have NULL, treat as verified)
                                                                               ^
src/auth/routes.py:359:80: E501 line too long (86 > 79 characters)
        return jsonify({"error": "Email not verified. Please check your inbox."}), 403
                                                                               ^
src/auth/routes.py:368:80: E501 line too long (85 > 79 characters)
            # CRITICAL: If we can't decrypt the DEK, we can't let the user in because
                                                                               ^
src/auth/routes.py:369:80: E501 line too long (85 > 79 characters)
            # all their data will be inaccessible and new data will be unencryptable.
                                                                               ^
src/auth/routes.py:370:80: E501 line too long (95 > 79 characters)
            # However, for users who migrated from NO individual key, we might need a fallback.
                                                                               ^
src/auth/routes.py:371:80: E501 line too long (83 > 79 characters)
            # But here user.encrypted_dek is NOT NULL, so they definitely have one.
                                                                               ^
src/auth/routes.py:376:80: E501 line too long (81 > 79 characters)
                details=json.dumps({"username": user.username, "error": str(e)}),
                                                                               ^
src/auth/routes.py:383:80: E501 line too long (91 > 79 characters)
                        "error": "Login failed. Please try again or use password recovery."
                                                                               ^
src/auth/routes.py:406:80: E501 line too long (85 > 79 characters)
            print(f"Auto-migrated user {user.username} to individual encryption key")
                                                                               ^
src/auth/routes.py:441:80: E501 line too long (80 > 79 characters)
                        json.loads(user.preferences) if user.preferences else {}
                                                                               ^
src/auth/routes.py:456:80: E501 line too long (84 > 79 characters)
    username = current_user.username if current_user.is_authenticated else "Unknown"
                                                                               ^
src/auth/routes.py:482:80: E501 line too long (81 > 79 characters)
    # DON'T manually clear cookies - let Flask handle session cookie regeneration
                                                                               ^
src/auth/routes.py:520:80: E501 line too long (84 > 79 characters)
    prefs = json.loads(current_user.preferences) if current_user.preferences else {}
                                                                               ^
src/auth/routes.py:535:80: E501 line too long (84 > 79 characters)
            json.loads(current_user.preferences) if current_user.preferences else {}
                                                                               ^
src/auth/routes.py:542:80: E501 line too long (88 > 79 characters)
        return jsonify({"message": "Preferences updated", "preferences": existing}), 200
                                                                               ^
src/auth/routes.py:565:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one uppercase letter")
                                                                               ^
src/auth/routes.py:567:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one lowercase letter")
                                                                               ^
src/auth/routes.py:578:80: E501 line too long (92 > 79 characters)
    """Request a password reset token.

    Requires username AND email for verification. The token is sent to the registered email.
    """
                                      

                                       ^
src/auth/routes.py:584:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:591:80: E501 line too long (128 > 79 characters)
    # Use constant time comparison for email to prevent timing attacks (though not strictly necessary for this low-stakes check)
                                                                               ^
src/auth/routes.py:601:80: E501 line too long (115 > 79 characters)
                    "message": "If the account exists and the email matches, a password reset link has been sent.",
                                                                               ^
src/auth/routes.py:614:80: E501 line too long (83 > 79 characters)
                    "error": "Email not verified. Please verify your email first.",
                                                                               ^
src/auth/routes.py:637:80: E501 line too long (89 > 79 characters)
            f"SECURITY WARNING: Email not sent. Reset token for {user.username}: {token}"
                                                                               ^
src/auth/routes.py:642:80: E501 line too long (103 > 79 characters)
        "message": "If the account exists and the email matches, a password reset link has been sent.",
                                                                               ^
src/auth/routes.py:652:9: W503 line break before binary operator
        or current_app.config.get("FLASK_ENV") == "development"
        ^
src/auth/routes.py:672:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:690:80: E501 line too long (84 > 79 characters)
            dek_b64 = email_service.decrypt(user.email_encrypted_dek, user.email_iv)
                                                                               ^
src/auth/routes.py:743:80: E501 line too long (82 > 79 characters)
            "Password reset successfully. Your encrypted data has been recovered."
                                                                               ^
src/auth/routes.py:749:80: E501 line too long (81 > 79 characters)
                " Note: Encrypted data was lost because no backup was available."
                                                                               ^
src/auth/routes.py:785:80: E501 line too long (80 > 79 characters)
                warning = "Your encrypted data will be automatically recovered."
                                                                               ^
src/auth/routes.py:787:80: E501 line too long (118 > 79 characters)
                warning = "Resetting password will permanently delete all your encrypted data. This cannot be undone!"
                                                                               ^
src/auth/routes.py:803:80: E501 line too long (82 > 79 characters)
        return jsonify({"valid": False, "error": "Invalid or expired token"}), 400
                                                                               ^
src/auth/routes.py:819:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one uppercase letter")
                                                                               ^
src/auth/routes.py:821:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one lowercase letter")
                                                                               ^
src/auth/routes.py:838:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one uppercase letter")
                                                                               ^
src/auth/routes.py:840:80: E501 line too long (83 > 79 characters)
            raise ValueError("Password must contain at least one lowercase letter")
                                                                               ^
src/auth/routes.py:853:80: E501 line too long (103 > 79 characters)
    """
    Change password without login session.

    Methods:
    1. Email-based Recovery (Preferred): Uses backup key derived from email. Requires Username + Email.
    2. Legacy Recovery: Uses old password to decrypt key. Requires Username + Email + Old Password.
    """
       
                                          

            
              ^
src/auth/routes.py:854:80: E501 line too long (99 > 79 characters)
    """
    Change password without login session.

    Methods:
    1. Email-based Recovery (Preferred): Uses backup key derived from email. Requires Username + Email.
    2. Legacy Recovery: Uses old password to decrypt key. Requires Username + Email + Old Password.
    """
       
                                          

            
              ^
src/auth/routes.py:860:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:888:80: E501 line too long (83 > 79 characters)
                email_kek = EncryptionService.get_email_kek(user.email, email_salt)
                                                                               ^
src/auth/routes.py:890:80: E501 line too long (88 > 79 characters)
                dek_b64 = email_service.decrypt(user.email_encrypted_dek, user.email_iv)
                                                                               ^
src/auth/routes.py:938:80: E501 line too long (85 > 79 characters)
                    {"message": "Password changed successfully. You can now log in."}
                                                                               ^
src/auth/routes.py:951:80: E501 line too long (88 > 79 characters)
    """Change password for logged-in user (requires old password to re-encrypt data)."""
                                                                               ^
src/auth/routes.py:960:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:975:80: E501 line too long (80 > 79 characters)
                kek = EncryptionService.get_kek_from_password(data.new_password)
                                                                               ^
src/auth/routes.py:1040:80: E501 line too long (95 > 79 characters)
    # This helps users fix a "broken session" without logging out if we add password to request
                                                                               ^
src/auth/routes.py:1052:80: E501 line too long (83 > 79 characters)
        # If we can't get DEK, we can't generate a recovery code that recovers data
                                                                               ^
src/auth/routes.py:1058:80: E501 line too long (113 > 79 characters)
                    "message": "Please re-enter your password to unlock your keys and generate a recovery code.",
                                                                               ^
src/auth/routes.py:1077:80: E501 line too long (87 > 79 characters)
        recovery_kek = EncryptionService.get_recovery_kek(recovery_code, recovery_salt)
                                                                               ^
src/auth/routes.py:1081:80: E501 line too long (90 > 79 characters)
        # Ensure we are encrypting the base64 string of the DEK to match standard patterns
                                                                               ^
src/auth/routes.py:1106:80: E501 line too long (127 > 79 characters)
                    "warning": "SAVE THIS CODE SECURELY. It is the ONLY way to recover your data if you forget your password.",
                                                                               ^
src/auth/routes.py:1114:80: E501 line too long (85 > 79 characters)
        return jsonify({"error": f"Failed to generate recovery code: {str(e)}"}), 500
                                                                               ^
src/auth/routes.py:1125:5: F841 local variable 'e' is assigned to but never used
    except Exception as e:
    ^
src/auth/routes.py:1135:9: W503 line break before binary operator
        or not user.recovery_iv
        ^
src/auth/routes.py:1136:9: W503 line break before binary operator
        or not user.recovery_salt
        ^
src/auth/routes.py:1141:80: E501 line too long (94 > 79 characters)
                    "error": "Recovery code not set up for this account. Cannot recover data."
                                                                               ^
src/auth/routes.py:1150:80: E501 line too long (83 > 79 characters)
        recovery_kek = EncryptionService.get_recovery_kek(data.recovery_code, salt)
                                                                               ^
src/auth/routes.py:1170:9: F841 local variable 'dek' is assigned to but never used
        dek = base64.b64decode(dek_b64)
        ^
src/auth/routes.py:1181:80: E501 line too long (90 > 79 characters)
        # Note: We keep the existing recovery code valid. User can rotate it if they want.
                                                                               ^
src/auth/routes.py:1196:80: E501 line too long (91 > 79 characters)
                    "message": "Password reset successfully. Your data has been preserved."
                                                                               ^
src/auth/routes.py:1204:80: E501 line too long (86 > 79 characters)
        return jsonify({"error": "Failed to reset password using recovery code"}), 500
                                                                               ^
src/auth/routes.py:1223:80: E501 line too long (83 > 79 characters)
                {"message": "If the account exists, a request has been submitted."}
                                                                               ^
src/auth/routes.py:1237:80: E501 line too long (85 > 79 characters)
        details=json.dumps({"type": "admin_manual", "support_token": support_token}),
                                                                               ^
src/auth/routes.py:1246:80: E501 line too long (123 > 79 characters)
                "instruction": "Please contact your administrator and provide this Support Token to verify your identity.",
                                                                               ^
src/auth/super_admin_required.py:25:13: W503 line break before binary operator
            or not current_user.is_super_admin
            ^
src/config.py:31:80: E501 line too long (86 > 79 characters)
    SECRET_KEY = os.environ.get("SECRET_KEY") or "dev-secret-key-change-in-production"
                                                                               ^
src/config.py:40:80: E501 line too long (84 > 79 characters)
    # Only disable for local development over HTTP (set SESSION_COOKIE_SECURE=false)
                                                                               ^
src/config.py:46:80: E501 line too long (90 > 79 characters)
    # Set to None to allow cookies across different hostnames (IP, domain, local hostname)
                                                                               ^
src/config.py:59:80: E501 line too long (81 > 79 characters)
    # Use Redis for rate limit storage (required for multi-worker Gunicorn setup)
                                                                               ^
src/config.py:61:80: E501 line too long (81 > 79 characters)
    RATELIMIT_STORAGE_URI = os.environ.get("REDIS_URL", "redis://localhost:6379")
                                                                               ^
src/config.py:65:80: E501 line too long (82 > 79 characters)
    ENCRYPTION_KEY = os.environ.get("ENCRYPTION_KEY")  # Must be set in production
                                                                               ^
src/database/audit_logger.py:48:80: E501 line too long (88 > 79 characters)
                user_agent = request.headers.get("User-Agent", "")[:200]  # Limit length
                                                                               ^
src/database/audit_logger.py:58:80: E501 line too long (105 > 79 characters)
                    """
                    INSERT INTO audit_log
                    (action, table_name, record_id, user_id, details, ip_address, user_agent, created_at)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                         
             ^
src/database/audit_logger.py:167:80: E501 line too long (87 > 79 characters)
        cutoff_date = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)
                                                                               ^
src/database/audit_logger.py:172:80: E501 line too long (88 > 79 characters)
                "DELETE FROM audit_log WHERE created_at < ?", (cutoff_date.isoformat(),)
                                                                               ^
src/extensions.py:40:80: E501 line too long (90 > 79 characters)
    # If not enabled, testing, debug mode, or explicitly set to memory, use memory storage
                                                                               ^
src/extensions.py:44:9: W503 line break before binary operator
        or app.config.get("RATELIMIT_STORAGE_URI") == "memory://"
        ^
src/extensions.py:45:9: W503 line break before binary operator
        or app.config.get("TESTING")
        ^
src/extensions.py:46:9: W503 line break before binary operator
        or app.config.get("DEBUG")
        ^
src/models/action_item.py:67:46: W291 trailing whitespace
                """SELECT * FROM action_items 
                   WHERE user_id = ? AND profile_id = ? 
                   ORDER BY status, priority, due_date""",
                                             ^
src/models/action_item.py:68:56: W291 trailing whitespace
                """SELECT * FROM action_items 
                   WHERE user_id = ? AND profile_id = ? 
                   ORDER BY status, priority, due_date""",
                                              
        ^
src/models/action_item.py:74:80: E501 line too long (99 > 79 characters)
                "SELECT * FROM action_items WHERE user_id = ? ORDER BY status, priority, due_date",
                                                                               ^
src/models/action_item.py:90:80: E501 line too long (86 > 79 characters)
                self.action_data, self.action_data_iv = encrypt_dict(self.action_data)
                                                                               ^
src/models/action_item.py:94:80: E501 line too long (88 > 79 characters)
                self.subtasks, self.subtasks_iv = encrypt_list(self._decrypted_subtasks)
                                                                               ^
src/models/action_item.py:102:80: E501 line too long (82 > 79 characters)
                    """
                    INSERT INTO action_items
                    (user_id, profile_id, category, description, priority, status,
                     due_date, action_data, action_data_iv, subtasks, subtasks_iv, created_at, updated_at)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                            
          ^
src/models/action_item.py:103:80: E501 line too long (106 > 79 characters)
                    """
                    INSERT INTO action_items
                    (user_id, profile_id, category, description, priority, status,
                     due_date, action_data, action_data_iv, subtasks, subtasks_iv, created_at, updated_at)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                            
          ^
src/models/action_item.py:127:80: E501 line too long (80 > 79 characters)
                    """
                    UPDATE action_items
                    SET category = ?, description = ?, priority = ?, status = ?,
                        due_date = ?, action_data = ?, action_data_iv = ?, subtasks = ?, subtasks_iv = ?, updated_at = ?
                    WHERE id = ? AND user_id = ?
                """,
                       
                                       
               ^
src/models/action_item.py:128:80: E501 line too long (120 > 79 characters)
                    """
                    UPDATE action_items
                    SET category = ?, description = ?, priority = ?, status = ?,
                        due_date = ?, action_data = ?, action_data_iv = ?, subtasks = ?, subtasks_iv = ?, updated_at = ?
                    WHERE id = ? AND user_id = ?
                """,
                       
                                       
               ^
src/models/action_item.py:185:80: E501 line too long (82 > 79 characters)
                subtasks_decrypted = decrypt_list(self.subtasks, self.subtasks_iv)
                                                                               ^
src/models/conversation.py:56:80: E501 line too long (85 > 79 characters)
            "SELECT * FROM conversations WHERE user_id = ? ORDER BY created_at DESC",
                                                                               ^
src/models/conversation.py:68:80: E501 line too long (80 > 79 characters)
                self.content, self.content_iv = encrypt(self._decrypted_content)
                                                                               ^
src/models/conversation.py:76:80: E501 line too long (106 > 79 characters)
                    """
                    INSERT INTO conversations (user_id, profile_id, role, content, content_iv, created_at)
                    VALUES (?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/models/conversation.py:97:80: E501 line too long (86 > 79 characters)
                    (self.role, self.content, self.content_iv, self.id, self.user_id),
                                                                               ^
src/models/conversation.py:115:80: E501 line too long (81 > 79 characters)
                "DELETE FROM conversations WHERE user_id = ? AND profile_id = ?",
                                                                               ^
src/models/group.py:10:80: E501 line too long (85 > 79 characters)
    def __init__(self, id, name, description=None, created_at=None, updated_at=None):
                                                                               ^
src/models/group.py:37:80: E501 line too long (105 > 79 characters)
                    "INSERT INTO groups (name, description, created_at, updated_at) VALUES (?, ?, ?, ?)",
                                                                               ^
src/models/group.py:38:80: E501 line too long (84 > 79 characters)
                    (self.name, self.description, self.created_at, self.updated_at),
                                                                               ^
src/models/group.py:44:80: E501 line too long (95 > 79 characters)
                    "UPDATE groups SET name = ?, description = ?, updated_at = ? WHERE id = ?",
                                                                               ^
src/models/group.py:73:80: E501 line too long (86 > 79 characters)
                "INSERT OR IGNORE INTO user_groups (user_id, group_id) VALUES (?, ?)",
                                                                               ^
src/models/profile.py:4:1: F401 'typing.Optional' imported but unused
from typing import Optional
^
src/models/profile.py:8:1: F401 'src.database.audit_logger.log_read' imported but unused
from src.database.audit_logger import log_create, log_update, log_delete, log_read
^
src/models/profile.py:8:80: E501 line too long (82 > 79 characters)
from src.database.audit_logger import log_create, log_update, log_delete, log_read
                                                                               ^
src/models/profile.py:67:80: E501 line too long (85 > 79 characters)
                # Decryption failed, might be plain JSON (for backward compatibility)
                                                                               ^
src/models/profile.py:90:80: E501 line too long (87 > 79 characters)
            "SELECT * FROM profile WHERE id = ? AND user_id = ?", (profile_id, user_id)
                                                                               ^
src/models/profile.py:100:80: E501 line too long (83 > 79 characters)
            "SELECT * FROM profile WHERE name = ? AND user_id = ?", (name, user_id)
                                                                               ^
src/models/profile.py:123:80: E501 line too long (88 > 79 characters)
        row = db.execute_one("SELECT username FROM users WHERE id = ?", (self.user_id,))
                                                                               ^
src/models/profile.py:144:80: E501 line too long (80 > 79 characters)
                    encrypted_data, data_iv = encrypt_dict(self._decrypted_data)
                                                                               ^
src/models/profile.py:152:80: E501 line too long (83 > 79 characters)
            # Otherwise, data is already encrypted (or plain JSON from old records)
                                                                               ^
src/models/profile.py:158:80: E501 line too long (123 > 79 characters)
                    """
                    INSERT INTO profile (user_id, name, birth_date, retirement_date, data, data_iv, created_at, updated_at)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/models/profile.py:175:80: E501 line too long (85 > 79 characters)
                    "profile", self.id, self.user_id, f"Created profile: {self.name}"
                                                                               ^
src/models/profile.py:182:80: E501 line too long (108 > 79 characters)
                    """
                    UPDATE profile
                    SET name = ?, birth_date = ?, retirement_date = ?, data = ?, data_iv = ?, updated_at = ?
                    WHERE id = ? AND user_id = ?
                """,
                       
                                  
                    ^
src/models/profile.py:198:80: E501 line too long (85 > 79 characters)
                    "profile", self.id, self.user_id, f"Updated profile: {self.name}"
                                                                               ^
src/models/profile.py:207:80: E501 line too long (81 > 79 characters)
                "profile", self.id, self.user_id, f"Deleted profile: {self.name}"
                                                                               ^
src/models/scenario.py:51:80: E501 line too long (81 > 79 characters)
            "SELECT * FROM scenarios WHERE user_id = ? ORDER BY created_at DESC",
                                                                               ^
src/models/scenario.py:67:80: E501 line too long (83 > 79 characters)
                self.parameters, self.parameters_iv = encrypt_dict(self.parameters)
                                                                               ^
src/models/scenario.py:71:80: E501 line too long (85 > 79 characters)
                self.results, self.results_iv = encrypt_dict(self._decrypted_results)
                                                                               ^
src/models/scenario.py:78:80: E501 line too long (129 > 79 characters)
                    """
                    INSERT INTO scenarios (user_id, profile_id, name, parameters, parameters_iv, results, results_iv, created_at)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?)
                """,
                       
                                                       ^
src/models/scenario.py:97:80: E501 line too long (96 > 79 characters)
                    """
                    UPDATE scenarios
                    SET name = ?, parameters = ?, parameters_iv = ?, results = ?, results_iv = ?
                    WHERE id = ? AND user_id = ?
                """,
                       
                                    
                  ^
src/models/scenario.py:127:80: E501 line too long (88 > 79 characters)
                parameters_decrypted = decrypt_dict(self.parameters, self.parameters_iv)
                                                                               ^
src/routes/action_items.py:55:80: E501 line too long (86 > 79 characters)
            raise ValueError("Status must be one of: pending, in_progress, completed")
                                                                               ^
src/routes/action_items.py:76:80: E501 line too long (80 > 79 characters)
                raise ValueError("Description must be less than 500 characters")
                                                                               ^
src/routes/action_items.py:89:80: E501 line too long (86 > 79 characters)
            raise ValueError("Status must be one of: pending, in_progress, completed")
                                                                               ^
src/routes/action_items.py:93:1: E402 module level import not at top of file
from src.services.action_item_service import ActionItemService
^
src/routes/action_items.py:129:80: E501 line too long (85 > 79 characters)
            details={"profile_name": profile_name, "items_count": len(action_items)},
                                                                               ^
src/routes/action_items.py:145:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/action_items.py:177:80: E501 line too long (85 > 79 characters)
            details={"profile_name": profile_name, "items_count": len(action_items)},
                                                                               ^
src/routes/action_items.py:180:80: E501 line too long (88 > 79 characters)
        return jsonify({"action_items": [item.to_dict() for item in action_items]}), 200
                                                                               ^
src/routes/action_items.py:183:80: E501 line too long (88 > 79 characters)
            action="LIST_ACTION_ITEMS_ERROR", details={"error": str(e)}, status_code=500
                                                                               ^
src/routes/admin.py:6:1: F401 'typing.Any' imported but unused
from typing import Optional, Dict, Any
^
src/routes/admin.py:10:80: E501 line too long (81 > 79 characters)
from src.services.enhanced_audit_logger import enhanced_audit_logger, AuditConfig
                                                                               ^
src/routes/admin.py:14:1: F401 'src.services.encryption_service.EncryptionService' imported but unused
from src.services.encryption_service import EncryptionService
^
src/routes/admin.py:15:1: F401 'base64' imported but unused
import base64
^
src/routes/admin.py:190:80: E501 line too long (85 > 79 characters)
            action="VIEW_STATISTICS", details={"days": days}, user_id=current_user.id
                                                                               ^
src/routes/admin.py:258:80: E501 line too long (88 > 79 characters)
        log = db.execute_one("SELECT * FROM enhanced_audit_log WHERE id = ?", (log_id,))
                                                                               ^
src/routes/admin.py:343:80: E501 line too long (83 > 79 characters)
            details={"format": export_format, "record_count": len(result["logs"])},
                                                                               ^
src/routes/admin.py:354:80: E501 line too long (84 > 79 characters)
                writer = csv.DictWriter(output, fieldnames=result["logs"][0].keys())
                                                                               ^
src/routes/admin.py:364:80: E501 line too long (124 > 79 characters)
                    "Content-Disposition": f'attachment; filename=audit_logs_{datetime.now().strftime("%Y%m%d_%H%M%S")}.csv'
                                                                               ^
src/routes/admin.py:434:80: E501 line too long (83 > 79 characters)
                {"message": "Configuration updated successfully", "config": config}
                                                                               ^
src/routes/admin.py:453:80: E501 line too long (120 > 79 characters)
            rows = db.execute("""
                SELECT u.id, u.username, u.email, u.is_active, u.is_admin, u.is_super_admin, u.created_at, u.last_login,
                       GROUP_CONCAT(g.name, ', ') as group_names
                FROM users u
                LEFT JOIN user_groups ug ON u.id = ug.user_id
                LEFT JOIN groups g ON ug.group_id = g.id
                GROUP BY u.id
                ORDER BY u.created_at DESC
            """)
                                 
                                             ^
src/routes/admin.py:465:80: E501 line too long (129 > 79 characters)
                """
                SELECT DISTINCT u.id, u.username, u.email, u.is_active, u.is_admin, u.is_super_admin, u.created_at, u.last_login,
                       (SELECT GROUP_CONCAT(g2.name, ', ') 
                        FROM groups g2 
                        JOIN user_groups ug2 ON g2.id = ug2.group_id 
                        WHERE ug2.user_id = u.id) as group_names
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.created_at DESC
            """,
                   
                                                           ^
src/routes/admin.py:466:59: W291 trailing whitespace
                """
                SELECT DISTINCT u.id, u.username, u.email, u.is_active, u.is_admin, u.is_super_admin, u.created_at, u.last_login,
                       (SELECT GROUP_CONCAT(g2.name, ', ') 
                        FROM groups g2 
                        JOIN user_groups ug2 ON g2.id = ug2.group_id 
                        WHERE ug2.user_id = u.id) as group_names
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.created_at DESC
            """,
                   
                                      ^
src/routes/admin.py:467:39: W291 trailing whitespace
                """
                SELECT DISTINCT u.id, u.username, u.email, u.is_active, u.is_admin, u.is_super_admin, u.created_at, u.last_login,
                       (SELECT GROUP_CONCAT(g2.name, ', ') 
                        FROM groups g2 
                        JOIN user_groups ug2 ON g2.id = ug2.group_id 
                        WHERE ug2.user_id = u.id) as group_names
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.created_at DESC
            """,
                   
                  ^
src/routes/admin.py:468:69: W291 trailing whitespace
                """
                SELECT DISTINCT u.id, u.username, u.email, u.is_active, u.is_admin, u.is_super_admin, u.created_at, u.last_login,
                       (SELECT GROUP_CONCAT(g2.name, ', ') 
                        FROM groups g2 
                        JOIN user_groups ug2 ON g2.id = ug2.group_id 
                        WHERE ug2.user_id = u.id) as group_names
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.created_at DESC
            """,
                   
                                                ^
src/routes/admin.py:483:80: E501 line too long (87 > 79 characters)
            action="LIST_USERS", details={"count": len(users)}, user_id=current_user.id
                                                                               ^
src/routes/admin.py:513:80: E501 line too long (86 > 79 characters)
                jsonify({"error": "Only super admins can manage other super admins"}),
                                                                               ^
src/routes/admin.py:518:57: E712 comparison to False should be 'if cond is False:' or 'if not cond:'
        if user_id == current_user.id and data.is_admin == False:
                                                        ^
src/routes/admin.py:567:80: E501 line too long (80 > 79 characters)
    """Reset a user's password (admin only).

     WARNING: Admin password reset cannot re-encrypt user data because the old
    password is not known. This will PERMANENTLY DELETE encrypted data for users
    with password-based encryption enabled.
    """
                                            

                                 ^
src/routes/admin.py:568:80: E501 line too long (80 > 79 characters)
    """Reset a user's password (admin only).

     WARNING: Admin password reset cannot re-encrypt user data because the old
    password is not known. This will PERMANENTLY DELETE encrypted data for users
    with password-based encryption enabled.
    """
                                            

                                 ^
src/routes/admin.py:581:9: F841 local variable 'has_encrypted_data' is assigned to but never used
        has_encrypted_data = bool(user.encrypted_dek and user.dek_iv)
        ^
src/routes/admin.py:604:80: E501 line too long (153 > 79 characters)
            message += ".  WARNING: User's encrypted data is now PERMANENTLY INACCESSIBLE because the old password was not available to re-encrypt it."
                                                                               ^
src/routes/admin.py:608:80: E501 line too long (84 > 79 characters)
                {"message": "Password reset successfully", "dek_lost": dek_was_lost}
                                                                               ^
src/routes/admin.py:649:80: E501 line too long (83 > 79 characters)
            action="CREATE_GROUP", details=group.to_dict(), user_id=current_user.id
                                                                               ^
src/routes/admin.py:654:80: E501 line too long (83 > 79 characters)
                {"message": "Group created successfully", "group": group.to_dict()}
                                                                               ^
src/routes/admin.py:676:80: E501 line too long (81 > 79 characters)
                return jsonify({"error": "Unauthorized to view this group"}), 403
                                                                               ^
src/routes/admin.py:713:80: E501 line too long (83 > 79 characters)
            action="UPDATE_GROUP", details=group.to_dict(), user_id=current_user.id
                                                                               ^
src/routes/admin.py:718:80: E501 line too long (83 > 79 characters)
                {"message": "Group updated successfully", "group": group.to_dict()}
                                                                               ^
src/routes/admin.py:749:80: E501 line too long (81 > 79 characters)
@admin_bp.route("/groups/<int:group_id>/members/<int:user_id>", methods=["POST"])
                                                                               ^
src/routes/admin.py:780:80: E501 line too long (83 > 79 characters)
@admin_bp.route("/groups/<int:group_id>/members/<int:user_id>", methods=["DELETE"])
                                                                               ^
src/routes/admin.py:803:80: E501 line too long (87 > 79 characters)
@admin_bp.route("/users/<int:user_id>/managed-groups/<int:group_id>", methods=["POST"])
                                                                               ^
src/routes/admin.py:901:80: E501 line too long (90 > 79 characters)
    """
    Grant or revoke super admin status (super admin only).

    Only super admins can grant/revoke super admin privileges.
    When granting super admin status, the user is automatically promoted to admin as well.
    Super admins can view feedback content and manage other super admins.

    Request body:
        is_super_admin: boolean
    """
       
                                                          

           ^
src/routes/admin.py:923:80: E501 line too long (87 > 79 characters)
            return jsonify({"error": "Cannot revoke your own super admin status"}), 400
                                                                               ^
src/routes/admin.py:932:80: E501 line too long (85 > 79 characters)
                    "UPDATE users SET is_super_admin = ?, is_admin = ? WHERE id = ?",
                                                                               ^
src/routes/admin.py:938:80: E501 line too long (84 > 79 characters)
                    "UPDATE users SET is_super_admin = ? WHERE id = ?", (0, user_id)
                                                                               ^
src/routes/admin.py:957:80: E501 line too long (107 > 79 characters)
                    "message": f"User {'granted' if is_super_admin else 'revoked'} super admin privileges",
                                                                               ^
src/routes/admin.py:986:80: E501 line too long (80 > 79 characters)
            details={"target_user_id": user_id, "profile_count": len(profiles)},
                                                                               ^
src/routes/admin.py:1024:80: E501 line too long (81 > 79 characters)
            "SELECT COUNT(*) as count FROM profile WHERE user_id = ?", (user_id,)
                                                                               ^
src/routes/admin.py:1030:80: E501 line too long (98 > 79 characters)
            "SELECT id, name, created_at FROM profile WHERE user_id = ? ORDER BY created_at DESC",
                                                                               ^
src/routes/admin.py:1037:80: E501 line too long (83 > 79 characters)
            "SELECT COUNT(*) as count FROM scenarios WHERE user_id = ?", (user_id,)
                                                                               ^
src/routes/admin.py:1043:80: E501 line too long (109 > 79 characters)
            "SELECT id, name, created_at FROM scenarios WHERE user_id = ? ORDER BY created_at DESC LIMIT 10",
                                                                               ^
src/routes/admin.py:1050:80: E501 line too long (94 > 79 characters)
            "SELECT COUNT(DISTINCT profile_id) as count FROM conversations WHERE user_id = ?",
                                                                               ^
src/routes/admin.py:1057:80: E501 line too long (87 > 79 characters)
            "SELECT COUNT(*) as count FROM conversations WHERE user_id = ?", (user_id,)
                                                                               ^
src/routes/admin.py:1063:80: E501 line too long (86 > 79 characters)
            "SELECT COUNT(*) as count FROM action_items WHERE user_id = ?", (user_id,)
                                                                               ^
src/routes/admin.py:1069:80: E501 line too long (99 > 79 characters)
            "SELECT status, COUNT(*) as count FROM action_items WHERE user_id = ? GROUP BY status",
                                                                               ^
src/routes/admin.py:1078:80: E501 line too long (99 > 79 characters)
            "SELECT action, table_name, request_method, request_endpoint, status_code, created_at "
                                                                               ^
src/routes/admin.py:1079:80: E501 line too long (90 > 79 characters)
            "FROM enhanced_audit_log WHERE user_id = ? ORDER BY created_at DESC LIMIT 20",
                                                                               ^
src/routes/admin.py:1086:80: E501 line too long (81 > 79 characters)
            "SELECT COUNT(*) as count FROM enhanced_audit_log WHERE user_id = ?",
                                                                               ^
src/routes/admin.py:1097:80: E501 line too long (80 > 79 characters)
        report["activity_by_action"] = [dict(row) for row in activity_by_action]
                                                                               ^
src/routes/admin.py:1101:80: E501 line too long (97 > 79 characters)
            "SELECT MIN(created_at) as first_activity FROM enhanced_audit_log WHERE user_id = ?",
                                                                               ^
src/routes/admin.py:1105:80: E501 line too long (96 > 79 characters)
            "SELECT MAX(created_at) as last_activity FROM enhanced_audit_log WHERE user_id = ?",
                                                                               ^
src/routes/admin.py:1117:80: E501 line too long (82 > 79 characters)
            "SELECT COUNT(*) as count FROM feedback WHERE user_id = ?", (user_id,)
                                                                               ^
src/routes/admin.py:1172:80: E501 line too long (103 > 79 characters)
            # Delete user's profiles (will cascade to scenarios and action items via ON DELETE CASCADE)
                                                                               ^
src/routes/admin.py:1177:80: E501 line too long (85 > 79 characters)
            cursor.execute("DELETE FROM conversations WHERE user_id = ?", (user_id,))
                                                                               ^
src/routes/admin.py:1181:80: E501 line too long (80 > 79 characters)
            cursor.execute("DELETE FROM feedback WHERE user_id = ?", (user_id,))
                                                                               ^
src/routes/admin.py:1184:80: E501 line too long (85 > 79 characters)
            # Delete user's password reset requests (both as requester and processor)
                                                                               ^
src/routes/admin.py:1186:80: E501 line too long (83 > 79 characters)
                "DELETE FROM password_reset_requests WHERE user_id = ?", (user_id,)
                                                                               ^
src/routes/admin.py:1189:80: E501 line too long (96 > 79 characters)
                "UPDATE password_reset_requests SET processed_by = NULL WHERE processed_by = ?",
                                                                               ^
src/routes/admin.py:1262:80: E501 line too long (81 > 79 characters)
@admin_bp.route("/users/<int:user_id>/groups/<int:group_id>", methods=["DELETE"])
                                                                               ^
src/routes/admin.py:1316:80: E501 line too long (83 > 79 characters)
        result = db.execute_one("SELECT COUNT(*) as count FROM enhanced_audit_log")
                                                                               ^
src/routes/admin.py:1320:80: E501 line too long (83 > 79 characters)
        db_path = os.path.join(os.path.dirname(__file__), "../../data/planning.db")
                                                                               ^
src/routes/admin.py:1351:80: E501 line too long (87 > 79 characters)
        """Validate SQLite identifier to prevent SQL injection in PRAGMA statements."""
                                                                               ^
src/routes/admin.py:1362:80: E501 line too long (106 > 79 characters)
            "SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"
                                                                               ^
src/routes/admin.py:1464:80: E501 line too long (85 > 79 characters)
            return jsonify({"error": f"Seed script not found at {script_path}"}), 500
                                                                               ^
src/routes/admin.py:1469:80: E501 line too long (86 > 79 characters)
            [sys.executable, script_path], capture_output=True, text=True, check=False
                                                                               ^
src/routes/admin.py:1537:80: E501 line too long (82 > 79 characters)
            user_id=user_id, start_date=start_date, end_date=end_date, limit=limit
                                                                               ^
src/routes/admin.py:1583:80: E501 line too long (80 > 79 characters)
            "system-security": "docs/security/SYSTEM_SECURITY_DOCUMENTATION.md",
                                                                               ^
src/routes/admin.py:1584:80: E501 line too long (96 > 79 characters)
            "user-profile-relationship": "docs/reference/USER_PROFILE_SCENARIO_RELATIONSHIP.md",
                                                                               ^
src/routes/admin.py:1594:80: E501 line too long (82 > 79 characters)
            os.path.dirname(os.path.dirname(os.path.dirname(__file__))), file_name
                                                                               ^
src/routes/admin.py:1606:80: E501 line too long (83 > 79 characters)
            action=action, details={"document": file_name}, user_id=current_user.id
                                                                               ^
src/routes/admin.py:1618:80: E501 line too long (83 > 79 characters)
            return send_file(file_path, mimetype="text/plain", as_attachment=False)
                                                                               ^
src/routes/admin.py:1689:13: W503 line break before binary operator
            or new_config["mail_password"] == "********"
            ^
src/routes/admin.py:1699:80: E501 line too long (89 > 79 characters)
                """
                INSERT OR REPLACE INTO system_config (key, value, updated_at, updated_by)
                VALUES (?, ?, ?, ?)
            """,
                   
                                                           ^
src/routes/admin.py:1767:80: E501 line too long (85 > 79 characters)
                glob.glob(str(full_backup_dir / "rps_backup_*.tar.gz")), reverse=True
                                                                               ^
src/routes/admin.py:1789:80: E501 line too long (87 > 79 characters)
                    glob.glob(str(data_backup_dir / "rps_data_*.tar.gz")), reverse=True
                                                                               ^
src/routes/admin.py:1864:80: E501 line too long (84 > 79 characters)
        env["PATH"] = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
                                                                               ^
src/routes/admin.py:1934:80: E501 line too long (84 > 79 characters)
        env["PATH"] = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
                                                                               ^
src/routes/admin.py:2004:80: E501 line too long (84 > 79 characters)
        env["PATH"] = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
                                                                               ^
src/routes/admin.py:2063:9: F401 'pathlib.Path' imported but unused
        from pathlib import Path
        ^
src/routes/admin.py:2106:80: E501 line too long (83 > 79 characters)
                next_result.stdout.strip() if next_result.returncode == 0 else None
                                                                               ^
src/routes/admin.py:2109:80: E501 line too long (83 > 79 characters)
                last_result.stdout.strip() if last_result.returncode == 0 else None
                                                                               ^
src/routes/admin.py:2144:9: F401 'tempfile' imported but unused
        import tempfile
        ^
src/routes/admin.py:2165:80: E501 line too long (85 > 79 characters)
                m for m in tar.getmembers() if m.name.endswith("backup_metadata.txt")
                                                                               ^
src/routes/admin.py:2185:80: E501 line too long (88 > 79 characters)
                        {"metadata": metadata, "files": files, "file_count": len(files)}
                                                                               ^
src/routes/admin.py:2207:80: E501 line too long (100 > 79 characters)
    """
    Restore from a backup file.

    Request body:
        - backup_type: 'full', 'data', or 'system'
        - filename: Name of the backup file
        - restore_type: 'full', 'database', or 'config' (optional, defaults to based on backup_type)
    """
       
                               

                 
                    ^
src/routes/admin.py:2242:80: E501 line too long (84 > 79 characters)
        env["PATH"] = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
                                                                               ^
src/routes/admin.py:2284:80: E501 line too long (95 > 79 characters)
                        "warning": "Please restart the application for changes to take effect",
                                                                               ^
src/routes/admin.py:2361:80: E501 line too long (87 > 79 characters)
                {"success": True, "message": f"Backup {filename} deleted successfully"}
                                                                               ^
src/routes/admin.py:2381:80: E501 line too long (95 > 79 characters)
    """
    Generate a comprehensive report showing which users access the system from which locations.

    Super-admin only endpoint that provides:
    - User access patterns by location
    - Multiple location detection
    - Security alerts for unusual patterns
    - Timeline of location changes

    Query parameters:
        - days: Number of days to analyze (default: 30, max: 365)
    """
       
                                                                       ^
src/routes/admin.py:2402:80: E501 line too long (87 > 79 characters)
        # Include all actions with geolocation data to get complete IP/location picture
                                                                               ^
src/routes/admin.py:2470:80: E501 line too long (83 > 79 characters)
                users_by_location[user_id]["total_accesses"] += row["access_count"]
                                                                               ^
src/routes/admin.py:2476:21: W503 line break before binary operator
                    or row["first_access"] < users_by_location[user_id]["first_seen"]
                    ^
src/routes/admin.py:2476:80: E501 line too long (85 > 79 characters)
                    or row["first_access"] < users_by_location[user_id]["first_seen"]
                                                                               ^
src/routes/admin.py:2478:80: E501 line too long (82 > 79 characters)
                    users_by_location[user_id]["first_seen"] = row["first_access"]
                                                                               ^
src/routes/admin.py:2482:21: W503 line break before binary operator
                    or row["last_access"] > users_by_location[user_id]["last_seen"]
                    ^
src/routes/admin.py:2482:80: E501 line too long (83 > 79 characters)
                    or row["last_access"] > users_by_location[user_id]["last_seen"]
                                                                               ^
src/routes/admin.py:2484:80: E501 line too long (80 > 79 characters)
                    users_by_location[user_id]["last_seen"] = row["last_access"]
                                                                               ^
src/routes/admin.py:2500:80: E501 line too long (109 > 79 characters)
                        "message": f"User accessed from {user_data['unique_locations']} different locations",
                                                                               ^
src/routes/admin.py:2509:80: E501 line too long (106 > 79 characters)
                        "message": f"User accessed from {user_data['unique_ips']} different IP addresses",
                                                                               ^
src/routes/admin.py:2513:80: E501 line too long (87 > 79 characters)
            # Check for rapid location changes (within 1 hour from different locations)
                                                                               ^
src/routes/admin.py:2526:80: E501 line too long (82 > 79 characters)
                    if (time2 - time1).total_seconds() < 3600:  # Less than 1 hour
                                                                               ^
src/routes/admin.py:2531:80: E501 line too long (115 > 79 characters)
                                "message": f"Location changed from {loc1['city']} to {loc2['city']} within 1 hour",
                                                                               ^
src/routes/admin.py:2538:80: E501 line too long (87 > 79 characters)
            users_by_location.values(), key=lambda x: x["total_accesses"], reverse=True
                                                                               ^
src/routes/admin.py:2634:80: E501 line too long (85 > 79 characters)
            start_date = (datetime.now() - timedelta(days=days)).strftime("%Y-%m-%d")
                                                                               ^
src/routes/admin.py:2667:80: E501 line too long (92 > 79 characters)
            "    SUM(CASE WHEN al.status_code >= 400 THEN 1 ELSE 0 END) as failed_actions, "
                                                                               ^
src/routes/admin.py:2668:80: E501 line too long (98 > 79 characters)
            "    SUM(CASE WHEN al.action = 'LOGIN_ATTEMPT' THEN 1 ELSE 0 END) as login_attempts, "
                                                                               ^
src/routes/admin.py:2669:80: E501 line too long (84 > 79 characters)
            "    SUM(CASE WHEN al.action = 'CREATE' THEN 1 ELSE 0 END) as creates, "
                                                                               ^
src/routes/admin.py:2670:80: E501 line too long (84 > 79 characters)
            "    SUM(CASE WHEN al.action = 'UPDATE' THEN 1 ELSE 0 END) as updates, "
                                                                               ^
src/routes/admin.py:2671:80: E501 line too long (84 > 79 characters)
            "    SUM(CASE WHEN al.action = 'DELETE' THEN 1 ELSE 0 END) as deletes, "
                                                                               ^
src/routes/admin.py:2672:80: E501 line too long (80 > 79 characters)
            "    SUM(CASE WHEN al.action = 'READ' THEN 1 ELSE 0 END) as reads, "
                                                                               ^
src/routes/admin.py:2673:80: E501 line too long (92 > 79 characters)
            "    SUM(CASE WHEN al.action LIKE 'ADMIN%' THEN 1 ELSE 0 END) as admin_actions "
                                                                               ^
src/routes/admin.py:2711:80: E501 line too long (80 > 79 characters)
            top_actions_rows = db.execute(top_actions_query, top_actions_params)
                                                                               ^
src/routes/admin.py:2713:80: E501 line too long (86 > 79 characters)
                {"action": r["action"], "count": r["count"]} for r in top_actions_rows
                                                                               ^
src/routes/admin.py:2723:17: W503 line break before binary operator
                + (
                ^
src/routes/admin.py:2728:17: W503 line break before binary operator
                + "GROUP BY table_name "
                ^
src/routes/admin.py:2742:80: E501 line too long (88 > 79 characters)
                {"table": r["table_name"], "count": r["count"]} for r in top_tables_rows
                                                                               ^
src/routes/admin.py:2751:17: W503 line break before binary operator
                + (
                ^
src/routes/admin.py:2756:17: W503 line break before binary operator
                + "GROUP BY DATE(created_at) "
                ^
src/routes/admin.py:2780:80: E501 line too long (84 > 79 characters)
        avg_actions_per_user = total_actions / total_users if total_users > 0 else 0
                                                                               ^
src/routes/admin.py:2793:80: E501 line too long (82 > 79 characters)
            {"action": r["action"], "count": r["count"]} for r in action_dist_rows
                                                                               ^
src/routes/admin.py:2862:80: E501 line too long (81 > 79 characters)
    """
    Process a password reset request.

    Actions:
    - manual_reset: Admin sets a new password (data loss likely)
    - generate_link: Admin gets a reset link to give to user (user sets password)

    Request body:
        - action: 'manual_reset' or 'generate_link'
        - new_password: (required for manual_reset)
    """
       
                                     

            
                   ^
src/routes/admin.py:2890:24: F821 undefined name 'current_app'
            base_url = current_app.config.get("APP_BASE_URL", "https://rps.pan2.app")
                       ^
src/routes/admin.py:2890:80: E501 line too long (85 > 79 characters)
            base_url = current_app.config.get("APP_BASE_URL", "https://rps.pan2.app")
                                                                               ^
src/routes/admin.py:2898:80: E501 line too long (81 > 79 characters)
                details={"target_user": user.username, "request_id": request_id},
                                                                               ^
src/routes/admin.py:2907:80: E501 line too long (114 > 79 characters)
                        "instruction": "Send this link to the user via a secure channel. It expires in 24 hours.",
                                                                               ^
src/routes/admin.py:2916:80: E501 line too long (88 > 79 characters)
                return jsonify({"error": "Password must be at least 8 characters"}), 400
                                                                               ^
src/routes/admin.py:2925:80: E501 line too long (81 > 79 characters)
                details={"target_user": user.username, "dek_lost": dek_was_lost},
                                                                               ^
src/routes/admin.py:2931:80: E501 line too long (87 > 79 characters)
                msg += " Warning: Encrypted data was lost (no old password available)."
                                                                               ^
src/routes/admin.py:2959:50: W291 trailing whitespace
            sql = """
                SELECT u.id, u.username, u.email, 
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                ORDER BY u.username
            """
                     
                           ^
src/routes/admin.py:2960:80: E501 line too long (92 > 79 characters)
            sql = """
                SELECT u.id, u.username, u.email, 
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                ORDER BY u.username
            """
                     
                                                  
      ^
src/routes/admin.py:2961:80: E501 line too long (96 > 79 characters)
            sql = """
                SELECT u.id, u.username, u.email, 
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                ORDER BY u.username
            """
                     
                                                  
      ^
src/routes/admin.py:2962:80: E501 line too long (101 > 79 characters)
            sql = """
                SELECT u.id, u.username, u.email, 
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                ORDER BY u.username
            """
                     
                                                  
      ^
src/routes/admin.py:2971:80: E501 line too long (92 > 79 characters)
            sql = """
                SELECT DISTINCT u.id, u.username, u.email,
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.username
             """
                     
                                                         ^
src/routes/admin.py:2972:80: E501 line too long (96 > 79 characters)
            sql = """
                SELECT DISTINCT u.id, u.username, u.email,
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.username
             """
                     
                                                         ^
src/routes/admin.py:2973:80: E501 line too long (101 > 79 characters)
            sql = """
                SELECT DISTINCT u.id, u.username, u.email,
                       (SELECT COUNT(*) FROM profile WHERE user_id = u.id) as profile_count,
                       (SELECT COUNT(*) FROM user_backups WHERE user_id = u.id) as backup_count,
                       (SELECT MAX(created_at) FROM user_backups WHERE user_id = u.id) as last_backup
                FROM users u
                JOIN user_groups ug ON u.id = ug.user_id
                JOIN admin_groups ag ON ug.group_id = ag.group_id
                WHERE ag.user_id = ?
                ORDER BY u.username
             """
                     
                                                         ^
src/routes/admin.py:2998:80: E501 line too long (83 > 79 characters)
    label = data.get("label", f"Bulk Backup {datetime.now().strftime('%Y-%m-%d')}")
                                                                               ^
src/routes/admin.py:3006:80: E501 line too long (88 > 79 characters)
            results.append({"user_id": uid, "status": "error", "error": "Unauthorized"})
                                                                               ^
src/routes/admin.py:3010:13: F841 local variable 'res' is assigned to but never used
            res = UserBackupService.create_backup(uid, label)
            ^
src/routes/admin.py:3014:80: E501 line too long (80 > 79 characters)
            results.append({"user_id": uid, "status": "error", "error": str(e)})
                                                                               ^
src/routes/admin.py:3040:80: E501 line too long (88 > 79 characters)
            results.append({"user_id": uid, "status": "error", "error": "Unauthorized"})
                                                                               ^
src/routes/admin.py:3048:80: E501 line too long (84 > 79 characters)
                    {"user_id": uid, "status": "error", "error": "No backups found"}
                                                                               ^
src/routes/admin.py:3056:54: F541 f-string is missing placeholders
                UserBackupService.create_backup(uid, f"Pre-restore Safety (Bulk Admin)")
                                                     ^
src/routes/admin.py:3056:80: E501 line too long (88 > 79 characters)
                UserBackupService.create_backup(uid, f"Pre-restore Safety (Bulk Admin)")
                                                                               ^
src/routes/admin.py:3072:80: E501 line too long (80 > 79 characters)
            results.append({"user_id": uid, "status": "error", "error": str(e)})
                                                                               ^
src/routes/admin.py:3110:80: E501 line too long (82 > 79 characters)
                return jsonify({"error": "Unauthorized to manage this user"}), 403
                                                                               ^
src/routes/admin.py:3139:80: E501 line too long (82 > 79 characters)
                return jsonify({"error": "Unauthorized to manage this user"}), 403
                                                                               ^
src/routes/admin.py:3153:80: E501 line too long (82 > 79 characters)
            jsonify({"message": "Backup created successfully", "backup": result}),
                                                                               ^
src/routes/admin.py:3183:80: E501 line too long (82 > 79 characters)
                return jsonify({"error": "Unauthorized to manage this user"}), 403
                                                                               ^
src/routes/admin.py:3188:80: E501 line too long (86 > 79 characters)
                user_id, f"Pre-restore Safety Backup (Admin: {current_user.username})"
                                                                               ^
src/routes/admin.py:3206:80: E501 line too long (87 > 79 characters)
            jsonify({"message": "User data restored successfully", "details": result}),
                                                                               ^
src/routes/admin.py:3213:80: E501 line too long (83 > 79 characters)
@admin_bp.route("/users/<int:user_id>/backups/<int:backup_id>", methods=["DELETE"])
                                                                               ^
src/routes/admin.py:3234:80: E501 line too long (82 > 79 characters)
                return jsonify({"error": "Unauthorized to manage this user"}), 403
                                                                               ^
src/routes/admin.py:3259:80: E501 line too long (80 > 79 characters)
    """Get all profiles with user and group information for backup selection."""
                                                                               ^
src/routes/admin.py:3331:80: E501 line too long (83 > 79 characters)
            return jsonify({"error": "Must specify profile_ids or group_ids"}), 400
                                                                               ^
src/routes/admin.py:3355:80: E501 line too long (89 > 79 characters)
                    "message": f"Backup created with {result['profile_count']} profiles",
                                                                               ^
src/routes/admin.py:3396:80: E501 line too long (94 > 79 characters)
    """
    Restore profiles from a selective backup.

    Request body:
        - profile_ids: Optional list of profile IDs to restore (restores all if not specified)
        - restore_mode: 'merge' (default) or 'replace'
    """
       
                                             

                 
      ^
src/routes/admin.py:3409:80: E501 line too long (83 > 79 characters)
                    {"error": 'Invalid restore_mode. Must be "merge" or "replace"'}
                                                                               ^
src/routes/admin.py:3415:80: E501 line too long (81 > 79 characters)
            filename=filename, profile_ids=profile_ids, restore_mode=restore_mode
                                                                               ^
src/routes/admin.py:3434:80: E501 line too long (124 > 79 characters)
                        "message": f"Restored {result['profiles_restored']} profiles, updated {result['profiles_updated']}",
                                                                               ^
src/routes/admin.py:3478:80: E501 line too long (88 > 79 characters)
        return jsonify({"success": True, "message": "Backup deleted successfully"}), 200
                                                                               ^
src/routes/ai_services.py:6:1: F401 'os' imported but unused
import os
^
src/routes/ai_services.py:53:80: E501 line too long (87 > 79 characters)
        # We'll group pages into larger chunks to keep context manageable but efficient
                                                                               ^
src/routes/ai_services.py:61:47: E226 missing whitespace around arithmetic operator
                current_chunk += f"--- Page {i+1} ---\n{page_text}\n\n"
                                              ^
src/routes/ai_services.py:64:80: E501 line too long (81 > 79 characters)
                # Close chunk every 50 pages or if it gets very large (30k chars)
                                                                               ^
src/routes/ai_services.py:76:80: E501 line too long (97 > 79 characters)
                f"Extracted {len(text_chunks)} text chunks from {pdf_document.page_count} pages."
                                                                               ^
src/routes/ai_services.py:93:80: E501 line too long (80 > 79 characters)
            images.append(base64.b64encode(buffered.getvalue()).decode("utf-8"))
                                                                               ^
src/routes/ai_services.py:106:80: E501 line too long (88 > 79 characters)
    """
    Extremely robust LLM JSON parser.
    Handles markdown, preamble text, trailing text, single objects, and common wrappers.
    """
       
                                     
                                 ^
src/routes/ai_services.py:123:80: E501 line too long (85 > 79 characters)
            markdown_content = clean_text.split("```json")[1].split("```")[0].strip()
                                                                               ^
src/routes/ai_services.py:126:9: E722 do not use bare 'except'
        except:
        ^
src/routes/ai_services.py:130:80: E501 line too long (81 > 79 characters)
            markdown_content = clean_text.split("```")[1].split("```")[0].strip()
                                                                               ^
src/routes/ai_services.py:133:9: E722 do not use bare 'except'
        except:
        ^
src/routes/ai_services.py:145:9: E722 do not use bare 'except'
        except:
        ^
src/routes/ai_services.py:158:21: E722 do not use bare 'except'
                    except:
                    ^
src/routes/ai_services.py:160:9: E722 do not use bare 'except'
        except:
        ^
src/routes/ai_services.py:163:80: E501 line too long (94 > 79 characters)
    # 4. Final Fallback: Regex-based field extraction (for non-JSON or badly malformed output)
                                                                               ^
src/routes/ai_services.py:168:80: E501 line too long (83 > 79 characters)
            r'"?(?:name|description|payee|institution)"?\s*[:=-]\s*"?([^"\n,]+)"?',
                                                                               ^
src/routes/ai_services.py:174:80: E501 line too long (80 > 79 characters)
            r'"?(?:amount|value|balance|price|total)"?\s*[:=-]\s*"?([\d,.]+)"?',
                                                                               ^
src/routes/ai_services.py:187:80: E501 line too long (87 > 79 characters)
                    r'"?(?:type|category)"?\s*:\s*"([^"]+)"', clean_text, re.IGNORECASE
                                                                               ^
src/routes/ai_services.py:199:80: E501 line too long (82 > 79 characters)
                    "frequency": freq_match.group(1) if freq_match else "monthly",
                                                                               ^
src/routes/ai_services.py:202:13: E722 do not use bare 'except'
            except:
            ^
src/routes/ai_services.py:204:5: E722 do not use bare 'except'
    except:
    ^
src/routes/ai_services.py:212:80: E501 line too long (82 > 79 characters)
    """Helper to convert various JSON shapes into a consistent list of objects."""
                                                                               ^
src/routes/ai_services.py:245:80: E501 line too long (83 > 79 characters)
            if isinstance(val, list) and len(val) > 0 and isinstance(val[0], dict):
                                                                               ^
src/routes/ai_services.py:248:80: E501 line too long (96 > 79 characters)
        # If it's a single object that matches the expected structure but not in a list, wrap it
                                                                               ^
src/routes/ai_services.py:271:80: E501 line too long (83 > 79 characters)
                for alt in ["description", "payee", "institution", "memo", "type"]:
                                                                               ^
src/routes/ai_services.py:283:80: E501 line too long (91 > 79 characters)
    """Calls Gemini with a prioritized list of models and fallback logic using REST API."""
                                                                               ^
src/routes/ai_services.py:333:21: E722 do not use bare 'except'
                    except:
                    ^
src/routes/ai_services.py:338:80: E501 line too long (80 > 79 characters)
                # For text files (CSV, TXT, etc.), include content in the prompt
                                                                               ^
src/routes/ai_services.py:346:80: E501 line too long (87 > 79 characters)
                        "generationConfig": {"response_mime_type": "application/json"},
                                                                               ^
src/routes/ai_services.py:364:80: E501 line too long (87 > 79 characters)
                        "generationConfig": {"response_mime_type": "application/json"},
                                                                               ^
src/routes/ai_services.py:370:80: E501 line too long (83 > 79 characters)
                    "generationConfig": {"response_mime_type": "application/json"},
                                                                               ^
src/routes/ai_services.py:373:80: E501 line too long (95 > 79 characters)
            # Use v1beta for all calls - it's more robust and required for PDF/Document support
                                                                               ^
src/routes/ai_services.py:379:80: E501 line too long (132 > 79 characters)
                    "API key contains invalid characters (possibly masked). Please re-enter your API key in Settings  AI Settings."
                                                                               ^
src/routes/ai_services.py:383:80: E501 line too long (124 > 79 characters)
            url = f"https://generativelanguage.googleapis.com/{api_version}/{full_model_path}:generateContent?key={api_key}"
                                                                               ^
src/routes/ai_services.py:392:80: E501 line too long (81 > 79 characters)
                    text = result["candidates"][0]["content"]["parts"][0]["text"]
                                                                               ^
src/routes/ai_services.py:394:80: E501 line too long (91 > 79 characters)
                        f"  Success with model: {model_name}, response length: {len(text)}"
                                                                               ^
src/routes/ai_services.py:398:80: E501 line too long (85 > 79 characters)
                    print(f"  No candidates in response: {json.dumps(result)[:500]}")
                                                                               ^
src/routes/ai_services.py:402:80: E501 line too long (80 > 79 characters)
                    response.text[:500] if response.text else "No response body"
                                                                               ^
src/routes/ai_services.py:404:80: E501 line too long (83 > 79 characters)
                print(f"  Gemini API Error: {response.status_code} - {error_text}")
                                                                               ^
src/routes/ai_services.py:406:80: E501 line too long (82 > 79 characters)
                    response.json() if response.text else {"error": response.text}
                                                                               ^
src/routes/ai_services.py:415:80: E501 line too long (94 > 79 characters)
            # Check for quota errors - try other models if quota exceeded on this specific one
                                                                               ^
src/routes/ai_services.py:418:17: W503 line break before binary operator
                or "quota" in error_str.lower()
                ^
src/routes/ai_services.py:419:17: W503 line break before binary operator
                or "RESOURCE_EXHAUSTED" in error_str
                ^
src/routes/ai_services.py:431:80: E501 line too long (92 > 79 characters)
            "Gemini API quota exceeded. Please wait a few minutes or upgrade your API plan."
                                                                               ^
src/routes/ai_services.py:451:80: E501 line too long (87 > 79 characters)
            csv_content = base64.b64decode(image_b64).decode("utf-8", errors="replace")
                                                                               ^
src/routes/ai_services.py:458:80: E501 line too long (85 > 79 characters)
                        "content": f"{prompt}\n\nCSV Data:\n```\n{csv_content}\n```",
                                                                               ^
src/routes/ai_services.py:493:80: E501 line too long (80 > 79 characters)
        response = requests.post(url, headers=headers, json=payload, timeout=60)
                                                                               ^
src/routes/ai_services.py:507:80: E501 line too long (88 > 79 characters)
    headers = {"Content-Type": "application/json", "Authorization": f"Bearer {api_key}"}
                                                                               ^
src/routes/ai_services.py:515:80: E501 line too long (87 > 79 characters)
            csv_content = base64.b64decode(image_b64).decode("utf-8", errors="replace")
                                                                               ^
src/routes/ai_services.py:521:80: E501 line too long (85 > 79 characters)
                        "content": f"{prompt}\n\nCSV Data:\n```\n{csv_content}\n```",
                                                                               ^
src/routes/ai_services.py:549:80: E501 line too long (80 > 79 characters)
        response = requests.post(url, headers=headers, json=payload, timeout=60)
                                                                               ^
src/routes/ai_services.py:560:1: F811 redefinition of unused 'Profile' from line 17
from src.models.profile import Profile
^
src/routes/ai_services.py:560:1: E402 module level import not at top of file
from src.models.profile import Profile
^
src/routes/ai_services.py:561:1: F811 redefinition of unused 'Conversation' from line 18
from src.models.conversation import Conversation
^
src/routes/ai_services.py:561:1: E402 module level import not at top of file
from src.models.conversation import Conversation
^
src/routes/ai_services.py:562:1: F811 redefinition of unused 'current_user' from line 9
from flask_login import current_user
^
src/routes/ai_services.py:562:1: E402 module level import not at top of file
from flask_login import current_user
^
src/routes/ai_services.py:578:80: E501 line too long (80 > 79 characters)
        return call_gemini(prompt, api_key, history, system_prompt, model=model)
                                                                               ^
src/routes/ai_services.py:580:80: E501 line too long (80 > 79 characters)
        return call_claude(prompt, api_key, history, system_prompt, model=model)
                                                                               ^
src/routes/ai_services.py:586:80: E501 line too long (83 > 79 characters)
        return call_ollama(prompt, ollama_url, history, system_prompt, model=model)
                                                                               ^
src/routes/ai_services.py:605:80: E501 line too long (82 > 79 characters)
                    types.Content(role=role, parts=[types.Part(text=msg_content)])
                                                                               ^
src/routes/ai_services.py:608:80: E501 line too long (80 > 79 characters)
    contents.append(types.Content(role="user", parts=[types.Part(text=prompt)]))
                                                                               ^
src/routes/ai_services.py:666:80: E501 line too long (80 > 79 characters)
            payload = {"model": model, "max_tokens": 4096, "messages": messages}
                                                                               ^
src/routes/ai_services.py:685:80: E501 line too long (97 > 79 characters)
                    f"Claude API error for {model}: {response.status_code} {response.text[:200]}"
                                                                               ^
src/routes/ai_services.py:748:80: E501 line too long (83 > 79 characters)
            json={"model": active_model, "messages": messages, "temperature": 0.7},
                                                                               ^
src/routes/ai_services.py:754:80: E501 line too long (82 > 79 characters)
            raise Exception(f"{provider.capitalize()} API error: {response.text}")
                                                                               ^
src/routes/ai_services.py:844:80: E501 line too long (84 > 79 characters)
            raise Exception(f"Ollama error: {response.status_code} {response.text}")
                                                                               ^
src/routes/ai_services.py:847:80: E501 line too long (86 > 79 characters)
            f"Cannot connect to Ollama at {url}. Is Ollama running? Try: ollama serve"
                                                                               ^
src/routes/ai_services.py:861:5: F841 local variable 'conversation_id' is assigned to but never used
    conversation_id = data.get("conversation_id")
    ^
src/routes/ai_services.py:875:80: E501 line too long (94 > 79 characters)
        # Determine provider: priority = request > profile preference > Gemini (if key exists)
                                                                               ^
src/routes/ai_services.py:912:80: E501 line too long (88 > 79 characters)
        localai_url = sanitize_url(api_keys.get("localai_url"), "http://localhost:8080")
                                                                               ^
src/routes/ai_services.py:913:9: F841 local variable 'ollama_url' is assigned to but never used
        ollama_url = sanitize_url(api_keys.get("ollama_url"), "http://localhost:11434")
        ^
src/routes/ai_services.py:913:80: E501 line too long (87 > 79 characters)
        ollama_url = sanitize_url(api_keys.get("ollama_url"), "http://localhost:11434")
                                                                               ^
src/routes/ai_services.py:919:80: E501 line too long (116 > 79 characters)
                        "error": f"{provider.capitalize()} API key not configured. Please configure in AI Settings."
                                                                               ^
src/routes/ai_services.py:938:1: W293 blank line contains whitespace
        context = f"""
        USER PROFILE CONTEXT:
        Name: {profile.name}
        Birth Date: {profile.birth_date}
        Retirement Date: {profile.retirement_date}
        
        FINANCIALS:
        Annual Income: ${financial.get('annual_income', 0):,}
        Annual Expenses: ${financial.get('annual_expenses', 0):,}
        Social Security (monthly): ${financial.get('social_security_benefit', 0):,}
        
        ASSETS:
        Retirement: ${sum(a.get('value', 0) for a in assets.get('retirement_accounts', [])):,}
        Taxable: ${sum(a.get('value', 0) for a in assets.get('taxable_accounts', [])):,}
        Real estate: ${sum(a.get('value', 0) for a in assets.get('real_estate', [])):,}
        """
^
src/routes/ai_services.py:942:80: E501 line too long (83 > 79 characters)
        context = f"""
        USER PROFILE CONTEXT:
        Name: {profile.name}
        Birth Date: {profile.birth_date}
        Retirement Date: {profile.retirement_date}
        
        FINANCIALS:
        Annual Income: ${financial.get('annual_income', 0):,}
        Annual Expenses: ${financial.get('annual_expenses', 0):,}
        Social Security (monthly): ${financial.get('social_security_benefit', 0):,}
        
        ASSETS:
        Retirement: ${sum(a.get('value', 0) for a in assets.get('retirement_accounts', [])):,}
        Taxable: ${sum(a.get('value', 0) for a in assets.get('taxable_accounts', [])):,}
        Real estate: ${sum(a.get('value', 0) for a in assets.get('real_estate', [])):,}
        """
                      
                             
                          ^
src/routes/ai_services.py:943:1: W293 blank line contains whitespace
        context = f"""
        USER PROFILE CONTEXT:
        Name: {profile.name}
        Birth Date: {profile.birth_date}
        Retirement Date: {profile.retirement_date}
        
        FINANCIALS:
        Annual Income: ${financial.get('annual_income', 0):,}
        Annual Expenses: ${financial.get('annual_expenses', 0):,}
        Social Security (monthly): ${financial.get('social_security_benefit', 0):,}
        
        ASSETS:
        Retirement: ${sum(a.get('value', 0) for a in assets.get('retirement_accounts', [])):,}
        Taxable: ${sum(a.get('value', 0) for a in assets.get('taxable_accounts', [])):,}
        Real estate: ${sum(a.get('value', 0) for a in assets.get('real_estate', [])):,}
        """
^
src/routes/ai_services.py:945:80: E501 line too long (94 > 79 characters)
        context = f"""
        USER PROFILE CONTEXT:
        Name: {profile.name}
        Birth Date: {profile.birth_date}
        Retirement Date: {profile.retirement_date}
        
        FINANCIALS:
        Annual Income: ${financial.get('annual_income', 0):,}
        Annual Expenses: ${financial.get('annual_expenses', 0):,}
        Social Security (monthly): ${financial.get('social_security_benefit', 0):,}
        
        ASSETS:
        Retirement: ${sum(a.get('value', 0) for a in assets.get('retirement_accounts', [])):,}
        Taxable: ${sum(a.get('value', 0) for a in assets.get('taxable_accounts', [])):,}
        Real estate: ${sum(a.get('value', 0) for a in assets.get('real_estate', [])):,}
        """
                      
                             
                          ^
src/routes/ai_services.py:946:80: E501 line too long (88 > 79 characters)
        context = f"""
        USER PROFILE CONTEXT:
        Name: {profile.name}
        Birth Date: {profile.birth_date}
        Retirement Date: {profile.retirement_date}
        
        FINANCIALS:
        Annual Income: ${financial.get('annual_income', 0):,}
        Annual Expenses: ${financial.get('annual_expenses', 0):,}
        Social Security (monthly): ${financial.get('social_security_benefit', 0):,}
        
        ASSETS:
        Retirement: ${sum(a.get('value', 0) for a in assets.get('retirement_accounts', [])):,}
        Taxable: ${sum(a.get('value', 0) for a in assets.get('taxable_accounts', [])):,}
        Real estate: ${sum(a.get('value', 0) for a in assets.get('real_estate', [])):,}
        """
                      
                             
                          ^
src/routes/ai_services.py:947:80: E501 line too long (87 > 79 characters)
        context = f"""
        USER PROFILE CONTEXT:
        Name: {profile.name}
        Birth Date: {profile.birth_date}
        Retirement Date: {profile.retirement_date}
        
        FINANCIALS:
        Annual Income: ${financial.get('annual_income', 0):,}
        Annual Expenses: ${financial.get('annual_expenses', 0):,}
        Social Security (monthly): ${financial.get('social_security_benefit', 0):,}
        
        ASSETS:
        Retirement: ${sum(a.get('value', 0) for a in assets.get('retirement_accounts', [])):,}
        Taxable: ${sum(a.get('value', 0) for a in assets.get('taxable_accounts', [])):,}
        Real estate: ${sum(a.get('value', 0) for a in assets.get('real_estate', [])):,}
        """
                      
                             
                          ^
src/routes/ai_services.py:950:80: E501 line too long (139 > 79 characters)
        system_prompt = f"""You are an expert financial advisor specializing in retirement planning, tax optimization, and estate planning.
        {context}

        Provide professional, clear, and actionable advice. Always include a disclaimer that you are an AI and the user should consult with a human professional for final decisions.
        """
                                                                               ^
src/routes/ai_services.py:953:80: E501 line too long (181 > 79 characters)
        system_prompt = f"""You are an expert financial advisor specializing in retirement planning, tax optimization, and estate planning.
        {context}

        Provide professional, clear, and actionable advice. Always include a disclaimer that you are an AI and the user should consult with a human professional for final decisions.
        """
                                                                               ^
src/routes/ai_services.py:1000:80: E501 line too long (87 > 79 characters)
                {"response": assistant_text, "provider": provider, "status": "success"}
                                                                               ^
src/routes/ai_services.py:1052:80: E501 line too long (83 > 79 characters)
@ai_services_bp.route("/advisor/conversation/<int:profile_id>", methods=["DELETE"])
                                                                               ^
src/routes/ai_services.py:1076:80: E501 line too long (95 > 79 characters)
        "prompt": """
            TASK: Extract all investment accounts, bank accounts, or assets from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Account or institution name
            - "type": One of [traditional_ira, roth_ira, 401k, 403b, 457, brokerage, savings, checking]
            - "value": The current balance or value as a number
            - "institution": The bank or company name
            
            EXAMPLE OUTPUT:
            [{"name": "Savings", "type": "savings", "value": 5000, "institution": "Chase"}]
            
            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1080:80: E501 line too long (103 > 79 characters)
        "prompt": """
            TASK: Extract all investment accounts, bank accounts, or assets from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Account or institution name
            - "type": One of [traditional_ira, roth_ira, 401k, 403b, 457, brokerage, savings, checking]
            - "value": The current balance or value as a number
            - "institution": The bank or company name
            
            EXAMPLE OUTPUT:
            [{"name": "Savings", "type": "savings", "value": 5000, "institution": "Chase"}]
            
            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1083:1: W293 blank line contains whitespace
        "prompt": """
            TASK: Extract all investment accounts, bank accounts, or assets from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Account or institution name
            - "type": One of [traditional_ira, roth_ira, 401k, 403b, 457, brokerage, savings, checking]
            - "value": The current balance or value as a number
            - "institution": The bank or company name
            
            EXAMPLE OUTPUT:
            [{"name": "Savings", "type": "savings", "value": 5000, "institution": "Chase"}]
            
            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
^
src/routes/ai_services.py:1085:80: E501 line too long (91 > 79 characters)
        "prompt": """
            TASK: Extract all investment accounts, bank accounts, or assets from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Account or institution name
            - "type": One of [traditional_ira, roth_ira, 401k, 403b, 457, brokerage, savings, checking]
            - "value": The current balance or value as a number
            - "institution": The bank or company name
            
            EXAMPLE OUTPUT:
            [{"name": "Savings", "type": "savings", "value": 5000, "institution": "Chase"}]
            
            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1086:1: W293 blank line contains whitespace
        "prompt": """
            TASK: Extract all investment accounts, bank accounts, or assets from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Account or institution name
            - "type": One of [traditional_ira, roth_ira, 401k, 403b, 457, brokerage, savings, checking]
            - "value": The current balance or value as a number
            - "institution": The bank or company name
            
            EXAMPLE OUTPUT:
            [{"name": "Savings", "type": "savings", "value": 5000, "institution": "Chase"}]
            
            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
^
src/routes/ai_services.py:1087:80: E501 line too long (80 > 79 characters)
        "prompt": """
            TASK: Extract all investment accounts, bank accounts, or assets from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Account or institution name
            - "type": One of [traditional_ira, roth_ira, 401k, 403b, 457, brokerage, savings, checking]
            - "value": The current balance or value as a number
            - "institution": The bank or company name
            
            EXAMPLE OUTPUT:
            [{"name": "Savings", "type": "savings", "value": 5000, "institution": "Chase"}]
            
            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1099:80: E501 line too long (95 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1102:80: E501 line too long (90 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1103:80: E501 line too long (129 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1104:80: E501 line too long (80 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1106:80: E501 line too long (106 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1107:80: E501 line too long (110 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1109:80: E501 line too long (80 > 79 characters)
        "prompt": """
            TASK: Extract all regular income streams from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the income source
            - "amount": The per-period dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, semi-monthly, monthly, quarterly, annual]

            CONSOLIDATION RULES:
            - If the same income source appears MULTIPLE times, consolidate into ONE entry
            - For recurring income (appears 2+ times): set frequency to "monthly" or appropriate interval, use the AVERAGE amount
            - For one-time income (appears only once): set frequency to "annual"

            EXAMPLE: If "Employer Direct Deposit" appears 4 times with amounts $2800, $2850, $2800, $2900:
            Output ONE entry: {"name": "Employer Direct Deposit", "amount": 2837.50, "frequency": "bi-weekly"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1116:80: E501 line too long (83 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1121:80: E501 line too long (94 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1122:80: E501 line too long (292 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1125:80: E501 line too long (91 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1126:80: E501 line too long (115 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1127:80: E501 line too long (104 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1128:80: E501 line too long (82 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1129:80: E501 line too long (89 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1131:80: E501 line too long (86 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1132:80: E501 line too long (119 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1134:80: E501 line too long (80 > 79 characters)
        "prompt": """
            TASK: Extract all recurring or significant expenses from this document.
            FORMAT: You must return a JSON array of objects.
            FIELDS PER OBJECT:
            - "name": Descriptive name of the expense (use merchant/payee name)
            - "amount": The dollar amount as a number
            - "frequency": One of [weekly, bi-weekly, monthly, quarterly, semi-annual, annual]
            - "category": One of [housing, utilities, transportation, food, dining_out, healthcare, insurance, travel, entertainment, personal_care, clothing, gifts, childcare_education, charitable_giving, subscriptions, pet_care, home_maintenance, debt_payments, taxes, discretionary, other]

            CONSOLIDATION RULES:
            - If the same merchant/payee appears MULTIPLE times, consolidate into ONE entry
            - For recurring expenses (appears 2+ times monthly): set frequency to "monthly", use the AVERAGE amount
            - For recurring expenses (appears weekly): set frequency to "weekly", use the AVERAGE amount
            - For one-time expenses (appears only once): set frequency to "annual"
            - Group similar small transactions (e.g., multiple grocery trips) by category

            EXAMPLE: If "Netflix" appears 3 times with amounts $15.99, $15.99, $17.99:
            Output ONE entry: {"name": "Netflix", "amount": 16.66, "frequency": "monthly", "category": "subscriptions"}

            CRITICAL: Return ONLY the JSON array. Do not include any other text.
            """,
                     
                                                         ^
src/routes/ai_services.py:1178:80: E501 line too long (84 > 79 characters)
            requested_provider or data_dict.get("preferred_ai_provider") or "gemini"
                                                                               ^
src/routes/ai_services.py:1186:80: E501 line too long (88 > 79 characters)
        localai_url = sanitize_url(api_keys.get("localai_url"), "http://localhost:8080")
                                                                               ^
src/routes/ai_services.py:1187:80: E501 line too long (87 > 79 characters)
        ollama_url = sanitize_url(api_keys.get("ollama_url"), "http://localhost:11434")
                                                                               ^
src/routes/ai_services.py:1191:80: E501 line too long (87 > 79 characters)
                jsonify({"error": f"{provider.capitalize()} API key not configured."}),
                                                                               ^
src/routes/ai_services.py:1203:80: E501 line too long (80 > 79 characters)
            if mime_type == "application/pdf" or image_b64.startswith("JVBERi"):
                                                                               ^
src/routes/ai_services.py:1214:61: E226 missing whitespace around arithmetic operator
                            "message": f"Analyzing page {idx+1}/{num_chunks}...",
                                                            ^
src/routes/ai_services.py:1214:80: E501 line too long (81 > 79 characters)
                            "message": f"Analyzing page {idx+1}/{num_chunks}...",
                                                                               ^
src/routes/ai_services.py:1234:80: E501 line too long (88 > 79 characters)
                            mime_type="image/png" if content_type == "images" else None,
                                                                               ^
src/routes/ai_services.py:1263:80: E501 line too long (96 > 79 characters)
                        # Other providers (deepseek, grok, mistral, etc.) - text extraction only
                                                                               ^
src/routes/ai_services.py:1275:80: E501 line too long (95 > 79 characters)
                            # Skip image chunks for non-vision providers, continue with warning
                                                                               ^
src/routes/ai_services.py:1277:80: E501 line too long (110 > 79 characters)
                                f"WARNING: Provider '{provider}' cannot process image chunks from scanned PDF"
                                                                               ^
src/routes/ai_services.py:1326:80: E501 line too long (88 > 79 characters)
                            prompt, api_key, image_b64, mime_type, model=requested_model
                                                                               ^
src/routes/ai_services.py:1335:80: E501 line too long (135 > 79 characters)
                        text_content = "[Image provided - vision not supported via local AI yet. Use Gemini/Claude/OpenAI for images.]"
                                                                               ^
src/routes/ai_services.py:1361:80: E501 line too long (129 > 79 characters)
                            f"Provider '{provider}' does not support image extraction. Use Gemini, Claude, or OpenAI for images."
                                                                               ^
src/routes/ai_services.py:1364:80: E501 line too long (83 > 79 characters)
                items = resilient_parse_llm_json(response_text, config["list_key"])
                                                                               ^
src/routes/ai_services.py:1387:80: E501 line too long (80 > 79 characters)
    """
    AI-powered enhancement for CSV imports.
    Performs smart duplicate detection and categorization beyond fuzzy matching.
    """
       
                                           
                           ^
src/routes/ai_services.py:1398:80: E501 line too long (84 > 79 characters)
        return jsonify({"error": "type, items, and profile_name are required"}), 400
                                                                               ^
src/routes/ai_services.py:1409:80: E501 line too long (84 > 79 characters)
            requested_provider or data_dict.get("preferred_ai_provider") or "gemini"
                                                                               ^
src/routes/ai_services.py:1417:80: E501 line too long (88 > 79 characters)
        localai_url = sanitize_url(api_keys.get("localai_url"), "http://localhost:8080")
                                                                               ^
src/routes/ai_services.py:1418:80: E501 line too long (87 > 79 characters)
        ollama_url = sanitize_url(api_keys.get("ollama_url"), "http://localhost:11434")
                                                                               ^
src/routes/ai_services.py:1424:80: E501 line too long (116 > 79 characters)
                        "error": f"{provider.capitalize()} API key not configured. Please configure in AI Settings."
                                                                               ^
src/routes/ai_services.py:1435:80: E501 line too long (84 > 79 characters)
            existing_data = data_dict.get("financial", {}).get("income_streams", [])
                                                                               ^
src/routes/ai_services.py:1452:80: E501 line too long (91 > 79 characters)
        # Prepare context for AI - only enhance items that aren't already confident matches
                                                                               ^
src/routes/ai_services.py:1459:80: E501 line too long (88 > 79 characters)
                jsonify({"items": reconciled_items, "status": "no_enhancement_needed"}),
                                                                               ^
src/routes/ai_services.py:1463:80: E501 line too long (80 > 79 characters)
        # Truncate existing data if it's too large to fit in context efficiently
                                                                               ^
src/routes/ai_services.py:1466:80: E501 line too long (85 > 79 characters)
            existing_data[:100] if isinstance(existing_data, list) else existing_data
                                                                               ^
src/routes/ai_services.py:1470:72: W291 trailing whitespace
        prompt = f"""
        TASK: Enhance the following list of imported {item_type} items. 
        Detect hidden duplicates and suggest better categorizations.

        EXISTING {item_type.upper()} ITEMS IN PROFILE:
        {json.dumps(context_existing, indent=2)}

        NEW IMPORTED ITEMS TO PROCESS:
        {json.dumps(items_to_enhance, indent=2)}

        INSTRUCTIONS:
        1. Duplicate Detection: Find items that are clearly the same but have different names (e.g. "MSFT" vs "Microsoft").
        2. Smart Categorization: If an item has category "other" or a vague name, suggest the best specific category from the standard list.
        
        STANDARD CATEGORIES FOR {item_type.upper()}:
        {json.dumps(ReconciliationService.valid_categories.get(item_type, []), indent=2)}

        OUTPUT FORMAT: Return a JSON array of objects matching the input item list length and order.
        Each object should have an "ai_suggestions" field with:
        - "is_duplicate": boolean
        - "duplicate_of": string (name of existing item)
        - "suggested_category": string
        - "reasoning": string (brief explanation)
        - "confidence": float (0.0 to 1.0)

        CRITICAL: Return ONLY the JSON array.
        """
                     
                                                 ^
src/routes/ai_services.py:1480:80: E501 line too long (123 > 79 characters)
        prompt = f"""
        TASK: Enhance the following list of imported {item_type} items. 
        Detect hidden duplicates and suggest better categorizations.

        EXISTING {item_type.upper()} ITEMS IN PROFILE:
        {json.dumps(context_existing, indent=2)}

        NEW IMPORTED ITEMS TO PROCESS:
        {json.dumps(items_to_enhance, indent=2)}

        INSTRUCTIONS:
        1. Duplicate Detection: Find items that are clearly the same but have different names (e.g. "MSFT" vs "Microsoft").
        2. Smart Categorization: If an item has category "other" or a vague name, suggest the best specific category from the standard list.
        
        STANDARD CATEGORIES FOR {item_type.upper()}:
        {json.dumps(ReconciliationService.valid_categories.get(item_type, []), indent=2)}

        OUTPUT FORMAT: Return a JSON array of objects matching the input item list length and order.
        Each object should have an "ai_suggestions" field with:
        - "is_duplicate": boolean
        - "duplicate_of": string (name of existing item)
        - "suggested_category": string
        - "reasoning": string (brief explanation)
        - "confidence": float (0.0 to 1.0)

        CRITICAL: Return ONLY the JSON array.
        """
                     
                                                         ^
src/routes/ai_services.py:1481:80: E501 line too long (140 > 79 characters)
        prompt = f"""
        TASK: Enhance the following list of imported {item_type} items. 
        Detect hidden duplicates and suggest better categorizations.

        EXISTING {item_type.upper()} ITEMS IN PROFILE:
        {json.dumps(context_existing, indent=2)}

        NEW IMPORTED ITEMS TO PROCESS:
        {json.dumps(items_to_enhance, indent=2)}

        INSTRUCTIONS:
        1. Duplicate Detection: Find items that are clearly the same but have different names (e.g. "MSFT" vs "Microsoft").
        2. Smart Categorization: If an item has category "other" or a vague name, suggest the best specific category from the standard list.
        
        STANDARD CATEGORIES FOR {item_type.upper()}:
        {json.dumps(ReconciliationService.valid_categories.get(item_type, []), indent=2)}

        OUTPUT FORMAT: Return a JSON array of objects matching the input item list length and order.
        Each object should have an "ai_suggestions" field with:
        - "is_duplicate": boolean
        - "duplicate_of": string (name of existing item)
        - "suggested_category": string
        - "reasoning": string (brief explanation)
        - "confidence": float (0.0 to 1.0)

        CRITICAL: Return ONLY the JSON array.
        """
                     
                                                         ^
src/routes/ai_services.py:1482:1: W293 blank line contains whitespace
        prompt = f"""
        TASK: Enhance the following list of imported {item_type} items. 
        Detect hidden duplicates and suggest better categorizations.

        EXISTING {item_type.upper()} ITEMS IN PROFILE:
        {json.dumps(context_existing, indent=2)}

        NEW IMPORTED ITEMS TO PROCESS:
        {json.dumps(items_to_enhance, indent=2)}

        INSTRUCTIONS:
        1. Duplicate Detection: Find items that are clearly the same but have different names (e.g. "MSFT" vs "Microsoft").
        2. Smart Categorization: If an item has category "other" or a vague name, suggest the best specific category from the standard list.
        
        STANDARD CATEGORIES FOR {item_type.upper()}:
        {json.dumps(ReconciliationService.valid_categories.get(item_type, []), indent=2)}

        OUTPUT FORMAT: Return a JSON array of objects matching the input item list length and order.
        Each object should have an "ai_suggestions" field with:
        - "is_duplicate": boolean
        - "duplicate_of": string (name of existing item)
        - "suggested_category": string
        - "reasoning": string (brief explanation)
        - "confidence": float (0.0 to 1.0)

        CRITICAL: Return ONLY the JSON array.
        """
^
src/routes/ai_services.py:1484:80: E501 line too long (89 > 79 characters)
        prompt = f"""
        TASK: Enhance the following list of imported {item_type} items. 
        Detect hidden duplicates and suggest better categorizations.

        EXISTING {item_type.upper()} ITEMS IN PROFILE:
        {json.dumps(context_existing, indent=2)}

        NEW IMPORTED ITEMS TO PROCESS:
        {json.dumps(items_to_enhance, indent=2)}

        INSTRUCTIONS:
        1. Duplicate Detection: Find items that are clearly the same but have different names (e.g. "MSFT" vs "Microsoft").
        2. Smart Categorization: If an item has category "other" or a vague name, suggest the best specific category from the standard list.
        
        STANDARD CATEGORIES FOR {item_type.upper()}:
        {json.dumps(ReconciliationService.valid_categories.get(item_type, []), indent=2)}

        OUTPUT FORMAT: Return a JSON array of objects matching the input item list length and order.
        Each object should have an "ai_suggestions" field with:
        - "is_duplicate": boolean
        - "duplicate_of": string (name of existing item)
        - "suggested_category": string
        - "reasoning": string (brief explanation)
        - "confidence": float (0.0 to 1.0)

        CRITICAL: Return ONLY the JSON array.
        """
                     
                                                         ^
src/routes/ai_services.py:1486:80: E501 line too long (100 > 79 characters)
        prompt = f"""
        TASK: Enhance the following list of imported {item_type} items. 
        Detect hidden duplicates and suggest better categorizations.

        EXISTING {item_type.upper()} ITEMS IN PROFILE:
        {json.dumps(context_existing, indent=2)}

        NEW IMPORTED ITEMS TO PROCESS:
        {json.dumps(items_to_enhance, indent=2)}

        INSTRUCTIONS:
        1. Duplicate Detection: Find items that are clearly the same but have different names (e.g. "MSFT" vs "Microsoft").
        2. Smart Categorization: If an item has category "other" or a vague name, suggest the best specific category from the standard list.
        
        STANDARD CATEGORIES FOR {item_type.upper()}:
        {json.dumps(ReconciliationService.valid_categories.get(item_type, []), indent=2)}

        OUTPUT FORMAT: Return a JSON array of objects matching the input item list length and order.
        Each object should have an "ai_suggestions" field with:
        - "is_duplicate": boolean
        - "duplicate_of": string (name of existing item)
        - "suggested_category": string
        - "reasoning": string (brief explanation)
        - "confidence": float (0.0 to 1.0)

        CRITICAL: Return ONLY the JSON array.
        """
                     
                                                         ^
src/routes/ai_services.py:1501:80: E501 line too long (133 > 79 characters)
            system_prompt=f"You are a financial data reconciliation expert for the RPS system. Process {item_type} data accurately.",
                                                                               ^
src/routes/ai_services.py:1508:80: E501 line too long (81 > 79 characters)
        ai_enhancements = resilient_parse_llm_json(response_text, "enhancements")
                                                                               ^
src/routes/analysis.py:21:80: E501 line too long (94 > 79 characters)
    """Transform frontend asset structure to investment_types format for the retirement model.

    Frontend stores assets as:
        assets.retirement_accounts: [{type: 'traditional_ira', value: X}, ...]
        assets.taxable_accounts: [{type: 'brokerage', value: X}, ...]

    Model expects investment_types as:
        [{account: 'Traditional IRA', value: X, cost_basis: X}, ...]
    """
                                                                               ^
src/routes/analysis.py:32:80: E501 line too long (89 > 79 characters)
    # Mapping from frontend type to backend account names expected by retirement_model.py
                                                                               ^
src/routes/analysis.py:84:80: E501 line too long (82 > 79 characters)
        elif asset_type in ["cryptocurrency", "collectible", "business_interest"]:
                                                                               ^
src/routes/analysis.py:154:80: E501 line too long (80 > 79 characters)
    market_periods: Optional[dict] = None  # New: period-based market conditions
                                                                               ^
src/routes/analysis.py:201:80: E501 line too long (82 > 79 characters)
        children_data = profile_data.get("children") or []  # Handle None children
                                                                               ^
src/routes/analysis.py:228:13: W503 line break before binary operator
            or 0,  # Already monthly
            ^
src/routes/analysis.py:257:13: W503 line break before binary operator
            or 0,  # Already monthly
            ^
src/routes/analysis.py:273:13: W503 line break before binary operator
            or "401" in a.get("type", "").lower()
            ^
src/routes/analysis.py:274:13: W503 line break before binary operator
            or "403" in a.get("type", "").lower()
            ^
src/routes/analysis.py:320:80: E501 line too long (86 > 79 characters)
        # This causes Monte Carlo to think employment income is $0, draining portfolio
                                                                               ^
src/routes/analysis.py:387:80: E501 line too long (85 > 79 characters)
            annual_ira_contribution=financial_data.get("annual_ira_contribution", 0),
                                                                               ^
src/routes/analysis.py:412:80: E501 line too long (93 > 79 characters)
                "description": "30% stocks / 70% bonds - Lower risk, lower expected returns",
                                                                               ^
src/routes/analysis.py:417:80: E501 line too long (84 > 79 characters)
                "description": "60% stocks / 40% bonds - Balanced risk and returns",
                                                                               ^
src/routes/analysis.py:422:80: E501 line too long (95 > 79 characters)
                "description": "80% stocks / 20% bonds - Higher risk, higher expected returns",
                                                                               ^
src/routes/analysis.py:433:80: E501 line too long (80 > 79 characters)
            # (If stocks move from 60% to 30%, we need to scale up other assets)
                                                                               ^
src/routes/analysis.py:446:21: W503 line break before binary operator
                    + current_c
                    ^
src/routes/analysis.py:447:21: W503 line break before binary operator
                    + base_market_kwargs.get("reit_allocation", 0)
                    ^
src/routes/analysis.py:448:21: W503 line break before binary operator
                    + base_market_kwargs.get("gold_allocation", 0)
                    ^
src/routes/analysis.py:449:21: W503 line break before binary operator
                    + base_market_kwargs.get("crypto_allocation", 0)
                    ^
src/routes/analysis.py:473:80: E501 line too long (90 > 79 characters)
                market_periods=data.market_periods,  # Pass period-based market conditions
                                                                               ^
src/routes/analysis.py:486:80: E501 line too long (81 > 79 characters)
            "total_assets": sum(inv.get("value", 0) for inv in investment_types),
                                                                               ^
src/routes/analysis.py:616:13: W503 line break before binary operator
            or "401" in a.get("type", "").lower()
            ^
src/routes/analysis.py:617:13: W503 line break before binary operator
            or "403" in a.get("type", "").lower()
            ^
src/routes/analysis.py:718:80: E501 line too long (85 > 79 characters)
            annual_ira_contribution=financial_data.get("annual_ira_contribution", 0),
                                                                               ^
src/routes/analysis.py:743:80: E501 line too long (84 > 79 characters)
            years=years, assumptions=assumptions, spending_model=data.spending_model
                                                                               ^
src/routes/analysis.py:746:80: E501 line too long (81 > 79 characters)
        response = {"profile_name": data.profile_name, "ledger": detailed_ledger}
                                                                               ^
src/routes/analysis.py:848:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/analysis.py:948:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/analysis.py:1007:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/budget.py:36:13: F401 'copy' imported but unused
            import copy
            ^
src/routes/budget.py:45:80: E501 line too long (98 > 79 characters)
                    # If items are lists, append. If they are objects, convert to list and append.
                                                                               ^
src/routes/budget.py:59:29: W503 line break before binary operator
                            and e.get("amount") == new_item.get("amount")
                            ^
src/routes/events.py:4:1: F401 'flask_login.current_user' imported but unused
from flask_login import login_required, current_user
^
src/routes/events.py:7:1: F401 'datetime.datetime' imported but unused
from datetime import datetime
^
src/routes/events.py:55:80: E501 line too long (81 > 79 characters)
                    {"x": x, "y": y} if x is not None and y is not None else None
                                                                               ^
src/routes/events.py:160:80: E501 line too long (86 > 79 characters)
            # Add human-readable description to details for better logging readability
                                                                               ^
src/routes/events.py:164:80: E501 line too long (83 > 79 characters)
            # Include fingerprint data with first event only (to avoid duplication)
                                                                               ^
src/routes/events.py:244:80: E501 line too long (91 > 79 characters)
    """
    Log session-level events (session start, end, idle, resume).

    Request body:
        event: Event type (start, end, idle, resume, visibility_hidden, visibility_visible)
        duration: Session duration in seconds (for end event)
        idle_time: Time spent idle (for idle event)
        timestamp: Client-side timestamp
        session_analytics: Engagement and activity metrics (optional)
        fingerprint: Browser fingerprint summary (optional)
        full_fingerprint: Complete browser fingerprint (optional, session end only)
        performance: Page performance metrics (optional)
    """
       
                                                                

     ^
src/routes/events.py:250:80: E501 line too long (83 > 79 characters)
    """
    Log session-level events (session start, end, idle, resume).

    Request body:
        event: Event type (start, end, idle, resume, visibility_hidden, visibility_visible)
        duration: Session duration in seconds (for end event)
        idle_time: Time spent idle (for idle event)
        timestamp: Client-side timestamp
        session_analytics: Engagement and activity metrics (optional)
        fingerprint: Browser fingerprint summary (optional)
        full_fingerprint: Complete browser fingerprint (optional, session end only)
        performance: Page performance metrics (optional)
    """
       
                                                                

     ^
src/routes/events.py:304:80: E501 line too long (83 > 79 characters)
            "visibility_hidden": "User switched away from tab or minimized window",
                                                                               ^
src/routes/events.py:313:80: E501 line too long (82 > 79 characters)
            "_description": description_map.get(event, f"Session event: {event}"),
                                                                               ^
src/routes/events.py:327:80: E501 line too long (87 > 79 characters)
                    "total_key_presses": session_analytics.get("total_key_presses", 0),
                                                                               ^
src/routes/events.py:331:80: E501 line too long (85 > 79 characters)
                    "max_scroll_depth": session_analytics.get("max_scroll_depth", 0),
                                                                               ^
src/routes/events.py:335:80: E501 line too long (85 > 79 characters)
                    "engagement_score": session_analytics.get("engagement_score", 0),
                                                                               ^
src/routes/feedback.py:99:80: E501 line too long (93 > 79 characters)
    """
    Submit user feedback (comment, feature request, or bug report).

    Request body:
        type: 'comment', 'feature', or 'bug'
        content: Feedback text (max 10,000 chars)
        browser_info: Optional dict with screen_resolution, viewport_size, timezone, language
        system_info: Optional dict with additional client-side info
    """
       
                                                                   

  ^
src/routes/feedback.py:237:80: E501 line too long (86 > 79 characters)
            details={"type": data.type if "data" in dir() else None, "error": str(e)},
                                                                               ^
src/routes/feedback.py:308:80: E501 line too long (91 > 79 characters)
    query = """
        SELECT f.*, u.username,
            (SELECT COUNT(*) FROM feedback_replies WHERE feedback_id = f.id) as reply_count
        FROM feedback f
        LEFT JOIN users u ON f.user_id = u.id
        WHERE 1=1
    """
               
                               
                               ^
src/routes/feedback.py:354:38: W291 trailing whitespace
            count_query += """
                AND user_id IN (
                    SELECT ug.user_id 
                    FROM user_groups ug
                    JOIN admin_groups ag ON ug.group_id = ag.group_id
                    WHERE ag.user_id = ?
                )
            """
                              
      ^
src/routes/feedback.py:451:80: E501 line too long (83 > 79 characters)
            jsonify({"success": True, "message": "Feedback updated successfully"}),
                                                                               ^
src/routes/feedback.py:472:80: E501 line too long (85 > 79 characters)
            "SELECT content, created_at FROM feedback_content WHERE feedback_id = ?",
                                                                               ^
src/routes/feedback.py:499:80: E501 line too long (81 > 79 characters)
    """Delete feedback (admin only). Content is cascade deleted automatically."""
                                                                               ^
src/routes/feedback.py:520:80: E501 line too long (83 > 79 characters)
            jsonify({"success": True, "message": "Feedback deleted successfully"}),
                                                                               ^
src/routes/feedback.py:546:80: E501 line too long (85 > 79 characters)
    # Build query for current user only - join with content table and add reply count
                                                                               ^
src/routes/feedback.py:549:80: E501 line too long (110 > 79 characters)
    query = """
        SELECT f.*, fc.content,
            (SELECT COUNT(*) FROM feedback_replies WHERE feedback_id = f.id AND is_private = 0) as reply_count
        FROM feedback f
        LEFT JOIN feedback_content fc ON f.id = fc.feedback_id
        WHERE f.user_id = ?
    """
               
                               
                               ^
src/routes/feedback.py:571:80: E501 line too long (80 > 79 characters)
        count_query = "SELECT COUNT(*) as count FROM feedback WHERE user_id = ?"
                                                                               ^
src/routes/feedback.py:586:80: E501 line too long (81 > 79 characters)
            details={"feedback_count": len(feedback_list), "total": total_count},
                                                                               ^
src/routes/feedback.py:604:80: E501 line too long (87 > 79 characters)
            action="VIEW_MY_FEEDBACK_ERROR", details={"error": str(e)}, status_code=500
                                                                               ^
src/routes/feedback.py:628:80: E501 line too long (82 > 79 characters)
        return jsonify({"error": "Content too long (max 10,000 characters)"}), 400
                                                                               ^
src/routes/feedback.py:638:80: E501 line too long (87 > 79 characters)
            cursor.execute("SELECT user_id FROM feedback WHERE id = ?", (feedback_id,))
                                                                               ^
src/routes/feedback.py:675:80: E501 line too long (83 > 79 characters)
            jsonify({"success": True, "message": "Feedback updated successfully"}),
                                                                               ^
src/routes/feedback.py:709:80: E501 line too long (85 > 79 characters)
                return jsonify({"error": "Feedback not found or access denied"}), 404
                                                                               ^
src/routes/feedback.py:719:80: E501 line too long (83 > 79 characters)
            jsonify({"success": True, "message": "Feedback deleted successfully"}),
                                                                               ^
src/routes/feedback.py:764:80: E501 line too long (83 > 79 characters)
                "SELECT user_id, status FROM feedback WHERE id = ?", (feedback_id,)
                                                                               ^
src/routes/feedback.py:783:80: E501 line too long (113 > 79 characters)
            # Check if closed (Admins can reply to closed tickets? Maybe to re-open implicitly or add final note.
                                                                               ^
src/routes/feedback.py:784:80: E501 line too long (124 > 79 characters)
            # But previous requirement said "until closed". Let's stick to strict no-reply if closed unless admin re-opens.)
                                                                               ^
src/routes/feedback.py:785:80: E501 line too long (101 > 79 characters)
            # Actually, standard behavior is usually admins CAN post to closed tickets, users cannot.
                                                                               ^
src/routes/feedback.py:786:80: E501 line too long (112 > 79 characters)
            # But to be safe and consistent with "until closed", let's block everyone unless they open it first.
                                                                               ^
src/routes/feedback.py:789:80: E501 line too long (81 > 79 characters)
                return jsonify({"error": "Cannot reply to closed feedback"}), 400
                                                                               ^
src/routes/feedback.py:797:80: E501 line too long (80 > 79 characters)
            # We use 'admin_id' column to store the replier's ID (legacy naming)
                                                                               ^
src/routes/feedback.py:800:80: E501 line too long (104 > 79 characters)
                """
                INSERT INTO feedback_replies (feedback_id, admin_id, reply_text, is_private, created_at)
                VALUES (?, ?, ?, ?, ?)
            """,
                   
                                                           ^
src/routes/feedback.py:815:80: E501 line too long (85 > 79 characters)
            # If user replied, maybe update status to 'pending' if it was 'reviewed'?
                                                                               ^
src/routes/feedback.py:823:80: E501 line too long (86 > 79 characters)
                (datetime.now().isoformat(), datetime.now().isoformat(), feedback_id),
                                                                               ^
src/routes/feedback.py:921:80: E501 line too long (83 > 79 characters)
            return jsonify({"error": "Reply too long (max 5,000 characters)"}), 400
                                                                               ^
src/routes/feedback.py:942:80: E501 line too long (85 > 79 characters)
                "UPDATE feedback_replies SET " + ", ".join(updates) + " WHERE id = ?"
                                                                               ^
src/routes/feedback.py:951:80: E501 line too long (84 > 79 characters)
                jsonify({"success": True, "message": "Reply updated successfully"}),
                                                                               ^
src/routes/feedback.py:968:80: E501 line too long (84 > 79 characters)
            cursor.execute("DELETE FROM feedback_replies WHERE id = ?", (reply_id,))
                                                                               ^
src/routes/feedback.py:975:80: E501 line too long (84 > 79 characters)
                jsonify({"success": True, "message": "Reply deleted successfully"}),
                                                                               ^
src/routes/feedback.py:1009:80: E501 line too long (81 > 79 characters)
            return jsonify({"error": "Feedback not found or access denied"}), 404
                                                                               ^
src/routes/feedback.py:1027:80: E501 line too long (87 > 79 characters)
        feedback["has_unread_replies"] = len(feedback["replies"]) > 0  # Simple version
                                                                               ^
src/routes/feedback.py:1041:80: E501 line too long (83 > 79 characters)
    """
    Get full feedback thread with ALL replies including private notes (admin only).

    Returns:
        - Feedback details
        - Content
        - All admin replies (both public and private)
    """
       
                                                                       ^
src/routes/feedback.py:1052:80: E501 line too long (86 > 79 characters)
            """
            SELECT f.*, fc.content, u.username as user_username, u.email as user_email
            FROM feedback f
            LEFT JOIN feedback_content fc ON f.id = fc.feedback_id
            LEFT JOIN users u ON f.user_id = u.id
            WHERE f.id = ?
        """,
               
                                                               ^
src/routes/fingerprint.py:67:80: E501 line too long (82 > 79 characters)
            fingerprint_data, ip_geolocation=None  # Could retrieve from audit log
                                                                               ^
src/routes/fingerprint.py:106:80: E501 line too long (88 > 79 characters)
            user_id=user_id if current_user and current_user.is_authenticated else None,
                                                                               ^
src/routes/fingerprint.py:184:80: E501 line too long (85 > 79 characters)
            action="FINGERPRINT_VERIFIED" if exact_match else "FINGERPRINT_MISMATCH",
                                                                               ^
src/routes/profiles.py:15:1: F401 'src.services.encryption_service.get_encryption_service' imported but unused
from src.services.encryption_service import get_encryption_service
^
src/routes/profiles.py:38:80: E501 line too long (92 > 79 characters)
        # Prevent path traversal attacks - reject any path separators or traversal sequences
                                                                               ^
src/routes/profiles.py:40:80: E501 line too long (85 > 79 characters)
            raise ValueError("Profile name cannot contain path traversal characters")
                                                                               ^
src/routes/profiles.py:41:80: E501 line too long (107 > 79 characters)
        # Additional security: only allow alphanumeric, spaces, hyphens, underscores, and basic punctuation
                                                                               ^
src/routes/profiles.py:52:80: E501 line too long (84 > 79 characters)
                raise ValueError("Invalid date format. Use ISO format (YYYY-MM-DD)")
                                                                               ^
src/routes/profiles.py:72:80: E501 line too long (81 > 79 characters)
                raise ValueError("Profile name must be less than 100 characters")
                                                                               ^
src/routes/profiles.py:73:80: E501 line too long (96 > 79 characters)
            # Prevent path traversal attacks - reject any path separators or traversal sequences
                                                                               ^
src/routes/profiles.py:78:80: E501 line too long (111 > 79 characters)
            # Additional security: only allow alphanumeric, spaces, hyphens, underscores, and basic punctuation
                                                                               ^
src/routes/profiles.py:90:80: E501 line too long (84 > 79 characters)
                raise ValueError("Invalid date format. Use ISO format (YYYY-MM-DD)")
                                                                               ^
src/routes/profiles.py:108:80: E501 line too long (84 > 79 characters)
            action="LIST_PROFILES_ERROR", details={"error": str(e)}, status_code=500
                                                                               ^
src/routes/profiles.py:167:80: E501 line too long (83 > 79 characters)
            return jsonify({"error": "Profile with this name already exists"}), 409
                                                                               ^
src/routes/profiles.py:248:80: E501 line too long (84 > 79 characters)
                        jsonify({"error": "Profile with this name already exists"}),
                                                                               ^
src/routes/profiles.py:264:80: E501 line too long (81 > 79 characters)
            # CRITICAL: Preserve existing api_keys - they get masked in to_dict()
                                                                               ^
src/routes/profiles.py:386:80: E501 line too long (84 > 79 characters)
                jsonify({"error": "Profile name must be less than 100 characters"}),
                                                                               ^
src/routes/profiles.py:398:80: E501 line too long (83 > 79 characters)
            return jsonify({"error": "Profile with this name already exists"}), 409
                                                                               ^
src/routes/profiles.py:473:80: E501 line too long (81 > 79 characters)
        asset_count = sum(len(v) for v in assets.values() if isinstance(v, list))
                                                                               ^
src/routes/profiles.py:496:80: E501 line too long (80 > 79 characters)
            headers={"Content-Disposition": f"attachment; filename={filename}"},
                                                                               ^
src/routes/profiles.py:601:80: E501 line too long (80 > 79 characters)
                    "message": f"Successfully imported {imported_count} assets",
                                                                               ^
src/routes/profiles.py:674:80: E501 line too long (85 > 79 characters)
                    "Cannot save masked API key - contains bullet/masking characters"
                                                                               ^
src/routes/profiles.py:708:80: E501 line too long (80 > 79 characters)
                raise ValueError("API key must contain alphanumeric characters")
                                                                               ^
src/routes/profiles.py:711:80: E501 line too long (101 > 79 characters)
            # Note: We can't easily get field name in Pydantic v1 validator, so check format patterns
                                                                               ^
src/routes/profiles.py:715:80: E501 line too long (81 > 79 characters)
                    raise ValueError("Gemini API keys are exactly 39 characters")
                                                                               ^
src/routes/profiles.py:721:17: W503 line break before binary operator
                and not v.startswith("sk-or-")
                ^
src/routes/profiles.py:722:17: W503 line break before binary operator
                and not v.startswith("sk-ant-")
                ^
src/routes/profiles.py:794:80: E501 line too long (80 > 79 characters)
            result["huggingface_api_key"] = api_keys["huggingface_api_key"][-4:]
                                                                               ^
src/routes/profiles.py:809:80: E501 line too long (80 > 79 characters)
            result["preferred_ai_provider"] = data_dict["preferred_ai_provider"]
                                                                               ^
src/routes/profiles.py:877:80: E501 line too long (81 > 79 characters)
            data_dict["api_keys"]["openrouter_api_key"] = data.openrouter_api_key
                                                                               ^
src/routes/profiles.py:889:80: E501 line too long (83 > 79 characters)
            data_dict["api_keys"]["huggingface_api_key"] = data.huggingface_api_key
                                                                               ^
src/routes/profiles.py:910:80: E501 line too long (86 > 79 characters)
        # Save profile (encryption happens automatically via the data property setter)
                                                                               ^
src/routes/profiles.py:922:80: E501 line too long (83 > 79 characters)
            jsonify({"message": "API keys saved successfully", "encrypted": True}),
                                                                               ^
src/routes/profiles.py:948:80: E501 line too long (87 > 79 characters)
                details={"provider": provider, "error": "Missing provider or api_key"},
                                                                               ^
src/routes/profiles.py:954:80: E501 line too long (82 > 79 characters)
            action="TEST_API_KEY", details={"provider": provider}, status_code=200
                                                                               ^
src/routes/profiles.py:1038:80: E501 line too long (92 > 79 characters)
                                "message": f"Claude API key is valid (tested with {model})",
                                                                               ^
src/routes/profiles.py:1046:80: E501 line too long (88 > 79 characters)
                        response.json().get("error", {}).get("message", "Unknown error")
                                                                               ^
src/routes/profiles.py:1078:80: E501 line too long (85 > 79 characters)
            f"https://generativelanguage.googleapis.com/v1beta/models?key={api_key}",
                                                                               ^
src/routes/profiles.py:1097:80: E501 line too long (80 > 79 characters)
                response.json().get("error", {}).get("message", "Unknown error")
                                                                               ^
src/routes/profiles.py:1100:80: E501 line too long (83 > 79 characters)
                jsonify({"success": False, "error": f"API Error: {error_detail}"}),
                                                                               ^
src/routes/profiles.py:1129:80: E501 line too long (88 > 79 characters)
            return jsonify({"success": True, "message": "OpenAI API key is valid"}), 200
                                                                               ^
src/routes/profiles.py:1134:80: E501 line too long (84 > 79 characters)
                    response.json().get("error", {}).get("message", "Unknown error")
                                                                               ^
src/routes/profiles.py:1136:13: E722 do not use bare 'except'
            except:
            ^
src/routes/profiles.py:1138:80: E501 line too long (87 > 79 characters)
            return jsonify({"success": False, "error": f"API Error: {error_msg}"}), 400
                                                                               ^
src/routes/profiles.py:1164:80: E501 line too long (86 > 79 characters)
            return jsonify({"success": True, "message": "Grok API key is valid"}), 200
                                                                               ^
src/routes/profiles.py:1169:80: E501 line too long (84 > 79 characters)
                    response.json().get("error", {}).get("message", "Unknown error")
                                                                               ^
src/routes/profiles.py:1171:13: E722 do not use bare 'except'
            except:
            ^
src/routes/profiles.py:1173:80: E501 line too long (87 > 79 characters)
            return jsonify({"success": False, "error": f"API Error: {error_msg}"}), 400
                                                                               ^
src/routes/profiles.py:1192:80: E501 line too long (85 > 79 characters)
                jsonify({"success": True, "message": "OpenRouter API key is valid"}),
                                                                               ^
src/routes/profiles.py:1197:80: E501 line too long (84 > 79 characters)
                jsonify({"success": False, "error": f"API Error: {response.text}"}),
                                                                               ^
src/routes/profiles.py:1224:80: E501 line too long (83 > 79 characters)
                jsonify({"success": True, "message": "DeepSeek API key is valid"}),
                                                                               ^
src/routes/profiles.py:1229:80: E501 line too long (84 > 79 characters)
                jsonify({"success": False, "error": f"API Error: {response.text}"}),
                                                                               ^
src/routes/profiles.py:1248:80: E501 line too long (82 > 79 characters)
                jsonify({"success": True, "message": "Mistral API key is valid"}),
                                                                               ^
src/routes/profiles.py:1253:80: E501 line too long (84 > 79 characters)
                jsonify({"success": False, "error": f"API Error: {response.text}"}),
                                                                               ^
src/routes/profiles.py:1272:80: E501 line too long (86 > 79 characters)
                jsonify({"success": True, "message": "Together AI API key is valid"}),
                                                                               ^
src/routes/profiles.py:1277:80: E501 line too long (84 > 79 characters)
                jsonify({"success": False, "error": f"API Error: {response.text}"}),
                                                                               ^
src/routes/profiles.py:1296:80: E501 line too long (87 > 79 characters)
                jsonify({"success": True, "message": "Hugging Face API key is valid"}),
                                                                               ^
src/routes/profiles.py:1301:80: E501 line too long (84 > 79 characters)
                jsonify({"success": False, "error": f"API Error: {response.text}"}),
                                                                               ^
src/routes/profiles.py:1331:80: E501 line too long (89 > 79 characters)
                        "message": "Zhipu AI API key is valid (tested with glm-4-flash)",
                                                                               ^
src/routes/profiles.py:1339:80: E501 line too long (86 > 79 characters)
                jsonify({"success": False, "error": f"Zhipu Error: {response.text}"}),
                                                                               ^
src/routes/profiles.py:1359:80: E501 line too long (90 > 79 characters)
                        "message": f"Connected to LM Studio ({len(models)} models found)",
                                                                               ^
src/routes/profiles.py:1376:80: E501 line too long (88 > 79 characters)
        return jsonify({"success": False, "error": f"Connection failed: {str(e)}"}), 400
                                                                               ^
src/routes/profiles.py:1392:80: E501 line too long (88 > 79 characters)
                        "message": f"Connected to LocalAI ({len(models)} models found)",
                                                                               ^
src/routes/profiles.py:1409:80: E501 line too long (88 > 79 characters)
        return jsonify({"success": False, "error": f"Connection failed: {str(e)}"}), 400
                                                                               ^
src/routes/profiles.py:1443:80: E501 line too long (88 > 79 characters)
            return jsonify({"error": f"No {value_type} configured for {provider}"}), 404
                                                                               ^
src/routes/profiles.py:1482:80: E501 line too long (82 > 79 characters)
            details={"provider": provider, "profile_name": name, "error": str(e)},
                                                                               ^
src/routes/profiles.py:1528:80: E501 line too long (84 > 79 characters)
            return jsonify({"message": f"{provider} key deleted successfully"}), 200
                                                                               ^
src/routes/profiles.py:1535:80: E501 line too long (82 > 79 characters)
            details={"provider": provider, "profile_name": name, "error": str(e)},
                                                                               ^
src/routes/profiles.py:1590:80: E501 line too long (87 > 79 characters)
                {"status": "parsing", "progress": 10, "message": "Reading CSV file..."}
                                                                               ^
src/routes/profiles.py:1600:80: E501 line too long (80 > 79 characters)
                        "error": "Not enough transactions (minimum 3 required)",
                                                                               ^
src/routes/profiles.py:1642:80: E501 line too long (80 > 79 characters)
            reconciliation = reconcile_income(specified_income, detected_income)
                                                                               ^
src/routes/profiles.py:1664:80: E501 line too long (80 > 79 characters)
                        "detected_income": [asdict(d) for d in detected_income],
                                                                               ^
src/routes/profiles.py:1670:80: E501 line too long (83 > 79 characters)
                            "matches": [asdict(m) for m in reconciliation.matches],
                                                                               ^
src/routes/profiles.py:1688:80: E501 line too long (82 > 79 characters)
                    "date_range": f"{date_range['start']} to {date_range['end']}",
                                                                               ^
src/routes/profiles.py:1690:21: W503 line break before binary operator
                    + sum(len(e) for e in detected_expenses.values()),
                    ^
src/routes/profiles.py:1698:9: F841 local variable 'e' is assigned to but never used
        except Exception as e:
        ^
src/routes/profiles.py:1704:80: E501 line too long (87 > 79 characters)
                {"status": "error", "error": "Import failed. Please check CSV format."}
                                                                               ^
src/routes/profiles.py:1801:80: E501 line too long (81 > 79 characters)
                data_dict["budget"]["expenses"][period][category].append(expense)
                                                                               ^
src/routes/reports.py:109:80: E501 line too long (88 > 79 characters)
        spouse_data.get("birth_date") if spouse_data.get("birth_date") else "1980-01-01"
                                                                               ^
src/routes/reports.py:146:9: W503 line break before binary operator
        or "401" in a.get("type", "").lower()
        ^
src/routes/reports.py:296:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/reports.py:356:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/reports.py:409:80: E501 line too long (81 > 79 characters)
        pdf_buffer = generate_action_plan_report(profile_data, action_items_list)
                                                                               ^
src/routes/reports.py:434:80: E501 line too long (82 > 79 characters)
                "profile_name": profile_name if "profile_name" in dir() else None,
                                                                               ^
src/routes/roadmap.py:60:80: E501 line too long (148 > 79 characters)
            query += " ORDER BY CASE priority WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 END, created_at DESC"
                                                                               ^
src/routes/roadmap.py:98:80: E501 line too long (83 > 79 characters)
    """Get roadmap items for public viewing - any authenticated user can access."""
                                                                               ^
src/routes/roadmap.py:105:80: E501 line too long (81 > 79 characters)
            query = """
                SELECT id, title, description, category, priority, phase, status,
                       impact, effort, target_version, created_at
                FROM feature_roadmap
                WHERE status != 'cancelled'
                ORDER BY
                    CASE priority WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 END,
                    CASE phase WHEN 'phase1' THEN 1 WHEN 'phase2' THEN 2 WHEN 'phase3' THEN 3 WHEN 'backlog' THEN 4 END,
                    created_at DESC
            """
                       
                                                       ^
src/routes/roadmap.py:110:80: E501 line too long (119 > 79 characters)
            query = """
                SELECT id, title, description, category, priority, phase, status,
                       impact, effort, target_version, created_at
                FROM feature_roadmap
                WHERE status != 'cancelled'
                ORDER BY
                    CASE priority WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 END,
                    CASE phase WHEN 'phase1' THEN 1 WHEN 'phase2' THEN 2 WHEN 'phase3' THEN 3 WHEN 'backlog' THEN 4 END,
                    created_at DESC
            """
                       
                                                       ^
src/routes/roadmap.py:111:80: E501 line too long (120 > 79 characters)
            query = """
                SELECT id, title, description, category, priority, phase, status,
                       impact, effort, target_version, created_at
                FROM feature_roadmap
                WHERE status != 'cancelled'
                ORDER BY
                    CASE priority WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 END,
                    CASE phase WHEN 'phase1' THEN 1 WHEN 'phase2' THEN 2 WHEN 'phase3' THEN 3 WHEN 'backlog' THEN 4 END,
                    created_at DESC
            """
                       
                                                       ^
src/routes/roadmap.py:175:80: E501 line too long (84 > 79 characters)
            cursor.execute("SELECT * FROM feature_roadmap WHERE id = ?", (item_id,))
                                                                               ^
src/routes/roadmap.py:230:80: E501 line too long (87 > 79 characters)
                """
                INSERT INTO feature_roadmap
                (title, description, category, priority, phase, status, impact, effort,
                 target_version, assigned_to, notes, related_items)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            """,
                   
                                           
               ^
src/routes/roadmap.py:253:80: E501 line too long (83 > 79 characters)
            f"Roadmap item created by {current_user.username}: {data.get('title')}"
                                                                               ^
src/routes/roadmap.py:256:80: E501 line too long (85 > 79 characters)
            jsonify({"id": item_id, "message": "Roadmap item created successfully"}),
                                                                               ^
src/routes/roadmap.py:280:80: E501 line too long (85 > 79 characters)
            cursor.execute("SELECT id FROM feature_roadmap WHERE id = ?", (item_id,))
                                                                               ^
src/routes/roadmap.py:326:80: E501 line too long (81 > 79 characters)
        logger.info(f"Roadmap item {item_id} updated by {current_user.username}")
                                                                               ^
src/routes/roadmap.py:347:80: E501 line too long (88 > 79 characters)
            cursor.execute("SELECT title FROM feature_roadmap WHERE id = ?", (item_id,))
                                                                               ^
src/routes/roadmap.py:355:80: E501 line too long (82 > 79 characters)
            cursor.execute("DELETE FROM feature_roadmap WHERE id = ?", (item_id,))
                                                                               ^
src/routes/roadmap.py:358:80: E501 line too long (82 > 79 characters)
            f"Roadmap item {item_id} ({title}) deleted by {current_user.username}"
                                                                               ^
src/routes/scenarios.py:44:80: E501 line too long (82 > 79 characters)
                raise ValueError("Scenario name must be less than 200 characters")
                                                                               ^
src/routes/scenarios.py:58:80: E501 line too long (101 > 79 characters)
            f"Listed {len(scenarios)} scenarios for user {current_user.id} ({current_user.username})"
                                                                               ^
src/routes/scenarios.py:71:80: E501 line too long (85 > 79 characters)
            action="LIST_SCENARIOS_ERROR", details={"error": str(e)}, status_code=500
                                                                               ^
src/routes/scenarios.py:223:80: E501 line too long (87 > 79 characters)
            details={"scenario_name": scenario.name, "updated_fields": updated_fields},
                                                                               ^
src/routes/sitemap.py:21:80: E501 line too long (88 > 79 characters)
    # In a real scenario, this might be dynamically generated from registered blueprints
                                                                               ^
src/routes/sitemap.py:23:80: E501 line too long (86 > 79 characters)
    # For now, we serve the map we just created as the definition of the UI structure.
                                                                               ^
src/routes/sitemap.py:26:80: E501 line too long (91 > 79 characters)
    # src/routes/sitemap.py -> tests/navigation_map.json is ../../tests/navigation_map.json
                                                                               ^
src/routes/skills.py:16:80: E501 line too long (81 > 79 characters)
            os.path.dirname(os.path.dirname(os.path.dirname(__file__))), "skills"
                                                                               ^
src/routes/skills.py:49:80: E501 line too long (81 > 79 characters)
            os.path.dirname(os.path.dirname(os.path.dirname(__file__))), "skills"
                                                                               ^
src/routes/skills.py:54:80: E501 line too long (82 > 79 characters)
        if not os.path.abspath(file_path).startswith(os.path.abspath(skills_dir)):
                                                                               ^
src/routes/tax_optimization.py:8:1: F401 'pydantic.validator' imported but unused
from pydantic import BaseModel, validator
^
src/routes/tax_optimization.py:66:80: E501 line too long (86 > 79 characters)
        filing_status = data.filing_status or tax_settings.get("filing_status", "mfj")
                                                                               ^
src/routes/tax_optimization.py:68:80: E501 line too long (97 > 79 characters)
        # Resolve state with explicit None checks (empty string is valid and should not fallback)
                                                                               ^
src/routes/tax_optimization.py:97:80: E501 line too long (80 > 79 characters)
                spouse_birth = datetime.fromisoformat(spouse_data["birth_date"])
                                                                               ^
src/routes/tax_optimization.py:104:80: E501 line too long (84 > 79 characters)
            filing_status=filing_status, state=state, age=age, spouse_age=spouse_age
                                                                               ^
src/routes/tax_optimization.py:113:9: F401 'traceback' imported but unused
        import traceback
        ^
src/routes/tax_optimization.py:122:80: E501 line too long (91 > 79 characters)
                    "error": "Tax analysis failed. Please check your inputs and try again."
                                                                               ^
src/routes/tax_optimization.py:159:80: E501 line too long (86 > 79 characters)
        filing_status = data.filing_status or tax_settings.get("filing_status", "mfj")
                                                                               ^
src/routes/tax_optimization.py:171:80: E501 line too long (82 > 79 characters)
        service = TaxOptimizationService(filing_status=filing_status, state=state)
                                                                               ^
src/routes/tax_optimization.py:184:13: W503 line break before binary operator
            or "401k" in a.get("type", "").lower()
            ^
src/routes/tax_optimization.py:222:80: E501 line too long (84 > 79 characters)
        ss_benefit = financial.get("social_security_benefit", 0) or 0  # Monthly PIA
                                                                               ^
src/routes/tax_optimization.py:292:80: E501 line too long (82 > 79 characters)
        service = TaxOptimizationService(filing_status=filing_status, state=state)
                                                                               ^
src/routes/tax_optimization.py:379:9: F841 local variable 'years' is assigned to but never used
        years = request.json.get("years", 20)
        ^
src/routes/tax_optimization.py:410:13: W503 line break before binary operator
            or "401k" in a.get("type", "").lower()
            ^
src/routes/user_backups.py:11:80: E501 line too long (80 > 79 characters)
user_backups_bp = Blueprint("user_backups", __name__, url_prefix="/api/backups")
                                                                               ^
src/routes/user_backups.py:44:80: E501 line too long (82 > 79 characters)
            jsonify({"message": "Backup created successfully", "backup": result}),
                                                                               ^
src/routes/user_backups.py:76:80: E501 line too long (82 > 79 characters)
            jsonify({"message": "Data restored successfully", "details": result}),
                                                                               ^
src/scripts/reset_password.py:12:80: E501 line too long (81 > 79 characters)
"""
Reset user password.

Usage:
  ./bin/reset-password <username> <new_password> [--force]

Example:
  ./bin/reset-password admin "MyNewSecurePassword123"
  ./bin/reset-password john "MyNewSecurePassword123" --force

Use --force to skip confirmation when user has encrypted data (data will be lost)
"""
   
                    

      
                                              ^
src/scripts/reset_password.py:68:80: E501 line too long (98 > 79 characters)
            "SELECT id, username, is_active, encrypted_dek, dek_iv FROM users WHERE username = ?",
                                                                               ^
src/scripts/reset_password.py:90:80: E501 line too long (87 > 79 characters)
            print(f"User '{username}' has encrypted data protected by their password.")
                                                                               ^
src/scripts/reset_password.py:119:80: E501 line too long (109 > 79 characters)
                "UPDATE users SET password_hash = ?, encrypted_dek = NULL, dek_iv = NULL WHERE username = ?",
                                                                               ^
src/scripts/reset_password.py:138:80: E501 line too long (82 > 79 characters)
            print(" Note: Profile data was cleared due to encryption key reset.")
                                                                               ^
src/services/action_item_service.py:4:1: F401 'typing.Dict' imported but unused
from typing import List, Dict, Any
^
src/services/action_item_service.py:4:1: F401 'typing.Any' imported but unused
from typing import List, Dict, Any
^
src/services/action_item_service.py:13:80: E501 line too long (81 > 79 characters)
    def generate_for_profile(user_id: int, profile: Profile) -> List[ActionItem]:
                                                                               ^
src/services/action_item_service.py:33:80: E501 line too long (132 > 79 characters)
                        description="Optimize Social Security claiming strategy. Analyze the impact of claiming at 62 vs 67 vs 70.",
                                                                               ^
src/services/action_item_service.py:35:80: E501 line too long (83 > 79 characters)
                        due_date=(datetime.now() + timedelta(days=90)).isoformat(),
                                                                               ^
src/services/action_item_service.py:46:80: E501 line too long (117 > 79 characters)
                        description="Research Medicare options and supplement plans. Plan for enrollment at age 65.",
                                                                               ^
src/services/action_item_service.py:48:80: E501 line too long (83 > 79 characters)
                        due_date=(datetime.now() + timedelta(days=60)).isoformat(),
                                                                               ^
src/services/action_item_service.py:59:80: E501 line too long (108 > 79 characters)
                        description="Take advantage of catch-up contributions for 401(k) and IRA accounts.",
                                                                               ^
src/services/action_item_service.py:81:80: E501 line too long (168 > 79 characters)
                        description=f"Build emergency fund to at least 3-6 months of expenses (${int(monthly_expenses * 6):,}). Currently have ${int(total_liquid):,}.",
                                                                               ^
src/services/action_item_service.py:96:80: E501 line too long (152 > 79 characters)
                    description="Review and update estate planning documents (Will, Power of Attorney, Healthcare Proxy) and beneficiary designations.",
                                                                               ^
src/services/action_item_service.py:109:80: E501 line too long (104 > 79 characters)
                        description="Review college savings strategies (e.g., 529 plans) for children.",
                                                                               ^
src/services/action_item_service.py:126:80: E501 line too long (161 > 79 characters)
                    description="High net worth detected. Consider advanced tax optimization strategies like tax-loss harvesting or charitable giving vehicles.",
                                                                               ^
src/services/action_item_service.py:138:80: E501 line too long (134 > 79 characters)
                    description="Consider setting up a revocable living trust to avoid probate and streamline estate administration.",
                                                                               ^
src/services/action_item_service.py:140:80: E501 line too long (80 > 79 characters)
                    due_date=(datetime.now() + timedelta(days=180)).isoformat(),
                                                                               ^
src/services/action_item_service.py:151:80: E501 line too long (181 > 79 characters)
                    description="Estate may be subject to federal estate taxes. Consult with estate planning attorney about advanced strategies (ILIT, GRATs, family partnerships).",
                                                                               ^
src/services/action_item_service.py:164:80: E501 line too long (171 > 79 characters)
                    description="Review annual gifting strategy. You can gift up to $18,000 per recipient ($36,000 for married couples) without using lifetime exemption.",
                                                                               ^
src/services/action_item_service.py:176:80: E501 line too long (162 > 79 characters)
                    description="Review beneficiary designations on retirement accounts. Consider naming a trust or using conduit trust for minor beneficiaries.",
                                                                               ^
src/services/action_item_service.py:178:80: E501 line too long (80 > 79 characters)
                    due_date=(datetime.now() + timedelta(days=120)).isoformat(),
                                                                               ^
src/services/action_item_service.py:184:80: E501 line too long (87 > 79 characters)
            age = (datetime.now() - datetime.fromisoformat(birth_date_str)).days // 365
                                                                               ^
src/services/action_item_service.py:191:80: E501 line too long (180 > 79 characters)
                        description="Plan for Required Minimum Distributions (RMDs) starting at age 73. Consider Qualified Charitable Distributions (QCDs) if charitably inclined.",
                                                                               ^
src/services/action_item_service.py:193:80: E501 line too long (83 > 79 characters)
                        due_date=(datetime.now() + timedelta(days=90)).isoformat(),
                                                                               ^
src/services/action_item_service.py:204:80: E501 line too long (142 > 79 characters)
                    description="Consider establishing a donor-advised fund (DAF) or private foundation for tax-efficient charitable giving.",
                                                                               ^
src/services/action_item_service.py:216:80: E501 line too long (162 > 79 characters)
                    description="Review life insurance policies. Consider Irrevocable Life Insurance Trust (ILIT) to remove policy proceeds from taxable estate.",
                                                                               ^
src/services/action_item_service.py:228:80: E501 line too long (187 > 79 characters)
                    description="Review real estate holdings and consider step-up in basis planning. Discuss transfer strategies (TOD deed, trust, joint ownership) with estate attorney.",
                                                                               ^
src/services/action_item_service.py:241:80: E501 line too long (170 > 79 characters)
                    description="If you own a business, ensure business succession plan is documented and funded. Consider buy-sell agreements and key person insurance.",
                                                                               ^
src/services/action_item_service.py:243:80: E501 line too long (80 > 79 characters)
                    due_date=(datetime.now() + timedelta(days=180)).isoformat(),
                                                                               ^
src/services/action_item_service.py:249:80: E501 line too long (87 > 79 characters)
            age = (datetime.now() - datetime.fromisoformat(birth_date_str)).days // 365
                                                                               ^
src/services/action_item_service.py:256:80: E501 line too long (155 > 79 characters)
                        description="Ensure healthcare directives are in place: Living Will, Healthcare Power of Attorney, and HIPAA authorization forms.",
                                                                               ^
src/services/action_item_service.py:258:80: E501 line too long (83 > 79 characters)
                        due_date=(datetime.now() + timedelta(days=90)).isoformat(),
                                                                               ^
src/services/action_item_service.py:269:80: E501 line too long (163 > 79 characters)
                    description="Create digital asset inventory and include access instructions in estate plan (online accounts, cryptocurrencies, social media).",
                                                                               ^
src/services/action_item_service.py:281:80: E501 line too long (176 > 79 characters)
                    description="Check state estate tax thresholds for your state. Some states have exemptions as low as $1M. Consider state residency planning if applicable.",
                                                                               ^
src/services/action_item_service.py:288:80: E501 line too long (87 > 79 characters)
            age = (datetime.now() - datetime.fromisoformat(birth_date_str)).days // 365
                                                                               ^
src/services/action_item_service.py:295:80: E501 line too long (189 > 79 characters)
                        description="Analyze Roth conversion opportunities before RMDs begin. Multi-year conversion strategy could reduce lifetime taxes and increase tax-free inheritance.",
                                                                               ^
src/services/action_item_service.py:297:80: E501 line too long (84 > 79 characters)
                        due_date=(datetime.now() + timedelta(days=120)).isoformat(),
                                                                               ^
src/services/action_item_service.py:301:80: E501 line too long (84 > 79 characters)
        # 5. Default "Missing Data" items (The "Fix Wizard" logic can also use this)
                                                                               ^
src/services/action_item_service.py:308:80: E501 line too long (124 > 79 characters)
                    description="Complete your expense profile in the Budget tab for more accurate retirement projections.",
                                                                               ^
src/services/action_item_service.py:317:80: E501 line too long (88 > 79 characters)
        """Generate and save items if they don't already exist (avoiding duplicates)."""
                                                                               ^
src/services/asset_service.py:1:80: E501 line too long (83 > 79 characters)
"""Asset management service for profile data synchronization and CSV operations."""
                                                                               ^
src/services/asset_service.py:5:1: F401 'typing.Dict' imported but unused
from typing import Dict, List, Any
^
src/services/asset_service.py:5:1: F401 'typing.List' imported but unused
from typing import Dict, List, Any
^
src/services/asset_service.py:5:1: F401 'typing.Any' imported but unused
from typing import Dict, List, Any
^
src/services/asset_service.py:11:80: E501 line too long (87 > 79 characters)
    """
    Synchronize new assets structure to legacy investment_types/home_properties arrays.
    Maintains backward compatibility with v1 model.

    Args:
        data: Profile data dictionary

    Returns:
        Updated data dictionary with synced legacy arrays
    """
       
                                                                       ^
src/services/asset_service.py:61:80: E501 line too long (86 > 79 characters)
                "current_value": prop.get("value", 0) or prop.get("current_value", 0),
                                                                               ^
src/services/asset_service.py:193:80: E501 line too long (80 > 79 characters)
                "true" if pension.get("inflation_adjusted", False) else "false",
                                                                               ^
src/services/asset_service.py:249:80: E501 line too long (84 > 79 characters)
        raise ValueError(f"CSV must contain columns: {', '.join(required_columns)}")
                                                                               ^
src/services/asset_service.py:266:80: E501 line too long (80 > 79 characters)
                        "account_number": row.get("account_number", "").strip(),
                                                                               ^
src/services/asset_service.py:283:80: E501 line too long (80 > 79 characters)
                        "account_number": row.get("account_number", "").strip(),
                                                                               ^
src/services/asset_service.py:301:80: E501 line too long (87 > 79 characters)
                        "mortgage_balance": float(row.get("mortgage_balance", 0) or 0),
                                                                               ^
src/services/asset_service.py:315:80: E501 line too long (85 > 79 characters)
                        "monthly_benefit": float(row.get("monthly_benefit", 0) or 0),
                                                                               ^
src/services/asset_service.py:317:80: E501 line too long (87 > 79 characters)
                        "inflation_adjusted": row.get("inflation_adjusted", "").lower()
                                                                               ^
src/services/asset_service.py:318:25: W503 line break before binary operator
                        == "true",
                        ^
src/services/asset_service.py:337:80: E501 line too long (83 > 79 characters)
                raise ValueError(f"Invalid category '{category}' at row {row_num}")
                                                                               ^
src/services/asset_service.py:357:80: E501 line too long (85 > 79 characters)
        "retirement_accounts": existing_assets.get("retirement_accounts", []).copy(),
                                                                               ^
src/services/asset_service.py:360:80: E501 line too long (83 > 79 characters)
        "pensions_annuities": existing_assets.get("pensions_annuities", []).copy(),
                                                                               ^
src/services/audit_narrative_generator.py:63:80: E501 line too long (85 > 79 characters)
            "narrative": AuditNarrativeGenerator._format_narrative(narrative_events),
                                                                               ^
src/services/audit_narrative_generator.py:69:80: E501 line too long (84 > 79 characters)
        user_id: int, start_date: Optional[str], end_date: Optional[str], limit: int
                                                                               ^
src/services/audit_narrative_generator.py:121:80: E501 line too long (86 > 79 characters)
                details_dict = json.loads(details) if isinstance(details, str) else {}
                                                                               ^
src/services/audit_narrative_generator.py:122:13: E722 do not use bare 'except'
            except:
            ^
src/services/audit_narrative_generator.py:149:80: E501 line too long (87 > 79 characters)
                "context": AuditNarrativeGenerator._extract_context(log, details_dict),
                                                                               ^
src/services/audit_narrative_generator.py:188:80: E501 line too long (88 > 79 characters)
            profile_name = details.get("name") or details.get("profile_name", "profile")
                                                                               ^
src/services/audit_narrative_generator.py:222:80: E501 line too long (87 > 79 characters)
                return f"Ran Monte Carlo analysis for {profile_name} - {scenario_name}"
                                                                               ^
src/services/audit_narrative_generator.py:239:80: E501 line too long (94 > 79 characters)
                return f"Updated {asset_name} balance from ${old_val:,.2f} to ${new_val:,.2f}"
                                                                               ^
src/services/audit_narrative_generator.py:275:80: E501 line too long (86 > 79 characters)
            interactive_type = details.get("interactive_type", details.get("tag", ""))
                                                                               ^
src/services/audit_narrative_generator.py:288:80: E501 line too long (82 > 79 characters)
            form_name = details.get("form_name") or details.get("form_id", "form")
                                                                               ^
src/services/audit_narrative_generator.py:340:80: E501 line too long (81 > 79 characters)
            endpoint = details.get("endpoint") or log.get("request_endpoint", "")
                                                                               ^
src/services/audit_narrative_generator.py:346:21: F841 local variable 'resource' is assigned to but never used
                    resource = parts[2] if len(parts) > 2 else "API"
                    ^
src/services/audit_narrative_generator.py:413:13: E722 do not use bare 'except'
            except:
            ^
src/services/audit_narrative_generator.py:431:13: E722 do not use bare 'except'
            except:
            ^
src/services/audit_narrative_generator.py:460:80: E501 line too long (84 > 79 characters)
        if action_counts.get("LOGIN_SUCCESS") or action_counts.get("LOGIN_ATTEMPT"):
                                                                               ^
src/services/audit_narrative_generator.py:461:80: E501 line too long (84 > 79 characters)
            login_count = action_counts.get("LOGIN_SUCCESS", 0) + action_counts.get(
                                                                               ^
src/services/audit_narrative_generator.py:473:80: E501 line too long (81 > 79 characters)
            highlights.append(f"{action_counts['RUN_ANALYSIS']} analysis run(s)")
                                                                               ^
src/services/audit_narrative_generator.py:495:13: E722 do not use bare 'except'
            except:
            ^
src/services/audit_narrative_generator.py:504:80: E501 line too long (85 > 79 characters)
            narrative_parts.append(f"{connector}{description.lower()} at {time_str}")
                                                                               ^
src/services/email_service.py:36:80: E501 line too long (81 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">Welcome to RPS!</h2>
                <p>Please verify your email address to activate your account.</p>
                <div style="text-align: center; margin: 30px 0;">
                    <a href="{verification_link}" style="background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;">Verify Email</a>
                </div>
                <p>Or paste this link: <br><code>{verification_link}</code></p>
                <p>This link expires in 24 hours.</p>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:38:80: E501 line too long (191 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">Welcome to RPS!</h2>
                <p>Please verify your email address to activate your account.</p>
                <div style="text-align: center; margin: 30px 0;">
                    <a href="{verification_link}" style="background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;">Verify Email</a>
                </div>
                <p>Or paste this link: <br><code>{verification_link}</code></p>
                <p>This link expires in 24 hours.</p>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:47:80: E501 line too long (121 > 79 characters)
        text_body = f"Welcome to RPS!\n\nPlease verify your email: {verification_link}\n\nThis link expires in 24 hours."
                                                                               ^
src/services/email_service.py:52:80: E501 line too long (83 > 79 characters)
                subject=subject, recipients=[email], html=html_body, body=text_body
                                                                               ^
src/services/email_service.py:64:80: E501 line too long (86 > 79 characters)
                sender = current_app.config.get("MAIL_DEFAULT_SENDER", "rps@pan2.app")
                                                                               ^
src/services/email_service.py:82:80: E501 line too long (80 > 79 characters)
    def send_password_reset_email(email: str, token: str, base_url: str = None):
                                                                               ^
src/services/email_service.py:110:80: E501 line too long (126 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:183:80: E501 line too long (92 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:188:80: E501 line too long (80 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:197:80: E501 line too long (108 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:200:80: E501 line too long (270 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:202:80: E501 line too long (140 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:206:80: E501 line too long (90 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 20px;
                }}
                .container {{
                    background: #ffffff;
                    border-radius: 8px;
                    padding: 30px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }}
                .header {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                .header h1 {{
                    color: #2563eb;
                    margin: 0;
                    font-size: 24px;
                }}
                .content {{
                    margin-bottom: 30px;
                }}
                .button {{
                    display: inline-block;
                    background: #2563eb;
                    color: #ffffff !important;
                    text-decoration: none;
                    padding: 12px 30px;
                    border-radius: 6px;
                    font-weight: 600;
                    text-align: center;
                }}
                .button:hover {{
                    background: #1d4ed8;
                }}
                .footer {{
                    margin-top: 30px;
                    padding-top: 20px;
                    border-top: 1px solid #e5e7eb;
                    font-size: 14px;
                    color: #6b7280;
                    text-align: center;
                }}
                .warning {{
                    background: #fef3c7;
                    border-left: 4px solid #f59e0b;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }}
                .token-info {{
                    background: #f3f4f6;
                    padding: 15px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 14px;
                    margin: 15px 0;
                    word-break: break-all;
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1> Password Reset Request</h1>
                </div>

                <div class="content">
                    <p>Hello,</p>

                    <p>We received a request to reset the password for your RPS account.</p>

                    <p>Click the button below to reset your password:</p>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="{reset_link}" class="button">Reset Password</a>
                    </div>

                    <p>Or copy and paste this link into your browser:</p>
                    <div class="token-info">
                        {reset_link}
                    </div>

                    <div class="warning">
                        <strong> Important:</strong> This link will expire in 1 hour for security reasons.
                    </div>

                    <p><strong>Note:</strong> Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data <strong>UNLESS</strong> you use a Recovery Code or have previously enabled email-based backup.</p>

                    <p>If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.</p>
                </div>

                <div class="footer">
                    <p>This is an automated email from RPS Retirement Planning System.</p>
                    <p>Please do not reply to this email.</p>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
              
^
src/services/email_service.py:225:80: E501 line too long (222 > 79 characters)
        text_body = f"""
        Password Reset Request

        We received a request to reset the password for your RPS account.

        Click the link below to reset your password:
        {reset_link}

        This link will expire in 1 hour for security reasons.

        IMPORTANT: Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data UNLESS you use a Recovery Code or have previously enabled email-based backup.

        If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.

        ---
        This is an automated email from RPS Retirement Planning System.
        Please do not reply to this email.
        """
                        
                              

                      ^
src/services/email_service.py:227:80: E501 line too long (121 > 79 characters)
        text_body = f"""
        Password Reset Request

        We received a request to reset the password for your RPS account.

        Click the link below to reset your password:
        {reset_link}

        This link will expire in 1 hour for security reasons.

        IMPORTANT: Because RPS uses end-to-end encryption, resetting your password via email will permanently delete your encrypted profile data UNLESS you use a Recovery Code or have previously enabled email-based backup.

        If you didn't request this password reset, you can safely ignore this email. Your password will remain unchanged.

        ---
        This is an automated email from RPS Retirement Planning System.
        Please do not reply to this email.
        """
                        
                              

                      ^
src/services/email_service.py:237:80: E501 line too long (83 > 79 characters)
                subject=subject, recipients=[email], html=html_body, body=text_body
                                                                               ^
src/services/email_service.py:245:80: E501 line too long (84 > 79 characters)
            # This bypasses SMTP/TLS issues common with local Postfix configurations
                                                                               ^
src/services/email_service.py:274:80: E501 line too long (83 > 79 characters)
                    stdout, stderr = process.communicate(input=mime_msg.as_bytes())
                                                                               ^
src/services/email_service.py:296:9: E722 do not use bare 'except'
        except:
        ^
src/services/email_service.py:300:80: E501 line too long (87 > 79 characters)
    def send_new_account_notification(username: str, email: str, base_url: str = None):
                                                                               ^
src/services/email_service.py:324:80: E501 line too long (84 > 79 characters)
            print("No super admins configured to receive new account notifications")
                                                                               ^
src/services/email_service.py:339:80: E501 line too long (117 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:340:80: E501 line too long (99 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:343:80: E501 line too long (114 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:344:80: E501 line too long (96 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:347:80: E501 line too long (82 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:352:80: E501 line too long (111 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:354:80: E501 line too long (97 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:355:80: E501 line too long (119 > 79 characters)
        html_body = f"""
        <!DOCTYPE html>
        <html>
        <body style="font-family: sans-serif; line-height: 1.6; color: #333;">
            <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                <h2 style="color: #2563eb;">New Account Created</h2>
                <p>A new user has registered on RPS:</p>
                <table style="border-collapse: collapse; margin: 20px 0;">
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Username:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{username}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid #e5e7eb;">Email:</td>
                        <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">{email}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; font-weight: bold;">Created:</td>
                        <td style="padding: 8px;">{created_at}</td>
                    </tr>
                </table>
                <p style="color: #6b7280; font-size: 14px;">
                    This is an automated notification. The user must verify their email before they can log in.
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <a href="{base_url}/admin.html" style="color: #2563eb; text-decoration: none;">View Admin Panel</a>
                </div>
            </div>
        </body>
        </html>
        """
                        
                       
              
               ^
src/services/email_service.py:370:80: E501 line too long (91 > 79 characters)
        text_body = f"""New Account Created

A new user has registered on RPS:

Username: {username}
Email: {email}
Created: {created_at}

This is an automated notification. The user must verify their email before they can log in.

Admin Panel: {base_url}/admin.html
"""
                                           

                                 
^
src/services/encryption_service.py:18:80: E501 line too long (81 > 79 characters)
    """Service for encrypting and decrypting sensitive data using AES-256-GCM."""
                                                                               ^
src/services/encryption_service.py:25:80: E501 line too long (86 > 79 characters)
        """
        Initialize encryption service with a key.

        Args:
            key: 32-byte encryption key. If None, derives from ENCRYPTION_KEY env var.
        """
           
                                                 

             
  ^
src/services/encryption_service.py:97:80: E501 line too long (82 > 79 characters)
    def get_email_kek(email: str, salt: bytes, iterations: int = 600000) -> bytes:
                                                                               ^
src/services/encryption_service.py:100:80: E501 line too long (93 > 79 characters)
        """Derive a Key Encryption Key (KEK) from an email address.

        Uses a server-side pepper to prevent offline brute-force attacks if the DB is leaked.
        """
                                                                   

          ^
src/services/encryption_service.py:164:80: E501 line too long (83 > 79 characters)
            plaintext_bytes = self.aesgcm.decrypt(iv_bytes, ciphertext_bytes, None)
                                                                               ^
src/services/encryption_service.py:273:80: E501 line too long (86 > 79 characters)
    """Decrypt ciphertext using global or session-based service.
    Attempts session-based first, then falls back to global if session-based fails."""
                                                                
              ^
src/services/encryption_service.py:278:80: E501 line too long (83 > 79 characters)
        # If decryption failed and we were using a user key, try fallback to global
                                                                               ^
src/services/enhanced_audit_logger.py:9:1: F401 're' imported but unused
import re
^
src/services/enhanced_audit_logger.py:38:80: E501 line too long (96 > 79 characters)
            "request_headers": False,  # Privacy: off by default (CF metadata stored regardless)
                                                                               ^
src/services/enhanced_audit_logger.py:48:80: E501 line too long (87 > 79 characters)
            "cloudflare_metadata": True,  # CF-Ray, CF-IPCountry, CF-Cache-Status, etc.
                                                                               ^
src/services/enhanced_audit_logger.py:49:80: E501 line too long (85 > 79 characters)
            "browser_fingerprint": True,  # Language, encoding, screen size, timezone
                                                                               ^
src/services/enhanced_audit_logger.py:50:80: E501 line too long (95 > 79 characters)
            "risk_scoring": True,  # Security risk assessment (bot detection, automation tools)
                                                                               ^
src/services/enhanced_audit_logger.py:51:80: E501 line too long (80 > 79 characters)
            "session_metadata": True,  # Session age, size, authentication state
                                                                               ^
src/services/enhanced_audit_logger.py:52:80: E501 line too long (85 > 79 characters)
            "ip_intelligence": True,  # IP analysis, VPN/proxy detection, reverse DNS
                                                                               ^
src/services/enhanced_audit_logger.py:53:80: E501 line too long (80 > 79 characters)
            "client_hints": True,  # Sec-CH-UA headers for detailed browser info
                                                                               ^
src/services/enhanced_audit_logger.py:55:80: E501 line too long (88 > 79 characters)
            "client_fingerprint": True,  # Canvas, WebGL, audio fingerprints from client
                                                                               ^
src/services/enhanced_audit_logger.py:56:80: E501 line too long (80 > 79 characters)
            "session_analytics": True,  # Engagement score, scroll depth, clicks
                                                                               ^
src/services/enhanced_audit_logger.py:58:80: E501 line too long (80 > 79 characters)
            "reverse_dns": True,  # Reverse DNS hostname lookup for IP addresses
                                                                               ^
src/services/enhanced_audit_logger.py:110:80: E501 line too long (85 > 79 characters)
            row = db.execute_one("SELECT config_data FROM audit_config WHERE id = 1")
                                                                               ^
src/services/enhanced_audit_logger.py:125:80: E501 line too long (81 > 79 characters)
                """
                INSERT OR REPLACE INTO audit_config (id, config_data, updated_at)
                VALUES (1, ?, ?)
            """,
                   
                                                           ^
src/services/enhanced_audit_logger.py:170:80: E501 line too long (129 > 79 characters)
                f"http://ip-api.com/json/{ip_address}?fields=status,country,countryCode,region,regionName,city,timezone,lat,lon",
                                                                               ^
src/services/enhanced_audit_logger.py:191:9: F841 local variable 'e' is assigned to but never used
        except Exception as e:
        ^
src/services/enhanced_audit_logger.py:224:80: E501 line too long (84 > 79 characters)
            _dns_cache[ip_address] = {"data": hostname, "timestamp": datetime.now()}
                                                                               ^
src/services/enhanced_audit_logger.py:226:80: E501 line too long (85 > 79 characters)
        except (dns.resolver.NXDOMAIN, dns.resolver.NoAnswer, dns.exception.Timeout):
                                                                               ^
src/services/enhanced_audit_logger.py:235:80: E501 line too long (84 > 79 characters)
            _dns_cache[ip_address] = {"data": hostname, "timestamp": datetime.now()}
                                                                               ^
src/services/enhanced_audit_logger.py:245:80: E501 line too long (81 > 79 characters)
        """
        Get ASN (Autonomous System Number) and ISP information for an IP address.
        This provides network ownership and routing information.

        Note: Requires ASN database file which may not be available.
        Falls back gracefully if database is not present.
        """
           
                                                                   ^
src/services/enhanced_audit_logger.py:259:80: E501 line too long (87 > 79 characters)
                f"http://ip-api.com/json/{ip_address}?fields=status,as,isp,org,asname",
                                                                               ^
src/services/enhanced_audit_logger.py:266:80: E501 line too long (86 > 79 characters)
                        "as": data.get("as", "Unknown"),  # e.g., "AS15169 Google LLC"
                                                                               ^
src/services/enhanced_audit_logger.py:272:80: E501 line too long (83 > 79 characters)
                    # Extract ASN number from 'as' field (e.g., "AS15169" -> 15169)
                                                                               ^
src/services/enhanced_audit_logger.py:276:80: E501 line too long (81 > 79 characters)
                            asn_data["asn_number"] = int(as_field.split()[0][2:])
                                                                               ^
src/services/enhanced_audit_logger.py:334:80: E501 line too long (80 > 79 characters)
            metadata["server_software"] = request.environ.get("SERVER_SOFTWARE")
                                                                               ^
src/services/enhanced_audit_logger.py:338:80: E501 line too long (80 > 79 characters)
            metadata["server_protocol"] = request.environ.get("SERVER_PROTOCOL")
                                                                               ^
src/services/enhanced_audit_logger.py:473:80: E501 line too long (85 > 79 characters)
        """
        Extract Cloudflare-specific metadata from request headers.

        Returns dict with Cloudflare metadata if headers are present, None otherwise.
        Cloudflare provides valuable tracking data in custom headers.
        """
           
                                                                  
^
src/services/enhanced_audit_logger.py:498:80: E501 line too long (80 > 79 characters)
                cf_metadata["cf_scheme"] = visitor_data.get("scheme", "unknown")
                                                                               ^
src/services/enhanced_audit_logger.py:499:13: E722 do not use bare 'except'
            except:
            ^
src/services/enhanced_audit_logger.py:547:80: E501 line too long (87 > 79 characters)
                accept_language.split(",")[0].strip() if accept_language else "unknown"
                                                                               ^
src/services/enhanced_audit_logger.py:552:80: E501 line too long (85 > 79 characters)
                lang.split(";")[0].strip() for lang in accept_language.split(",")[:5]
                                                                               ^
src/services/enhanced_audit_logger.py:566:80: E501 line too long (80 > 79 characters)
        fingerprint["connection_type"] = connection if connection else "unknown"
                                                                               ^
src/services/enhanced_audit_logger.py:580:80: E501 line too long (80 > 79 characters)
            fingerprint["screen_resolution"] = f"{screen_width}x{screen_height}"
                                                                               ^
src/services/enhanced_audit_logger.py:605:80: E501 line too long (80 > 79 characters)
            fingerprint["viewport_size"] = f"{viewport_width}x{viewport_height}"
                                                                               ^
src/services/enhanced_audit_logger.py:639:80: E501 line too long (80 > 79 characters)
            fingerprint["client_hints_platform"] = sec_ch_ua_platform.strip('"')
                                                                               ^
src/services/enhanced_audit_logger.py:710:13: W503 line break before binary operator
            or ip_address.startswith("192.168.")
            ^
src/services/enhanced_audit_logger.py:711:13: W503 line break before binary operator
            or ip_address.startswith("10.")
            ^
src/services/enhanced_audit_logger.py:717:80: E501 line too long (80 > 79 characters)
        # This is a simplified check - production would use a Tor exit node list
                                                                               ^
src/services/enhanced_audit_logger.py:718:80: E501 line too long (82 > 79 characters)
        if any(indicator in user_agent.lower() for indicator in ["tor", "onion"]):
                                                                               ^
src/services/enhanced_audit_logger.py:732:80: E501 line too long (81 > 79 characters)
        if any(keyword in user_agent.lower() for keyword in automation_keywords):
                                                                               ^
src/services/enhanced_audit_logger.py:845:80: E501 line too long (88 > 79 characters)
                client_hints[key] = value.strip('"') if value.startswith('"') else value
                                                                               ^
src/services/enhanced_audit_logger.py:869:80: E501 line too long (80 > 79 characters)
            info["protocol"] = request.environ.get("SERVER_PROTOCOL", "unknown")
                                                                               ^
src/services/enhanced_audit_logger.py:895:80: E501 line too long (86 > 79 characters)
        """
        Log an audit event with comprehensive data collection.

        Args:
            action: Type of action (CREATE, READ, UPDATE, DELETE, LOGIN, LOGOUT, etc.)
            table_name: Name of the table affected (if applicable)
            record_id: ID of the record affected (if applicable)
            user_id: ID of the user performing the action
            details: Additional details about the action (string or dict)
            status_code: HTTP status code of the response
            error_message: Error message if action failed
        """
           
                                                              

   ^
src/services/enhanced_audit_logger.py:942:80: E501 line too long (80 > 79 characters)
            audit_data["ip_address"] = EnhancedAuditLogger._get_real_client_ip()
                                                                               ^
src/services/enhanced_audit_logger.py:957:80: E501 line too long (87 > 79 characters)
                device_info = EnhancedAuditLogger._parse_device_info(user_agent_string)
                                                                               ^
src/services/enhanced_audit_logger.py:961:80: E501 line too long (85 > 79 characters)
        if collect_config.get("geo_location", True) and audit_data.get("ip_address"):
                                                                               ^
src/services/enhanced_audit_logger.py:962:80: E501 line too long (86 > 79 characters)
            geo_data = EnhancedAuditLogger._get_geo_location(audit_data["ip_address"])
                                                                               ^
src/services/enhanced_audit_logger.py:972:80: E501 line too long (88 > 79 characters)
        if collect_config.get("ip_intelligence", True) and audit_data.get("ip_address"):
                                                                               ^
src/services/enhanced_audit_logger.py:979:80: E501 line too long (88 > 79 characters)
            ip_intel_data = {"ip_analysis": ip_analysis, "vpn_detection": vpn_detection}
                                                                               ^
src/services/enhanced_audit_logger.py:992:80: E501 line too long (86 > 79 characters)
                asn_info = EnhancedAuditLogger._get_asn_info(audit_data["ip_address"])
                                                                               ^
src/services/enhanced_audit_logger.py:1006:17: E722 do not use bare 'except'
                except:
                ^
src/services/enhanced_audit_logger.py:1009:80: E501 line too long (86 > 79 characters)
                audit_data["details"] = json.dumps({"ip_intelligence": ip_intel_data})
                                                                               ^
src/services/enhanced_audit_logger.py:1025:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1028:80: E501 line too long (81 > 79 characters)
                    audit_data["details"] = json.dumps({"network": network_meta})
                                                                               ^
src/services/enhanced_audit_logger.py:1043:80: E501 line too long (82 > 79 characters)
                audit_data["request_size"] = request_info.get("content_length", 0)
                                                                               ^
src/services/enhanced_audit_logger.py:1050:80: E501 line too long (96 > 79 characters)
                # Always include Cloudflare metadata in headers (even if request_headers is off)
                                                                               ^
src/services/enhanced_audit_logger.py:1058:80: E501 line too long (87 > 79 characters)
                audit_data["request_headers"] = json.dumps({"cloudflare": cf_metadata})
                                                                               ^
src/services/enhanced_audit_logger.py:1067:80: E501 line too long (84 > 79 characters)
                        existing_device_info = json.loads(audit_data["device_info"])
                                                                               ^
src/services/enhanced_audit_logger.py:1069:80: E501 line too long (84 > 79 characters)
                        audit_data["device_info"] = json.dumps(existing_device_info)
                                                                               ^
src/services/enhanced_audit_logger.py:1070:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1073:80: E501 line too long (88 > 79 characters)
                    audit_data["device_info"] = json.dumps({"fingerprint": fingerprint})
                                                                               ^
src/services/enhanced_audit_logger.py:1075:80: E501 line too long (84 > 79 characters)
                # Extract key fingerprint values into dedicated columns for indexing
                                                                               ^
src/services/enhanced_audit_logger.py:1081:80: E501 line too long (80 > 79 characters)
                    audit_data["viewport_width"] = fingerprint["viewport_width"]
                                                                               ^
src/services/enhanced_audit_logger.py:1083:80: E501 line too long (82 > 79 characters)
                    audit_data["viewport_height"] = fingerprint["viewport_height"]
                                                                               ^
src/services/enhanced_audit_logger.py:1092:80: E501 line too long (88 > 79 characters)
                    audit_data["device_pixel_ratio"] = fingerprint["device_pixel_ratio"]
                                                                               ^
src/services/enhanced_audit_logger.py:1111:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1128:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1170:80: E501 line too long (87 > 79 characters)
        username: str, success: bool, ip_address: str = None, error_message: str = None
                                                                               ^
src/services/enhanced_audit_logger.py:1234:80: E501 line too long (82 > 79 characters)
        action: str, details: Optional[Dict] = None, user_id: Optional[int] = None
                                                                               ^
src/services/enhanced_audit_logger.py:1265:80: E501 line too long (83 > 79 characters)
        details = {"change_tracking": {"old_data": old_data, "new_data": new_data}}
                                                                               ^
src/services/enhanced_audit_logger.py:1366:80: E501 line too long (81 > 79 characters)
            if log["action"] == "LOGIN_ATTEMPT" and log.get("status_code") == 401
                                                                               ^
src/services/enhanced_audit_logger.py:1374:80: E501 line too long (102 > 79 characters)
                    "description": f"{len(failed_logins)} failed login attempts in {minutes} minutes",
                                                                               ^
src/services/enhanced_audit_logger.py:1385:80: E501 line too long (84 > 79 characters)
                    "description": f"{len(log_list)} requests in {minutes} minutes",
                                                                               ^
src/services/enhanced_audit_logger.py:1390:80: E501 line too long (88 > 79 characters)
        failed_actions = [log for log in log_list if log.get("status_code", 200) >= 400]
                                                                               ^
src/services/enhanced_audit_logger.py:1397:80: E501 line too long (96 > 79 characters)
                    "description": f"{len(failed_actions)} failed actions in {minutes} minutes",
                                                                               ^
src/services/enhanced_audit_logger.py:1413:80: E501 line too long (113 > 79 characters)
                    "description": f"Access to {len(unique_endpoints)} different endpoints in {minutes} minutes",
                                                                               ^
src/services/enhanced_audit_logger.py:1446:80: E501 line too long (80 > 79 characters)
        if not basic.get("user_agent") or len(basic.get("user_agent", "")) < 10:
                                                                               ^
src/services/enhanced_audit_logger.py:1473:80: E501 line too long (85 > 79 characters)
            emulator_resolutions = [(360, 640), (375, 667), (414, 896), (1920, 1080)]
                                                                               ^
src/services/enhanced_audit_logger.py:1482:80: E501 line too long (87 > 79 characters)
            if capabilities.get("touch_support") and not basic.get("max_touch_points"):
                                                                               ^
src/services/enhanced_audit_logger.py:1490:80: E501 line too long (84 > 79 characters)
                ip_geolocation, timezone_info.get("timezone"), basic.get("language")
                                                                               ^
src/services/enhanced_audit_logger.py:1495:80: E501 line too long (83 > 79 characters)
                analysis["consistency_score"] -= mismatch.get("confidence", 0) // 2
                                                                               ^
src/services/enhanced_audit_logger.py:1503:80: E501 line too long (81 > 79 characters)
            "screen_resolution": f"{screen.get('width')}x{screen.get('height')}",
                                                                               ^
src/services/enhanced_audit_logger.py:1508:80: E501 line too long (83 > 79 characters)
            "composite_fingerprint": fingerprint_data.get("composite_fingerprint"),
                                                                               ^
src/services/enhanced_audit_logger.py:1555:80: E501 line too long (82 > 79 characters)
        count_query = "SELECT COUNT(*) as total FROM enhanced_audit_log WHERE 1=1"
                                                                               ^
src/services/enhanced_audit_logger.py:1559:80: E501 line too long (84 > 79 characters)
            # Handle special case for filtering NULL user_id (unauthenticated users)
                                                                               ^
src/services/enhanced_audit_logger.py:1598:80: E501 line too long (83 > 79 characters)
        # Include all columns from enhanced_audit_log table plus username from JOIN
                                                                               ^
src/services/enhanced_audit_logger.py:1633:80: E501 line too long (81 > 79 characters)
            query += f" ORDER BY eal.{sort_by} {sort_direction} LIMIT ? OFFSET ?"
                                                                               ^
src/services/enhanced_audit_logger.py:1666:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1674:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1705:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/enhanced_audit_logger.py:1713:17: E722 do not use bare 'except'
                except:
                ^
src/services/enhanced_audit_logger.py:1728:80: E501 line too long (87 > 79 characters)
        cutoff_date = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)
                                                                               ^
src/services/enhanced_audit_logger.py:1735:80: E501 line too long (85 > 79 characters)
            "SELECT COUNT(*) as count FROM enhanced_audit_log WHERE created_at >= ?",
                                                                               ^
src/services/enhanced_audit_logger.py:1742:80: E501 line too long (129 > 79 characters)
            "SELECT action, COUNT(*) as count FROM enhanced_audit_log WHERE created_at >= ? GROUP BY action ORDER BY count DESC",
                                                                               ^
src/services/enhanced_audit_logger.py:1749:80: E501 line too long (164 > 79 characters)
            "SELECT user_id, COUNT(*) as count FROM enhanced_audit_log WHERE created_at >= ? AND user_id IS NOT NULL GROUP BY user_id ORDER BY count DESC LIMIT 10",
                                                                               ^
src/services/enhanced_audit_logger.py:1756:80: E501 line too long (139 > 79 characters)
            "SELECT COUNT(*) as count FROM enhanced_audit_log WHERE created_at >= ? AND (status_code >= 400 OR error_message IS NOT NULL)",
                                                                               ^
src/services/enhanced_audit_logger.py:1763:80: E501 line too long (103 > 79 characters)
            "SELECT COUNT(DISTINCT ip_address) as count FROM enhanced_audit_log WHERE created_at >= ?",
                                                                               ^
src/services/enhanced_audit_logger.py:1783:80: E501 line too long (87 > 79 characters)
                country_counts[country] = country_counts.get(country, 0) + row["count"]
                                                                               ^
src/services/enhanced_audit_logger.py:1784:13: E722 do not use bare 'except'
            except:
            ^
src/services/ip_intelligence.py:7:1: F401 're' imported but unused
import re
^
src/services/ip_intelligence.py:15:80: E501 line too long (91 > 79 characters)
    # Known VPN/Proxy IP ranges (simplified - production would use comprehensive databases)
                                                                               ^
src/services/ip_intelligence.py:44:80: E501 line too long (80 > 79 characters)
    MALICIOUS_KEYWORDS = ["tor", "proxy", "vpn", "anonymous", "privacy", "hide"]
                                                                               ^
src/services/ip_intelligence.py:76:80: E501 line too long (81 > 79 characters)
            result["reverse_dns"] = IPIntelligence.reverse_dns_lookup(ip_address)
                                                                               ^
src/services/ip_intelligence.py:84:80: E501 line too long (88 > 79 characters)
                    keyword in rdns_lower for keyword in IPIntelligence.HOSTING_KEYWORDS
                                                                               ^
src/services/ip_intelligence.py:172:80: E501 line too long (84 > 79 characters)
    def detect_vpn_proxy(ip_address: str, user_agent: str = None) -> Dict[str, Any]:
                                                                               ^
src/services/ip_intelligence.py:182:80: E501 line too long (88 > 79 characters)
        result = {"is_vpn": False, "is_proxy": False, "confidence": 0, "indicators": []}
                                                                               ^
src/services/ip_intelligence.py:190:80: E501 line too long (85 > 79 characters)
            vpn_keywords = ["vpn", "proxy", "tunnel", "hide", "anonymous", "privacy"]
                                                                               ^
src/services/ip_intelligence.py:198:80: E501 line too long (86 > 79 characters)
                provider in rdns_lower for provider in IPIntelligence.HOSTING_KEYWORDS
                                                                               ^
src/services/ip_intelligence.py:233:80: E501 line too long (88 > 79 characters)
        ip_geolocation: Dict, browser_timezone: str = None, browser_language: str = None
                                                                               ^
src/services/pdf/__init__.py:3:80: E501 line too long (83 > 79 characters)
"""Consolidated PDF generation service.

This package provides PDF report generation for the RPS retirement planning system.
It consolidates functionality previously spread across multiple files.

Usage:
    from src.services.pdf import generate_analysis_report, generate_portfolio_report

    # Or import specific modules
    from src.services.pdf.base import format_currency, format_percent
    from src.services.pdf.charts import create_success_rates_chart
"""
                                       

                                      ^
src/services/pdf/__init__.py:7:80: E501 line too long (84 > 79 characters)
"""Consolidated PDF generation service.

This package provides PDF report generation for the RPS retirement planning system.
It consolidates functionality previously spread across multiple files.

Usage:
    from src.services.pdf import generate_analysis_report, generate_portfolio_report

    # Or import specific modules
    from src.services.pdf.base import format_currency, format_percent
    from src.services.pdf.charts import create_success_rates_chart
"""
                                       

                                      ^
src/services/pdf/base.py:84:29: E226 missing whitespace around arithmetic operator
            return f"${value/1_000_000:.2f}M"
                            ^
src/services/pdf/base.py:86:29: E226 missing whitespace around arithmetic operator
            return f"${value/1_000:.0f}K"
                            ^
src/services/pdf/base.py:162:80: E501 line too long (82 > 79 characters)
        self.drawString(1.0 * inch, letter[1] - 0.6 * inch, "RPS Wealth Advisory")
                                                                               ^
src/services/pdf/base.py:171:80: E501 line too long (80 > 79 characters)
        self.setStrokeColor(self.colors.get("primary", self.colors.get("navy")))
                                                                               ^
src/services/pdf/base.py:183:80: E501 line too long (85 > 79 characters)
        self.drawString(1.0 * inch, 0.5 * inch, "Confidential - For Client Use Only")
                                                                               ^
src/services/pdf/charts.py:3:1: F401 'io' imported but unused
import io
^
src/services/pdf/charts.py:9:1: E402 module level import not at top of file
import matplotlib.pyplot as plt
^
src/services/pdf/charts.py:10:1: E402 module level import not at top of file
import numpy as np
^
src/services/pdf/charts.py:12:1: E402 module level import not at top of file
from .base import format_currency
^
src/services/pdf/charts.py:163:80: E501 line too long (100 > 79 characters)
    """Create histogram of ending wealth distribution.

    Args:
        scenario_data: Dict with percentile data (percentile_5, median_ending_wealth, percentile_95)
        output_path: Path to save chart (creates temp file if None)

    Returns:
        Path to saved chart image
    """
                                                      

         
             ^
src/services/pdf/charts.py:179:80: E501 line too long (81 > 79 characters)
        sigma = (np.log(p95) - np.log(p5)) / 3.29  # 3.29  2 * 1.645 (90% range)
                                                                               ^
src/services/pdf/charts.py:186:80: E501 line too long (86 > 79 characters)
        ax.hist(data / 1000, bins=40, color="#0277bd", alpha=0.7, edgecolor="#1a237e")
                                                                               ^
src/services/pdf/charts.py:211:80: E501 line too long (84 > 79 characters)
        ax.set_xlabel("Ending Portfolio Value ($K)", fontsize=12, fontweight="bold")
                                                                               ^
src/services/pdf/components.py:3:1: F401 'datetime.datetime' imported but unused
from datetime import datetime
^
src/services/pdf/components.py:6:1: F401 'reportlab.platypus.Image' imported but unused
from reportlab.platypus import (
^
src/services/pdf/components.py:15:1: F401 'reportlab.lib.enums.TA_CENTER' imported but unused
from reportlab.lib.enums import TA_CENTER
^
src/services/pdf/components.py:37:80: E501 line too long (80 > 79 characters)
    elements.append(Paragraph(f"Profile: {profile_name}", styles["ReportBody"]))
                                                                               ^
src/services/pdf/components.py:44:80: E501 line too long (83 > 79 characters)
    elements.append(Paragraph("<i>RPS - Authored by pan</i>", styles["SmallText"]))
                                                                               ^
src/services/pdf/components.py:100:80: E501 line too long (90 > 79 characters)
            "<para align=center><i>Comprehensive Retirement Planning Analysis</i></para>",
                                                                               ^
src/services/pdf/components.py:115:80: E501 line too long (81 > 79 characters)
def create_elite_cover_page(profile_name, report_type, styles, colors_dict=None):
                                                                               ^
src/services/pdf/components.py:159:80: E501 line too long (83 > 79 characters)
        [Paragraph(f"<b>Prepared For:</b><br/>{profile_name}", styles["BodyText"])]
                                                                               ^
src/services/pdf/components.py:193:80: E501 line too long (85 > 79 characters)
    elements.append(Paragraph(f"<b>Report Date:</b> {date_str}", styles["BodyText"]))
                                                                               ^
src/services/pdf/components.py:201:80: E501 line too long (94 > 79 characters)
                "<i>This report contains confidential financial information and projections. "
                                                                               ^
src/services/pdf/components.py:202:80: E501 line too long (103 > 79 characters)
                "It is intended solely for the use of the named client and their authorized advisors. "
                                                                               ^
src/services/pdf/components.py:203:80: E501 line too long (108 > 79 characters)
                "Past performance does not guarantee future results. All projections are hypothetical.</i>",
                                                                               ^
src/services/pdf/components.py:244:80: E501 line too long (80 > 79 characters)
def create_data_table(headers, data, styles, colors_dict=None, col_widths=None):
                                                                               ^
src/services/pdf/components.py:263:80: E501 line too long (80 > 79 characters)
            Paragraph(f"<b>{h}</b>", styles.get("ReportBody", styles["Normal"]))
                                                                               ^
src/services/pdf/components.py:336:80: E501 line too long (81 > 79 characters)
        Paragraph(title, styles.get("SectionHeader", styles.get("SectionTitle")))
                                                                               ^
src/services/pdf/components.py:475:80: E501 line too long (81 > 79 characters)
        HRFlowable(width="100%", thickness=0.5, color=colors.HexColor("#bdc3c7"))
                                                                               ^
src/services/pdf/components.py:480:80: E501 line too long (125 > 79 characters)
            "<i>Disclaimer: This analysis is for informational purposes only and should not be considered financial advice. "
                                                                               ^
src/services/pdf/components.py:481:80: E501 line too long (120 > 79 characters)
            "Past performance does not guarantee future results. Please consult with qualified financial professionals "
                                                                               ^
src/services/pdf/reports.py:4:1: F401 'datetime.datetime' imported but unused
from datetime import datetime
^
src/services/pdf/reports.py:26:1: F401 '.styles.get_styles' imported but unused
from .styles import create_basic_styles, create_elite_styles, get_styles
^
src/services/pdf/reports.py:33:1: F401 '.components.create_executive_summary_box' imported but unused
from .components import (
^
src/services/pdf/reports.py:64:80: E501 line too long (86 > 79 characters)
        create_header(profile_name, "Retirement Analysis Report", styles, colors_dict)
                                                                               ^
src/services/pdf/reports.py:75:80: E501 line too long (231 > 79 characters)
        summary_text = f"Your retirement plan shows a <b>{format_percent(success_rate)}</b> success rate under moderate market conditions. This is an excellent result indicating a high probability of meeting your retirement goals."
                                                                               ^
src/services/pdf/reports.py:78:80: E501 line too long (222 > 79 characters)
        summary_text = f"Your retirement plan shows a <b>{format_percent(success_rate)}</b> success rate under moderate market conditions. This is a good result, though some adjustments could improve your chances further."
                                                                               ^
src/services/pdf/reports.py:81:80: E501 line too long (226 > 79 characters)
        summary_text = f"Your retirement plan shows a <b>{format_percent(success_rate)}</b> success rate under moderate market conditions. Consider adjusting your spending, savings, or retirement date to improve this outlook."
                                                                               ^
src/services/pdf/reports.py:91:80: E501 line too long (85 > 79 characters)
        ["Number of Simulations", f"{analysis_results.get('simulations', 10000):,}"],
                                                                               ^
src/services/pdf/reports.py:93:80: E501 line too long (83 > 79 characters)
        ["Total Assets", format_currency(analysis_results.get("total_assets", 0))],
                                                                               ^
src/services/pdf/reports.py:183:80: E501 line too long (84 > 79 characters)
    elements.append(Paragraph("Understanding Your Results", styles["SectionTitle"]))
                                                                               ^
src/services/pdf/reports.py:186:80: E501 line too long (130 > 79 characters)
        "<b>Success Rate:</b> The percentage of simulations where your portfolio lasted throughout retirement without depleting.",
                                                                               ^
src/services/pdf/reports.py:187:80: E501 line too long (98 > 79 characters)
        "<b>Median Balance:</b> The middle outcome - half of simulations end higher, half lower.",
                                                                               ^
src/services/pdf/reports.py:188:80: E501 line too long (94 > 79 characters)
        "<b>5th Percentile:</b> The worst-case scenario (only 5% of simulations were worse).",
                                                                               ^
src/services/pdf/reports.py:189:80: E501 line too long (95 > 79 characters)
        "<b>95th Percentile:</b> The best-case scenario (only 5% of simulations were better).",
                                                                               ^
src/services/pdf/reports.py:203:80: E501 line too long (89 > 79 characters)
            "Consider whether you might be able to increase spending or retire earlier.",
                                                                               ^
src/services/pdf/reports.py:209:80: E501 line too long (91 > 79 characters)
            "Consider increasing savings or delaying retirement slightly to improve odds.",
                                                                               ^
src/services/pdf/reports.py:214:80: E501 line too long (85 > 79 characters)
            "Your plan may benefit from adjustments to improve success probability.",
                                                                               ^
src/services/pdf/reports.py:283:80: E501 line too long (99 > 79 characters)
        f"This comprehensive retirement analysis presents Monte Carlo simulations across multiple "
                                                                               ^
src/services/pdf/reports.py:284:80: E501 line too long (95 > 79 characters)
        f"asset allocation scenarios. Based on current assets of <b>${total_assets:,.0f}</b>, "
                                                                               ^
src/services/pdf/reports.py:285:80: E501 line too long (90 > 79 characters)
        f"we have modeled {analysis_results.get('simulations', 1000):,} simulations over "
                                                                               ^
src/services/pdf/reports.py:301:80: E501 line too long (86 > 79 characters)
                "median_ending_wealth", moderate_scenario.get("median_final_value", 0)
                                                                               ^
src/services/pdf/reports.py:343:80: E501 line too long (82 > 79 characters)
        scenario_name = scenario_result.get("scenario_name", scenario_key.title())
                                                                               ^
src/services/pdf/reports.py:346:80: E501 line too long (80 > 79 characters)
            "median_ending_wealth", scenario_result.get("median_final_value", 0)
                                                                               ^
src/services/pdf/reports.py:384:80: E501 line too long (80 > 79 characters)
    elements.append(Paragraph("Portfolio Projections", styles["SectionHeader"]))
                                                                               ^
src/services/pdf/reports.py:395:80: E501 line too long (101 > 79 characters)
    projection_text = """The following analysis illustrates the projected portfolio balance over your
    retirement timeline under each asset allocation strategy. Results show median (50th percentile) outcomes."""
                                                                               ^
src/services/pdf/reports.py:396:80: E501 line too long (112 > 79 characters)
    projection_text = """The following analysis illustrates the projected portfolio balance over your
    retirement timeline under each asset allocation strategy. Results show median (50th percentile) outcomes."""
                                                                               ^
src/services/pdf/reports.py:436:80: E501 line too long (107 > 79 characters)
    risk_text = f"""This distribution shows the range of possible outcomes under moderate asset allocation:

    <b> Worst-Case Scenario (5th Percentile):</b> Only 5% of simulations ended below {format_currency(p5)}.

    <b> Most Likely Outcome (Median):</b> {format_currency(median_val)} represents the middle result.

    <b> Best-Case Scenario (95th Percentile):</b> Only 5% of simulations exceeded {format_currency(p95)}."""
                                                                               ^
src/services/pdf/reports.py:438:80: E501 line too long (108 > 79 characters)
    risk_text = f"""This distribution shows the range of possible outcomes under moderate asset allocation:

    <b> Worst-Case Scenario (5th Percentile):</b> Only 5% of simulations ended below {format_currency(p5)}.

    <b> Most Likely Outcome (Median):</b> {format_currency(median_val)} represents the middle result.

    <b> Best-Case Scenario (95th Percentile):</b> Only 5% of simulations exceeded {format_currency(p95)}."""
                                                                               ^
src/services/pdf/reports.py:440:80: E501 line too long (102 > 79 characters)
    risk_text = f"""This distribution shows the range of possible outcomes under moderate asset allocation:

    <b> Worst-Case Scenario (5th Percentile):</b> Only 5% of simulations ended below {format_currency(p5)}.

    <b> Most Likely Outcome (Median):</b> {format_currency(median_val)} represents the middle result.

    <b> Best-Case Scenario (95th Percentile):</b> Only 5% of simulations exceeded {format_currency(p95)}."""
                                                                               ^
src/services/pdf/reports.py:442:80: E501 line too long (109 > 79 characters)
    risk_text = f"""This distribution shows the range of possible outcomes under moderate asset allocation:

    <b> Worst-Case Scenario (5th Percentile):</b> Only 5% of simulations ended below {format_currency(p5)}.

    <b> Most Likely Outcome (Median):</b> {format_currency(median_val)} represents the middle result.

    <b> Best-Case Scenario (95th Percentile):</b> Only 5% of simulations exceeded {format_currency(p95)}."""
                                                                               ^
src/services/pdf/reports.py:447:80: E501 line too long (84 > 79 characters)
    elements.append(Paragraph("Methodology & Assumptions", styles["SectionHeader"]))
                                                                               ^
src/services/pdf/reports.py:458:80: E501 line too long (111 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:459:80: E501 line too long (122 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:461:80: E501 line too long (105 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:462:80: E501 line too long (125 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:464:80: E501 line too long (85 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:466:80: E501 line too long (123 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:467:80: E501 line too long (85 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:469:80: E501 line too long (116 > 79 characters)
    methodology_text = f"""<b>Monte Carlo Simulation:</b> This analysis employs Monte Carlo simulation, running
    {analysis_results.get('simulations', 10000):,} independent scenarios with randomized returns based on historical data.

    <b>Market Assumptions:</b> Returns are modeled using historically-informed probability distributions.
    Stock returns assume a mean annual return of 8-10% with 15-18% volatility. Bond returns assume 3-5% with 5-7% volatility.

    <b>Inflation:</b> The model adjusts for inflation at approximately 2-3% annually.

    <b>Important Limitations:</b> This analysis makes simplifying assumptions and cannot predict actual market performance.
    Results should be viewed as directional guidance rather than precise predictions.

    <b>Not Financial Advice:</b> This report provides educational analysis only. Consult qualified professionals."""
                                                                               ^
src/services/pdf/reports.py:474:80: E501 line too long (87 > 79 characters)
    elements.append(HRFlowable(width="100%", thickness=1, color=colors_dict["border"]))
                                                                               ^
src/services/pdf/reports.py:478:80: E501 line too long (124 > 79 characters)
            """<i>IMPORTANT DISCLAIMER: This analysis is for informational and educational purposes only. It is not intended
        as financial, investment, tax, or legal advice. Past performance does not guarantee future results. Please consult
        with qualified financial professionals before making any financial decisions.</i>""",
                                                                               ^
src/services/pdf/reports.py:479:80: E501 line too long (122 > 79 characters)
            """<i>IMPORTANT DISCLAIMER: This analysis is for informational and educational purposes only. It is not intended
        as financial, investment, tax, or legal advice. Past performance does not guarantee future results. Please consult
        with qualified financial professionals before making any financial decisions.</i>""",
                                                                               ^
src/services/pdf/reports.py:480:80: E501 line too long (93 > 79 characters)
            """<i>IMPORTANT DISCLAIMER: This analysis is for informational and educational purposes only. It is not intended
        as financial, investment, tax, or legal advice. Past performance does not guarantee future results. Please consult
        with qualified financial professionals before making any financial decisions.</i>""",
                                                                               ^
src/services/pdf/reports.py:524:80: E501 line too long (84 > 79 characters)
        create_header(profile_name, "Portfolio Summary Report", styles, colors_dict)
                                                                               ^
src/services/pdf/reports.py:544:80: E501 line too long (80 > 79 characters)
                total_retirement / total_assets * 100 if total_assets > 0 else 0
                                                                               ^
src/services/pdf/reports.py:557:80: E501 line too long (87 > 79 characters)
    overview_table = Table(overview_data, colWidths=[2.5 * inch, 2 * inch, 1.5 * inch])
                                                                               ^
src/services/pdf/reports.py:586:80: E501 line too long (81 > 79 characters)
        elements.append(Paragraph("Retirement Accounts", styles["SectionTitle"]))
                                                                               ^
src/services/pdf/reports.py:644:80: E501 line too long (80 > 79 characters)
                    ("BACKGROUND", (0, 0), (-1, 0), colors.HexColor("#9b59b6")),
                                                                               ^
src/services/pdf/reports.py:667:80: E501 line too long (80 > 79 characters)
        elements.append(Paragraph("Financial Overview", styles["SectionTitle"]))
                                                                               ^
src/services/pdf/reports.py:671:80: E501 line too long (82 > 79 characters)
            ["Annual Income", format_currency(financial.get("annual_income", 0))],
                                                                               ^
src/services/pdf/reports.py:672:80: E501 line too long (86 > 79 characters)
            ["Annual Expenses", format_currency(financial.get("annual_expenses", 0))],
                                                                               ^
src/services/pdf/reports.py:690:80: E501 line too long (82 > 79 characters)
                ["Spouse SS Claiming Age", str(spouse.get("ss_claiming_age", 67))]
                                                                               ^
src/services/pdf/reports.py:694:80: E501 line too long (87 > 79 characters)
            ["Pension (Monthly)", format_currency(financial.get("pension_benefit", 0))]
                                                                               ^
src/services/pdf/reports.py:728:80: E501 line too long (105 > 79 characters)
            "<i>This portfolio summary is for informational purposes only. Values shown may not reflect "
                                                                               ^
src/services/pdf/reports.py:729:80: E501 line too long (110 > 79 characters)
            "current market prices. Please verify all account balances with your financial institutions.</i>",
                                                                               ^
src/services/pdf/reports.py:806:80: E501 line too long (80 > 79 characters)
                    action_text[:50] + ("..." if len(action_text) > 50 else ""),
                                                                               ^
src/services/pdf/reports.py:812:80: E501 line too long (81 > 79 characters)
            priority_data, colWidths=[0.8 * inch, 1 * inch, 3.2 * inch, 1 * inch]
                                                                               ^
src/services/pdf/reports.py:839:80: E501 line too long (83 > 79 characters)
        elements.append(Paragraph("Detailed Action Items", styles["SectionTitle"]))
                                                                               ^
src/services/pdf/reports.py:842:80: E501 line too long (88 > 79 characters)
            title_text = item.get("title") or item.get("description", "Untitled Action")
                                                                               ^
src/services/pdf/reports.py:843:80: E501 line too long (82 > 79 characters)
            elements.append(Paragraph(f"{i}. {title_text}", styles["SubSection"]))
                                                                               ^
src/services/pdf/reports.py:852:80: E501 line too long (91 > 79 characters)
                    f"Status: {item.get('status', 'pending').replace('_', ' ').title()} | "
                                                                               ^
src/services/pdf/reports.py:870:80: E501 line too long (80 > 79 characters)
                    action_text[:60] + ("..." if len(action_text) > 60 else ""),
                                                                               ^
src/services/pdf/reports.py:905:80: E501 line too long (91 > 79 characters)
                "No action items have been created yet. Use the AI Advisor feature to get "
                                                                               ^
src/services/pdf/styles.py:4:1: F401 'reportlab.lib.enums.TA_LEFT' imported but unused
from reportlab.lib.enums import TA_CENTER, TA_LEFT, TA_RIGHT, TA_JUSTIFY
^
src/services/pdf/styles.py:4:1: F401 'reportlab.lib.enums.TA_RIGHT' imported but unused
from reportlab.lib.enums import TA_CENTER, TA_LEFT, TA_RIGHT, TA_JUSTIFY
^
src/services/pdf/styles.py:56:80: E501 line too long (84 > 79 characters)
        "ReportBody", parent=styles["Normal"], fontSize=10, spaceAfter=8, leading=14
                                                                               ^
src/services/pdf/styles.py:60:80: E501 line too long (88 > 79 characters)
        "SmallText", parent=styles["Normal"], fontSize=8, textColor=colors["text_light"]
                                                                               ^
src/services/pdf/styles.py:430:80: E501 line too long (80 > 79 characters)
        "professional": (create_professional_styles, ColorPalette.PROFESSIONAL),
                                                                               ^
src/services/rebalancing_service.py:13:80: E501 line too long (83 > 79 characters)
        """Calculate the current aggregate asset allocation across all accounts."""
                                                                               ^
src/services/rebalancing_service.py:18:80: E501 line too long (84 > 79 characters)
        all_accounts = self.assets.get("retirement_accounts", []) + self.assets.get(
                                                                               ^
src/services/rebalancing_service.py:35:80: E501 line too long (80 > 79 characters)
            stock_pct = float(stock_pct) if stock_pct not in (None, "") else 0.0
                                                                               ^
src/services/rebalancing_service.py:39:80: E501 line too long (86 > 79 characters)
            # If total allocation is near zero (< 1%), assume not set and use defaults
                                                                               ^
src/services/rebalancing_service.py:47:80: E501 line too long (88 > 79 characters)
            # Convert percentages to decimals if they're stored as whole numbers (0-100)
                                                                               ^
src/services/rebalancing_service.py:67:80: E501 line too long (92 > 79 characters)
        """
        Suggest trades to reach the target allocation, prioritizing tax-advantaged accounts.
        """
           
                                                                   ^
src/services/rebalancing_service.py:84:9: F841 local variable 'trades' is assigned to but never used
        trades = []
        ^
src/services/rebalancing_service.py:90:80: E501 line too long (89 > 79 characters)
        # Step 1: Try to rebalance within retirement accounts first (no tax consequences)
                                                                               ^
src/services/rebalancing_service.py:97:80: E501 line too long (104 > 79 characters)
            # Simple strategy: shift account's internal allocation to compensate for aggregate imbalance
                                                                               ^
src/services/rebalancing_service.py:102:80: E501 line too long (94 > 79 characters)
        # For this implementation, we'll return a summary of the imbalance and general advice.
                                                                               ^
src/services/rebalancing_service.py:115:80: E501 line too long (82 > 79 characters)
        self, diffs: Dict[str, float], retirement: List[Dict], taxable: List[Dict]
                                                                               ^
src/services/rebalancing_service.py:124:80: E501 line too long (86 > 79 characters)
            recs.append(f"{action} ${abs(amount):,.0f} of {asset_class.capitalize()}")
                                                                               ^
src/services/rebalancing_service.py:128:80: E501 line too long (108 > 79 characters)
                "Prioritize rebalancing within Retirement (401k/IRA) accounts to avoid capital gains taxes."
                                                                               ^
src/services/rebalancing_service.py:132:80: E501 line too long (114 > 79 characters)
                    "If selling in taxable accounts, consider tax-loss harvesting if any positions are at a loss."
                                                                               ^
src/services/rebalancing_service.py:136:80: E501 line too long (87 > 79 characters)
                "Your portfolio is currently well-aligned with your target allocation."
                                                                               ^
src/services/reconciliation_service.py:3:80: E501 line too long (80 > 79 characters)
"""
Reconciliation Service
Matches imported data against existing records to detect duplicates and updates.
Uses fuzzy matching for names and tolerance thresholds for amounts.
"""
   
                      
                                                    ^
src/services/reconciliation_service.py:8:1: F401 'typing.Optional' imported but unused
from typing import List, Dict, Any, Optional, Tuple
^
src/services/reconciliation_service.py:86:61: E226 missing whitespace around arithmetic operator
                reasons.append(f"Name match ({int(name_score*100)}%)")
                                                            ^
src/services/reconciliation_service.py:94:80: E501 line too long (85 > 79 characters)
        val1 = item1.get("amount") or item1.get("value") or item1.get("balance") or 0
                                                                               ^
src/services/reconciliation_service.py:95:80: E501 line too long (85 > 79 characters)
        val2 = item2.get("amount") or item2.get("value") or item2.get("balance") or 0
                                                                               ^
src/services/reconciliation_service.py:128:80: E501 line too long (84 > 79 characters)
        existing_streams: List[Dict[str, Any]], imported_items: List[Dict[str, Any]]
                                                                               ^
src/services/reconciliation_service.py:169:80: E501 line too long (80 > 79 characters)
        """
        Reconcile imported expenses against existing budget (nested categories).
        Input `existing_budget` should be the 'current' or 'future' dictionary
        containing category keys mapping to lists of expense items.
        """
           
                                                                   ^
src/services/reconciliation_service.py:195:21: W503 line break before binary operator
                    and existing.get("_category")
                    ^
src/services/reconciliation_service.py:196:21: W503 line break before binary operator
                    and item["category"].lower() == existing["_category"].lower()
                    ^
src/services/reconciliation_service.py:196:80: E501 line too long (81 > 79 characters)
                    and item["category"].lower() == existing["_category"].lower()
                                                                               ^
src/services/reconciliation_service.py:257:21: W503 line break before binary operator
                    and existing.get("_category")
                    ^
src/services/reconciliation_service.py:258:21: W503 line break before binary operator
                    and item["type"].lower().replace(" ", "_")
                    ^
src/services/reconciliation_service.py:259:21: W503 line break before binary operator
                    == existing["_category"].lower()
                    ^
src/services/retirement_model.py:66:80: E501 line too long (85 > 79 characters)
        None  # How to allocate surplus: {'pretax': 0.7, 'roth': 0.2, 'taxable': 0.1}
                                                                               ^
src/services/retirement_model.py:109:80: E501 line too long (84 > 79 characters)
    def calculate_life_expectancy_years(self, person: Person, target_age: int = 90):
                                                                               ^
src/services/retirement_model.py:113:80: E501 line too long (82 > 79 characters)
    def get_standard_deduction(self, current_cpi: np.ndarray = 1.0) -> np.ndarray:
                                                                               ^
src/services/retirement_model.py:135:80: E501 line too long (87 > 79 characters)
        """Calculate federal income tax using progressive brackets.

        Args:
            taxable_income: Array of taxable income values (after deductions)
            filing_status: 'mfj', 'single', 'mfs', 'hoh'. If None, use profile default.

        Returns:
            Tuple of (total_tax array, marginal_rate array)
        """
                                                                   

          ^
src/services/retirement_model.py:183:80: E501 line too long (81 > 79 characters)
            marginal_rate = np.where(taxable_income > lower, rate, marginal_rate)
                                                                               ^
src/services/retirement_model.py:199:80: E501 line too long (87 > 79 characters)
        """Calculate taxable portion of Social Security benefits.

        Uses provisional income formula:
        Provisional = AGI (excluding SS) + 50% of SS + tax-exempt interest

        Args:
            other_income: Array of AGI excluding SS (pensions, RMDs, withdrawals, etc.)
            ss_benefit: Array of total SS benefits received
            filing_status: 'mfj' or 'single'

        Returns:
            Array of taxable SS amounts (0%, 50%, or 85% of benefits)
        """
                                                                 

            ^
src/services/retirement_model.py:239:80: E501 line too long (88 > 79 characters)
            above_threshold_2, np.minimum(max_85, base_taxable + additional), taxable_ss
                                                                               ^
src/services/retirement_model.py:245:80: E501 line too long (87 > 79 characters)
        self, gains: np.ndarray, ordinary_income: np.ndarray, filing_status: str = None
                                                                               ^
src/services/retirement_model.py:262:80: E501 line too long (82 > 79 characters)
        # 2024 LTCG brackets (thresholds for total taxable income including gains)
                                                                               ^
src/services/retirement_model.py:270:9: F841 local variable 'total_income' is assigned to but never used
        total_income = ordinary_income + gains
        ^
src/services/retirement_model.py:291:80: E501 line too long (83 > 79 characters)
        ltcg_tax = (gains_at_0 * 0.0) + (gains_at_15 * 0.15) + (gains_at_20 * 0.20)
                                                                               ^
src/services/retirement_model.py:296:80: E501 line too long (88 > 79 characters)
        self, magi: np.ndarray, filing_status: str = None, both_on_medicare: bool = True
                                                                               ^
src/services/retirement_model.py:304:80: E501 line too long (84 > 79 characters)
        """Calculate Medicare IRMAA surcharges based on MAGI.

        IRMAA = Income-Related Monthly Adjustment Amount
        Applies to Medicare Part B and Part D premiums for high earners.

        Args:
            magi: Array of Modified AGI (2 years prior, but we use current as proxy)
            filing_status: 'mfj' or 'single'
            both_on_medicare: If True, doubles surcharge for married couples

        Returns:
            Array of annual IRMAA surcharges
        """
                                                             

                ^
src/services/retirement_model.py:314:80: E501 line too long (80 > 79 characters)
        # 2024 IRMAA thresholds and annual surcharges (Part B + Part D combined)
                                                                               ^
src/services/retirement_model.py:394:80: E501 line too long (81 > 79 characters)
        """Validate market periods and return warnings for unrealistic scenarios.

        Args:
            years: Total years to simulate
            market_periods: Market period definitions

        Returns:
            List of warning messages
        """
                                                                               ^
src/services/retirement_model.py:422:80: E501 line too long (116 > 79 characters)
                        f" Unrealistic: {duration}-year recession ({period['start_year']}-{period['end_year']}). "
                                                                               ^
src/services/retirement_model.py:429:80: E501 line too long (118 > 79 characters)
                        f" Unrealistic: {duration}-year bull market ({period['start_year']}-{period['end_year']}). "
                                                                               ^
src/services/retirement_model.py:430:80: E501 line too long (95 > 79 characters)
                        f"Sustained high returns over such long periods are historically rare."
                                                                               ^
src/services/retirement_model.py:436:80: E501 line too long (98 > 79 characters)
                        f" Warning: Single market condition spans {duration} of {years} years. "
                                                                               ^
src/services/retirement_model.py:437:80: E501 line too long (99 > 79 characters)
                        f"Consider modeling multiple market cycles for more realistic projections."
                                                                               ^
src/services/retirement_model.py:448:80: E501 line too long (116 > 79 characters)
                        f" Gap detected: {gap_years} years between periods ({current_end + 1}-{next_start - 1}). "
                                                                               ^
src/services/retirement_model.py:449:80: E501 line too long (86 > 79 characters)
                        f"Historical market assumptions will be used for these years."
                                                                               ^
src/services/retirement_model.py:472:80: E501 line too long (114 > 79 characters)
                        f" Pattern element {idx + 1}: {duration}-year recession phase is unrealistically long. "
                                                                               ^
src/services/retirement_model.py:484:80: E501 line too long (85 > 79 characters)
        """Build a year-by-year lookup of market assumptions from period definitions.

        Args:
            years: Total number of years to simulate
            market_periods: Dict with either 'timeline' or 'cycle' periods
            default_assumptions: Fallback assumptions if no periods defined

        Returns:
            Dict mapping year_index -> MarketAssumptions for that year
        """
                                                                               ^
src/services/retirement_model.py:512:80: E501 line too long (82 > 79 characters)
            sorted_periods = sorted(periods, key=lambda p: p.get("start_year", 0))
                                                                               ^
src/services/retirement_model.py:521:80: E501 line too long (85 > 79 characters)
                    if period["start_year"] <= simulation_year <= period["end_year"]:
                                                                               ^
src/services/retirement_model.py:530:80: E501 line too long (88 > 79 characters)
                                "stock_return_std", default_assumptions.stock_return_std
                                                                               ^
src/services/retirement_model.py:533:80: E501 line too long (88 > 79 characters)
                                "bond_return_mean", default_assumptions.bond_return_mean
                                                                               ^
src/services/retirement_model.py:536:80: E501 line too long (86 > 79 characters)
                                "bond_return_std", default_assumptions.bond_return_std
                                                                               ^
src/services/retirement_model.py:539:80: E501 line too long (84 > 79 characters)
                                "inflation_mean", default_assumptions.inflation_mean
                                                                               ^
src/services/retirement_model.py:542:80: E501 line too long (82 > 79 characters)
                                "inflation_std", default_assumptions.inflation_std
                                                                               ^
src/services/retirement_model.py:544:80: E501 line too long (105 > 79 characters)
                            stock_allocation=default_assumptions.stock_allocation,  # Use base allocation
                                                                               ^
src/services/retirement_model.py:598:80: E501 line too long (88 > 79 characters)
                                "stock_return_std", default_assumptions.stock_return_std
                                                                               ^
src/services/retirement_model.py:601:80: E501 line too long (88 > 79 characters)
                                "bond_return_mean", default_assumptions.bond_return_mean
                                                                               ^
src/services/retirement_model.py:604:80: E501 line too long (86 > 79 characters)
                                "bond_return_std", default_assumptions.bond_return_std
                                                                               ^
src/services/retirement_model.py:607:80: E501 line too long (84 > 79 characters)
                                "inflation_mean", default_assumptions.inflation_mean
                                                                               ^
src/services/retirement_model.py:610:80: E501 line too long (82 > 79 characters)
                                "inflation_std", default_assumptions.inflation_std
                                                                               ^
src/services/retirement_model.py:612:80: E501 line too long (82 > 79 characters)
                            stock_allocation=default_assumptions.stock_allocation,
                                                                               ^
src/services/retirement_model.py:628:80: E501 line too long (93 > 79 characters)
        """Run Monte Carlo simulation using vectorized NumPy operations for high performance.

        Args:
            years: Number of years to simulate
            simulations: Number of Monte Carlo simulations to run
            assumptions: Base market assumptions (used if market_periods not provided)
            effective_tax_rate: Effective tax rate for calculations
            spending_model: Spending pattern model ('constant_real', 'retirement_smile', 'conservative_decline')
            market_periods: Optional period-based market conditions (timeline or cycle)
        """
                                                                               ^
src/services/retirement_model.py:633:80: E501 line too long (86 > 79 characters)
        """Run Monte Carlo simulation using vectorized NumPy operations for high performance.

        Args:
            years: Number of years to simulate
            simulations: Number of Monte Carlo simulations to run
            assumptions: Base market assumptions (used if market_periods not provided)
            effective_tax_rate: Effective tax rate for calculations
            spending_model: Spending pattern model ('constant_real', 'retirement_smile', 'conservative_decline')
            market_periods: Optional period-based market conditions (timeline or cycle)
        """
                                                                               ^
src/services/retirement_model.py:635:80: E501 line too long (112 > 79 characters)
        """Run Monte Carlo simulation using vectorized NumPy operations for high performance.

        Args:
            years: Number of years to simulate
            simulations: Number of Monte Carlo simulations to run
            assumptions: Base market assumptions (used if market_periods not provided)
            effective_tax_rate: Effective tax rate for calculations
            spending_model: Spending pattern model ('constant_real', 'retirement_smile', 'conservative_decline')
            market_periods: Optional period-based market conditions (timeline or cycle)
        """
                                                                               ^
src/services/retirement_model.py:636:80: E501 line too long (87 > 79 characters)
        """Run Monte Carlo simulation using vectorized NumPy operations for high performance.

        Args:
            years: Number of years to simulate
            simulations: Number of Monte Carlo simulations to run
            assumptions: Base market assumptions (used if market_periods not provided)
            effective_tax_rate: Effective tax rate for calculations
            spending_model: Spending pattern model ('constant_real', 'retirement_smile', 'conservative_decline')
            market_periods: Optional period-based market conditions (timeline or cycle)
        """
                                                                               ^
src/services/retirement_model.py:704:80: E501 line too long (87 > 79 characters)
            self.profile.person1.social_security + self.profile.person2.social_security
                                                                               ^
src/services/retirement_model.py:718:80: E501 line too long (84 > 79 characters)
                            "inflation_adjusted": s.get("inflation_adjusted", True),
                                                                               ^
src/services/retirement_model.py:722:17: E722 do not use bare 'except'
                except:
                ^
src/services/retirement_model.py:733:21: W503 line break before binary operator
                    + safe_float(prop.get("annual_insurance", 0))
                    ^
src/services/retirement_model.py:734:21: W503 line break before binary operator
                    + safe_float(prop.get("annual_maintenance", 0))
                    ^
src/services/retirement_model.py:735:21: W503 line break before binary operator
                    + safe_float(prop.get("annual_hoa", 0))
                    ^
src/services/retirement_model.py:744:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/retirement_model.py:753:80: E501 line too long (87 > 79 characters)
                            prop.get("appreciation_rate") or assumptions.inflation_mean
                                                                               ^
src/services/retirement_model.py:759:80: E501 line too long (88 > 79 characters)
                        "property_type": prop.get("property_type", "Primary Residence"),
                                                                               ^
src/services/retirement_model.py:771:9: F841 local variable 'CASH_INTEREST' is assigned to but never used
        CASH_INTEREST = 0.015
        ^
src/services/retirement_model.py:772:9: F841 local variable 'STANDARD_DEDUCTION_BASE' is assigned to but never used
        STANDARD_DEDUCTION_BASE = 29200  # 2024 MFJ standard deduction
        ^
src/services/retirement_model.py:796:80: E501 line too long (81 > 79 characters)
                    spending_multipliers[i] = max(0.6, 1.0 - ((age - 70) * 0.01))
                                                                               ^
src/services/retirement_model.py:809:17: F841 local variable 'stock_pct' is assigned to but never used
                stock_pct = max(0.20, base_stock_pct - reduction)
                ^
src/services/retirement_model.py:838:17: W503 line break before binary operator
                + allocs["bond"] * year_assumptions.bond_return_mean
                ^
src/services/retirement_model.py:839:17: W503 line break before binary operator
                + allocs["cash"] * year_assumptions.cash_return_mean
                ^
src/services/retirement_model.py:840:17: W503 line break before binary operator
                + allocs["reit"] * year_assumptions.reit_return_mean
                ^
src/services/retirement_model.py:841:17: W503 line break before binary operator
                + allocs["gold"] * year_assumptions.gold_return_mean
                ^
src/services/retirement_model.py:842:17: W503 line break before binary operator
                + allocs["crypto"] * year_assumptions.crypto_return_mean
                ^
src/services/retirement_model.py:846:80: E501 line too long (85 > 79 characters)
            # Simplification: Use weighted average of variances for additional assets
                                                                               ^
src/services/retirement_model.py:849:80: E501 line too long (82 > 79 characters)
            stock_var = (allocs["stock"] * year_assumptions.stock_return_std) ** 2
                                                                               ^
src/services/retirement_model.py:853:17: W503 line break before binary operator
                * allocs["stock"]
                ^
src/services/retirement_model.py:854:17: W503 line break before binary operator
                * allocs["bond"]
                ^
src/services/retirement_model.py:855:17: W503 line break before binary operator
                * 0.3
                ^
src/services/retirement_model.py:856:17: W503 line break before binary operator
                * year_assumptions.stock_return_std
                ^
src/services/retirement_model.py:857:17: W503 line break before binary operator
                * year_assumptions.bond_return_std
                ^
src/services/retirement_model.py:862:17: W503 line break before binary operator
                + (allocs["reit"] * year_assumptions.reit_return_std) ** 2
                ^
src/services/retirement_model.py:863:17: W503 line break before binary operator
                + (allocs["gold"] * year_assumptions.gold_return_std) ** 2
                ^
src/services/retirement_model.py:864:17: W503 line break before binary operator
                + (allocs["crypto"] * year_assumptions.crypto_return_std) ** 2
                ^
src/services/retirement_model.py:890:80: E501 line too long (84 > 79 characters)
                (self.profile.person1.social_security * 12) if p1_ss_eligible else 0
                                                                               ^
src/services/retirement_model.py:893:80: E501 line too long (84 > 79 characters)
                (self.profile.person2.social_security * 12) if p2_ss_eligible else 0
                                                                               ^
src/services/retirement_model.py:895:80: E501 line too long (88 > 79 characters)
            gross_ss = (p1_ss_amt + p2_ss_amt) * current_cpi  # Total SS before taxation
                                                                               ^
src/services/retirement_model.py:928:80: E501 line too long (82 > 79 characters)
            # Combined employment income (Salary from streams + Budget employment)
                                                                               ^
src/services/retirement_model.py:932:80: E501 line too long (101 > 79 characters)
            # Combined non-employment ordinary income (Pension + Other Streams + Rental/Other Budget)
                                                                               ^
src/services/retirement_model.py:944:80: E501 line too long (82 > 79 characters)
                ss_tax = np.minimum(employment_income_gross, SS_WAGE_BASE) * 0.062
                                                                               ^
src/services/retirement_model.py:961:80: E501 line too long (82 > 79 characters)
                employment_income_gross + other_ordinary_income_gross + taxable_ss
                                                                               ^
src/services/retirement_model.py:967:80: E501 line too long (82 > 79 characters)
            fed_tax_paid, _ = self._vectorized_federal_tax(taxable_income_federal)
                                                                               ^
src/services/retirement_model.py:975:80: E501 line too long (83 > 79 characters)
                    total_ordinary_taxable_gross, both_on_medicare=both_on_medicare
                                                                               ^
src/services/retirement_model.py:991:80: E501 line too long (87 > 79 characters)
                current_housing_costs += np.where(unsold_mask, prop["annual_costs"], 0)
                                                                               ^
src/services/retirement_model.py:997:80: E501 line too long (108 > 79 characters)
            # Spending strategy (constant_real, retirement_smile, conservative_decline) acts as a MULTIPLIER
                                                                               ^
src/services/retirement_model.py:1009:80: E501 line too long (106 > 79 characters)
                # This models how spending patterns change (e.g., less travel when older, more healthcare)
                                                                               ^
src/services/retirement_model.py:1012:80: E501 line too long (81 > 79 characters)
                        (target_spending - current_housing_costs) * spending_mult
                                                                               ^
src/services/retirement_model.py:1017:80: E501 line too long (83 > 79 characters)
                    self.profile.target_annual_income * current_cpi * spending_mult
                                                                               ^
src/services/retirement_model.py:1024:80: E501 line too long (100 > 79 characters)
            # During working years: income typically exceeds expenses  surplus saved to investments
                                                                               ^
src/services/retirement_model.py:1025:80: E501 line too long (104 > 79 characters)
            # During retirement: expenses typically exceed income  shortfall withdrawn from investments
                                                                               ^
src/services/retirement_model.py:1035:80: E501 line too long (98 > 79 characters)
            # When working: add salary surplus and retirement contributions to investment accounts
                                                                               ^
src/services/retirement_model.py:1051:80: E501 line too long (88 > 79 characters)
                        employment_income += current_employment.get("primary_person", 0)
                                                                               ^
src/services/retirement_model.py:1053:80: E501 line too long (80 > 79 characters)
                        employment_income += current_employment.get("spouse", 0)
                                                                               ^
src/services/retirement_model.py:1077:25: F841 local variable 'p2_salary' is assigned to but never used
                        p2_salary = current_employment.get("spouse", 0)
                        ^
src/services/retirement_model.py:1078:80: E501 line too long (94 > 79 characters)
                        # Note: Person dataclass doesn't have person2-specific 401k fields yet
                                                                               ^
src/services/retirement_model.py:1079:80: E501 line too long (91 > 79 characters)
                        # For now, use person1's fields as template - can be extended later
                                                                               ^
src/services/retirement_model.py:1082:80: E501 line too long (81 > 79 characters)
                ira_contrib = safe_float(self.profile.annual_ira_contribution, 0)
                                                                               ^
src/services/retirement_model.py:1084:80: E501 line too long (88 > 79 characters)
                    # Split between pretax and Roth based on allocation or default 50/50
                                                                               ^
src/services/retirement_model.py:1092:80: E501 line too long (80 > 79 characters)
                        "pretax": 0.50,  # 50% to pre-tax (Traditional IRA/401k)
                                                                               ^
src/services/retirement_model.py:1100:80: E501 line too long (84 > 79 characters)
                    # Note: For taxable, also increase basis since this is new money
                                                                               ^
src/services/retirement_model.py:1101:80: E501 line too long (81 > 79 characters)
                    taxable_basis += surplus * savings_alloc.get("taxable", 0.20)
                                                                               ^
src/services/retirement_model.py:1120:43: F821 undefined name 'year_ordinary_income'
                            taxable_gain, year_ordinary_income
                                          ^
src/services/retirement_model.py:1124:29: W503 line break before binary operator
                            - mortgage_payoff
                            ^
src/services/retirement_model.py:1125:29: W503 line break before binary operator
                            - transaction_costs
                            ^
src/services/retirement_model.py:1126:29: W503 line break before binary operator
                            - capital_gains_tax
                            ^
src/services/retirement_model.py:1128:80: E501 line too long (84 > 79 characters)
                        available_proceeds = net_proceeds - prop["replacement_cost"]
                                                                               ^
src/services/retirement_model.py:1134:80: E501 line too long (86 > 79 characters)
                        prop["is_sold"] = np.where(active_mask, True, prop["is_sold"])
                                                                               ^
src/services/retirement_model.py:1135:80: E501 line too long (81 > 79 characters)
                        prop["values"] = np.where(active_mask, 0, prop["values"])
                                                                               ^
src/services/retirement_model.py:1176:80: E501 line too long (80 > 79 characters)
                tax_with_rmd, _ = self._vectorized_federal_tax(taxable_with_rmd)
                                                                               ^
src/services/retirement_model.py:1177:80: E501 line too long (86 > 79 characters)
                tax_without_rmd, _ = self._vectorized_federal_tax(taxable_without_rmd)
                                                                               ^
src/services/retirement_model.py:1200:80: E501 line too long (91 > 79 characters)
            # 2. 457b (Special case: No early withdrawal penalty if separated from service)
                                                                               ^
src/services/retirement_model.py:1204:80: E501 line too long (86 > 79 characters)
                taxable_now = np.maximum(0, cumulative_ordinary_gross - std_deduction)
                                                                               ^
src/services/retirement_model.py:1215:80: E501 line too long (81 > 79 characters)
                        0, cumulative_ordinary_gross + withdrawal - std_deduction
                                                                               ^
src/services/retirement_model.py:1222:80: E501 line too long (81 > 79 characters)
                net_withdrawal = withdrawal - (actual_fed_tax + actual_state_tax)
                                                                               ^
src/services/retirement_model.py:1226:80: E501 line too long (85 > 79 characters)
            # 3. Taxable Brokerage (Pay capital gains tax stacked on ordinary income)
                                                                               ^
src/services/retirement_model.py:1229:80: E501 line too long (95 > 79 characters)
                # Use large floor value to prevent numerical instability when account near zero
                                                                               ^
src/services/retirement_model.py:1231:80: E501 line too long (82 > 79 characters)
                denom = np.where(taxable_val > STABILITY_FLOOR, taxable_val, 1e10)
                                                                               ^
src/services/retirement_model.py:1232:80: E501 line too long (81 > 79 characters)
                gain_ratio = np.maximum(0, (taxable_val - taxable_basis) / denom)
                                                                               ^
src/services/retirement_model.py:1233:80: E501 line too long (83 > 79 characters)
                gain_ratio = np.where(taxable_val > STABILITY_FLOOR, gain_ratio, 0)
                                                                               ^
src/services/retirement_model.py:1247:80: E501 line too long (87 > 79 characters)
                basis_ratio = np.where(taxable_val > 0, taxable_basis / taxable_val, 0)
                                                                               ^
src/services/retirement_model.py:1254:80: E501 line too long (80 > 79 characters)
            # 4. Pre-Tax (Traditional IRA/401k) - Subject to Ordinary Income Tax
                                                                               ^
src/services/retirement_model.py:1257:80: E501 line too long (80 > 79 characters)
                # Apply 10% penalty if under 59.5 (excluding 457b handled above)
                                                                               ^
src/services/retirement_model.py:1261:80: E501 line too long (86 > 79 characters)
                taxable_now = np.maximum(0, cumulative_ordinary_gross - std_deduction)
                                                                               ^
src/services/retirement_model.py:1263:80: E501 line too long (81 > 79 characters)
                eff_rate = np.maximum(0.10, marginal_rate) + state_rate + penalty
                                                                               ^
src/services/retirement_model.py:1272:80: E501 line too long (81 > 79 characters)
                        0, cumulative_ordinary_gross + withdrawal - std_deduction
                                                                               ^
src/services/retirement_model.py:1276:80: E501 line too long (82 > 79 characters)
                actual_fed_tax = (tax_after - tax_before) + (withdrawal * penalty)
                                                                               ^
src/services/retirement_model.py:1279:80: E501 line too long (81 > 79 characters)
                net_withdrawal = withdrawal - (actual_fed_tax + actual_state_tax)
                                                                               ^
src/services/retirement_model.py:1283:80: E501 line too long (80 > 79 characters)
            # 5. Roth Assets (Tax-free, last resort to preserve tax-free growth)
                                                                               ^
src/services/retirement_model.py:1299:80: E501 line too long (82 > 79 characters)
                year_returns > 0, year_returns * (1 - TAX_DRAG_RATE), year_returns
                                                                               ^
src/services/retirement_model.py:1312:80: E501 line too long (83 > 79 characters)
                apprec_vec = np.random.normal(apprec_mean, apprec_std, simulations)
                                                                               ^
src/services/retirement_model.py:1320:80: E501 line too long (81 > 79 characters)
            total_portfolio = cash + taxable_val + pretax_std + pretax_457 + roth
                                                                               ^
src/services/retirement_model.py:1342:17: W503 line break before binary operator
                + start_taxable_val
                ^
src/services/retirement_model.py:1343:17: W503 line break before binary operator
                + start_pretax_std
                ^
src/services/retirement_model.py:1344:17: W503 line break before binary operator
                + start_pretax_457
                ^
src/services/retirement_model.py:1345:17: W503 line break before binary operator
                + start_roth
                ^
src/services/retirement_model.py:1352:80: E501 line too long (83 > 79 characters)
                "years": list(range(self.current_year, self.current_year + years)),
                                                                               ^
src/services/retirement_model.py:1368:80: E501 line too long (93 > 79 characters)
        """
        Run a SINGLE deterministic projection to capture granular details like tax breakdown.
        Used for the Cashflow visualization to show exactly where money goes.
        """
           
                                                                   ^
src/services/retirement_model.py:1426:9: F841 local variable 'base_ss' is assigned to but never used
        base_ss = (
        ^
src/services/retirement_model.py:1427:80: E501 line too long (87 > 79 characters)
            self.profile.person1.social_security + self.profile.person2.social_security
                                                                               ^
src/services/retirement_model.py:1453:80: E501 line too long (84 > 79 characters)
                            "inflation_adjusted": s.get("inflation_adjusted", True),
                                                                               ^
src/services/retirement_model.py:1457:17: E722 do not use bare 'except'
                except:
                ^
src/services/retirement_model.py:1468:21: W503 line break before binary operator
                    + safe_float(prop.get("annual_insurance", 0))
                    ^
src/services/retirement_model.py:1469:21: W503 line break before binary operator
                    + safe_float(prop.get("annual_maintenance", 0))
                    ^
src/services/retirement_model.py:1470:21: W503 line break before binary operator
                    + safe_float(prop.get("annual_hoa", 0))
                    ^
src/services/retirement_model.py:1478:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/retirement_model.py:1487:80: E501 line too long (87 > 79 characters)
                            prop.get("appreciation_rate") or assumptions.inflation_mean
                                                                               ^
src/services/retirement_model.py:1493:80: E501 line too long (88 > 79 characters)
                        "property_type": prop.get("property_type", "Primary Residence"),
                                                                               ^
src/services/retirement_model.py:1517:80: E501 line too long (81 > 79 characters)
            p1_ss_eligible = p1_age_start >= self.profile.person1.ss_claiming_age
                                                                               ^
src/services/retirement_model.py:1518:80: E501 line too long (81 > 79 characters)
            p2_ss_eligible = p2_age_start >= self.profile.person2.ss_claiming_age
                                                                               ^
src/services/retirement_model.py:1521:80: E501 line too long (84 > 79 characters)
                (self.profile.person1.social_security * 12 if p1_ss_eligible else 0)
                                                                               ^
src/services/retirement_model.py:1522:17: W503 line break before binary operator
                + (self.profile.person2.social_security * 12 if p2_ss_eligible else 0)
                ^
src/services/retirement_model.py:1522:80: E501 line too long (86 > 79 characters)
                + (self.profile.person2.social_security * 12 if p2_ss_eligible else 0)
                                                                               ^
src/services/retirement_model.py:1525:80: E501 line too long (85 > 79 characters)
            active_pension_annual = (base_pension if p1_retired else 0) * current_cpi
                                                                               ^
src/services/retirement_model.py:1553:80: E501 line too long (82 > 79 characters)
                active_pension_annual + other_taxable_annual + other_budget_annual
                                                                               ^
src/services/retirement_model.py:1558:80: E501 line too long (81 > 79 characters)
                total_employment_annual + total_other_ord_annual, gross_ss_annual
                                                                               ^
src/services/retirement_model.py:1561:80: E501 line too long (84 > 79 characters)
                total_employment_annual + total_other_ord_annual + taxable_ss_annual
                                                                               ^
src/services/retirement_model.py:1570:80: E501 line too long (80 > 79 characters)
                0.0585 if getattr(self.profile, "state", "NY") == "NY" else 0.05
                                                                               ^
src/services/retirement_model.py:1583:80: E501 line too long (80 > 79 characters)
            # Track cumulative ordinary income for stacking withdrawals (ANNUAL)
                                                                               ^
src/services/retirement_model.py:1606:25: W503 line break before binary operator
                        / 12
                        ^
src/services/retirement_model.py:1626:25: W503 line break before binary operator
                        / 12
                        ^
src/services/retirement_model.py:1630:80: E501 line too long (87 > 79 characters)
                        self.profile.target_annual_income * current_cpi * spending_mult
                                                                               ^
src/services/retirement_model.py:1636:80: E501 line too long (84 > 79 characters)
                m_available_cash = (m_ord_taxable + (m_gross_ss - m_taxable_ss)) - (
                                                                               ^
src/services/retirement_model.py:1639:80: E501 line too long (81 > 79 characters)
                m_shortfall = np.maximum(0, m_target_spending - m_available_cash)
                                                                               ^
src/services/retirement_model.py:1661:80: E501 line too long (84 > 79 characters)
                        _, marginal_rate = self._vectorized_federal_tax(taxable_now)
                                                                               ^
src/services/retirement_model.py:1664:80: E501 line too long (83 > 79 characters)
                        gross_needed = m_shortfall / np.maximum(0.01, 1 - eff_rate)
                                                                               ^
src/services/retirement_model.py:1671:80: E501 line too long (87 > 79 characters)
                                0, cumulative_ordinary_gross + (w * 12) - std_deduction
                                                                               ^
src/services/retirement_model.py:1674:80: E501 line too long (81 > 79 characters)
                        tax_before, _ = self._vectorized_federal_tax(taxable_now)
                                                                               ^
src/services/retirement_model.py:1701:80: E501 line too long (87 > 79 characters)
                        gross_needed = m_shortfall / np.maximum(0.01, 1 - est_tax_rate)
                                                                               ^
src/services/retirement_model.py:1710:29: W503 line break before binary operator
                            / 12
                            ^
src/services/retirement_model.py:1731:80: E501 line too long (84 > 79 characters)
                        _, marginal_rate = self._vectorized_federal_tax(taxable_now)
                                                                               ^
src/services/retirement_model.py:1733:80: E501 line too long (82 > 79 characters)
                            np.maximum(0.10, marginal_rate) + state_rate + penalty
                                                                               ^
src/services/retirement_model.py:1736:80: E501 line too long (83 > 79 characters)
                        gross_needed = m_shortfall / np.maximum(0.01, 1 - eff_rate)
                                                                               ^
src/services/retirement_model.py:1743:80: E501 line too long (87 > 79 characters)
                                0, cumulative_ordinary_gross + (w * 12) - std_deduction
                                                                               ^
src/services/retirement_model.py:1746:80: E501 line too long (81 > 79 characters)
                        tax_before, _ = self._vectorized_federal_tax(taxable_now)
                                                                               ^
src/services/retirement_model.py:1748:80: E501 line too long (88 > 79 characters)
                        w_fed_tax = ((tax_after - tax_before) + (w * 12 * penalty)) / 12
                                                                               ^
src/services/retirement_model.py:1768:80: E501 line too long (80 > 79 characters)
                    assumptions.stock_allocation * assumptions.stock_return_mean
                                                                               ^
src/services/retirement_model.py:1769:21: W503 line break before binary operator
                    + assumptions.bond_allocation * assumptions.bond_return_mean
                    ^
src/services/retirement_model.py:1769:80: E501 line too long (80 > 79 characters)
                    + assumptions.bond_allocation * assumptions.bond_return_mean
                                                                               ^
src/services/retirement_model.py:1770:21: W503 line break before binary operator
                    + assumptions.cash_allocation * assumptions.cash_return_mean
                    ^
src/services/retirement_model.py:1770:80: E501 line too long (80 > 79 characters)
                    + assumptions.cash_allocation * assumptions.cash_return_mean
                                                                               ^
src/services/retirement_model.py:1771:21: W503 line break before binary operator
                    + assumptions.reit_allocation * assumptions.reit_return_mean
                    ^
src/services/retirement_model.py:1771:80: E501 line too long (80 > 79 characters)
                    + assumptions.reit_allocation * assumptions.reit_return_mean
                                                                               ^
src/services/retirement_model.py:1772:21: W503 line break before binary operator
                    + assumptions.gold_allocation * assumptions.gold_return_mean
                    ^
src/services/retirement_model.py:1772:80: E501 line too long (80 > 79 characters)
                    + assumptions.gold_allocation * assumptions.gold_return_mean
                                                                               ^
src/services/retirement_model.py:1773:21: W503 line break before binary operator
                    + assumptions.crypto_allocation * assumptions.crypto_return_mean
                    ^
src/services/retirement_model.py:1773:80: E501 line too long (84 > 79 characters)
                    + assumptions.crypto_allocation * assumptions.crypto_return_mean
                                                                               ^
src/services/retirement_model.py:1790:33: W503 line break before binary operator
                                + (m_gross_ss - m_taxable_ss)
                                ^
src/services/retirement_model.py:1791:33: W503 line break before binary operator
                                + m_withdrawals
                                ^
src/services/retirement_model.py:1796:33: W503 line break before binary operator
                                + (m_gross_ss - m_taxable_ss)
                                ^
src/services/retirement_model.py:1797:33: W503 line break before binary operator
                                + m_withdrawals
                                ^
src/services/retirement_model.py:1826:80: E501 line too long (88 > 79 characters)
                            (cash + taxable_val + pretax_std + pretax_457 + roth).item()
                                                                               ^
src/services/retirement_model.py:1828:80: E501 line too long (86 > 79 characters)
                            else (cash + taxable_val + pretax_std + pretax_457 + roth)
                                                                               ^
src/services/retirement_model.py:1866:80: E501 line too long (88 > 79 characters)
        """Optimize Social Security claiming strategy with configurable discount rate"""
                                                                               ^
src/services/retirement_model.py:1902:80: E501 line too long (88 > 79 characters)
        return sorted(strategies, key=lambda x: x["lifetime_benefit_npv"], reverse=True)
                                                                               ^
src/services/retirement_model.py:1910:80: E501 line too long (84 > 79 characters)
        # Use target annual income as a proxy for retirement taxable income baseline
                                                                               ^
src/services/retirement_model.py:1912:9: F841 local variable 'current_income' is assigned to but never used
        current_income = self.profile.target_annual_income
        ^
src/services/retirement_model.py:1923:17: E722 do not use bare 'except'
                except:
                ^
src/services/retirement_model.py:1927:13: W503 line break before binary operator
            + self.profile.person2.social_security * 12
            ^
src/services/retirement_model.py:1928:13: W503 line break before binary operator
            + pension_annual
            ^
src/services/retirement_model.py:1957:80: E501 line too long (123 > 79 characters)
                "recommendation": f"Convert ${annual_conversion_12:,.0f}/year in 12% bracket for {conversion_years} years",
                                                                               ^
src/services/retirement_model.py:1975:13: W503 line break before binary operator
            + self.profile.traditional_ira
            ^
src/services/retirement_model.py:1976:13: W503 line break before binary operator
            + self.profile.roth_ira
            ^
src/services/retirement_model.py:1985:80: E501 line too long (80 > 79 characters)
                (total_lifetime_gifts / net_worth * 100) if net_worth > 0 else 0
                                                                               ^
src/services/retirement_model.py:1987:80: E501 line too long (133 > 79 characters)
            "recommendation": f"Gift ${total_annual_gifts:,.0f}/year (${annual_gift_per_child:,.0f} per child) starting immediately",
                                                                               ^
src/services/retirement_model.py:2000:80: E501 line too long (83 > 79 characters)
    def _is_expense_active(self, expense_data: dict, simulation_year: int) -> bool:
                                                                               ^
src/services/retirement_model.py:2016:13: E722 do not use bare 'except'
            except:
            ^
src/services/retirement_model.py:2027:13: E722 do not use bare 'except'
            except:
            ^
src/services/retirement_model.py:2045:80: E501 line too long (86 > 79 characters)
        """Calculate total income from budget categories for a given year (Vectorized)
        Returns: (total_income, employment_income)
        """
                                                                               ^
src/services/retirement_model.py:2056:80: E501 line too long (84 > 79 characters)
        current_employment = income_section.get("current", {}).get("employment", {})
                                                                               ^
src/services/retirement_model.py:2084:80: E501 line too long (84 > 79 characters)
                        start_year = datetime.fromisoformat(item["start_date"]).year
                                                                               ^
src/services/retirement_model.py:2093:80: E501 line too long (80 > 79 characters)
                                item["amount"], item.get("frequency", "monthly")
                                                                               ^
src/services/retirement_model.py:2099:21: E722 do not use bare 'except'
                    except:
                    ^
src/services/retirement_model.py:2124:80: E501 line too long (91 > 79 characters)
        """Calculate total expenses from budget categories for a given year (Vectorized)"""
                                                                               ^
src/services/retirement_model.py:2157:80: E501 line too long (80 > 79 characters)
                        if isinstance(cat_data, dict) and cat_data.get("amount")
                                                                               ^
src/services/retirement_model.py:2185:80: E501 line too long (88 > 79 characters)
                sum(current_map.values()) if current_map else np.zeros_like(current_cpi)
                                                                               ^
src/services/retirement_model.py:2192:80: E501 line too long (86 > 79 characters)
                sum(future_map.values()) if future_map else np.zeros_like(current_cpi)
                                                                               ^
src/services/selective_backup_service.py:6:1: F401 'os' imported but unused
import os
^
src/services/selective_backup_service.py:12:1: F401 'src.auth.models.User' imported but unused
from src.auth.models import User
^
src/services/selective_backup_service.py:13:1: F401 'src.models.group.Group' imported but unused
from src.models.group import Group
^
src/services/selective_backup_service.py:70:80: E501 line too long (113 > 79 characters)
        rows = db.execute("""
            SELECT
                g.id, g.name, g.description,
                (SELECT COUNT(DISTINCT ug.user_id) FROM user_groups ug WHERE ug.group_id = g.id) as member_count,
                (SELECT COUNT(DISTINCT p.id) FROM profile p
                 JOIN user_groups ug ON p.user_id = ug.user_id
                 WHERE ug.group_id = g.id) as profile_count
            FROM groups g
            ORDER BY g.name
        """)
                             
                  
                              ^
src/services/selective_backup_service.py:91:80: E501 line too long (100 > 79 characters)
        """
        Create a backup of selected profiles.

        Args:
            profile_ids: List of profile IDs to backup
            group_ids: List of group IDs (all profiles from users in these groups will be backed up)
            label: Optional label for the backup
            created_by: User ID of admin creating the backup
        """
           
                                             

             
      ^
src/services/selective_backup_service.py:153:80: E501 line too long (80 > 79 characters)
                "SELECT id, username, email FROM users WHERE id = ?", (user_id,)
                                                                               ^
src/services/selective_backup_service.py:169:80: E501 line too long (80 > 79 characters)
                "SELECT * FROM action_items WHERE profile_id = ?", (profile_id,)
                                                                               ^
src/services/selective_backup_service.py:177:80: E501 line too long (81 > 79 characters)
                "SELECT * FROM conversations WHERE profile_id = ?", (profile_id,)
                                                                               ^
src/services/selective_backup_service.py:186:80: E501 line too long (80 > 79 characters)
                "".join(c for c in label if c.isalnum() or c in (" ", "_", "-"))
                                                                               ^
src/services/selective_backup_service.py:217:80: E501 line too long (85 > 79 characters)
        for backup_file in sorted(backup_dir.glob("selective_*.json"), reverse=True):
                                                                               ^
src/services/selective_backup_service.py:235:80: E501 line too long (83 > 79 characters)
                            datetime.fromtimestamp(stat_info.st_mtime).isoformat(),
                                                                               ^
src/services/selective_backup_service.py:263:80: E501 line too long (82 > 79 characters)
            user_info = data.get("users", {}).get(str(profile.get("user_id")), {})
                                                                               ^
src/services/selective_backup_service.py:265:80: E501 line too long (81 > 79 characters)
                user_info = data.get("users", {}).get(profile.get("user_id"), {})
                                                                               ^
src/services/selective_backup_service.py:295:80: E501 line too long (87 > 79 characters)
        """
        Restore profiles from a selective backup.

        Args:
            filename: Name of the backup file
            profile_ids: Optional list of profile IDs to restore (restores all if None)
            restore_mode: 'merge' (add/update) or 'replace' (delete existing first)
        """
           
                                                 

             
  ^
src/services/selective_backup_service.py:296:80: E501 line too long (83 > 79 characters)
        """
        Restore profiles from a selective backup.

        Args:
            filename: Name of the backup file
            profile_ids: Optional list of profile IDs to restore (restores all if None)
            restore_mode: 'merge' (add/update) or 'replace' (delete existing first)
        """
           
                                                 

             
  ^
src/services/selective_backup_service.py:347:80: E501 line too long (80 > 79 characters)
                                "DELETE FROM action_items WHERE profile_id = ?",
                                                                               ^
src/services/selective_backup_service.py:351:80: E501 line too long (81 > 79 characters)
                                "DELETE FROM conversations WHERE profile_id = ?",
                                                                               ^
src/services/selective_backup_service.py:360:80: E501 line too long (82 > 79 characters)
                                """
                                UPDATE profile
                                SET name = ?, birth_date = ?, retirement_date = ?,
                                    data = ?, data_iv = ?, updated_at = ?
                                WHERE id = ?
                            """,
                                   
                                           ^
src/services/selective_backup_service.py:381:80: E501 line too long (82 > 79 characters)
                                """
                                UPDATE profile
                                SET name = ?, birth_date = ?, retirement_date = ?,
                                    data = ?, data_iv = ?, updated_at = ?
                                WHERE id = ?
                            """,
                                   
                                           ^
src/services/selective_backup_service.py:400:80: E501 line too long (96 > 79 characters)
                            """
                            INSERT INTO profile (id, user_id, name, birth_date, retirement_date,
                                                data, data_iv, created_at, updated_at)
                            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
                        """,
                               
                                               ^
src/services/selective_backup_service.py:401:80: E501 line too long (86 > 79 characters)
                            """
                            INSERT INTO profile (id, user_id, name, birth_date, retirement_date,
                                                data, data_iv, created_at, updated_at)
                            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
                        """,
                               
                                               ^
src/services/selective_backup_service.py:412:80: E501 line too long (86 > 79 characters)
                                profile.get("created_at", datetime.now().isoformat()),
                                                                               ^
src/services/selective_backup_service.py:433:80: E501 line too long (82 > 79 characters)
                            if not existing_scenario or restore_mode == "replace":
                                                                               ^
src/services/selective_backup_service.py:443:80: E501 line too long (118 > 79 characters)
                                    f"INSERT OR REPLACE INTO scenarios ({', '.join(fields)}) VALUES ({placeholders})",
                                                                               ^
src/services/selective_backup_service.py:466:80: E501 line too long (121 > 79 characters)
                                    f"INSERT OR REPLACE INTO action_items ({', '.join(fields)}) VALUES ({placeholders})",
                                                                               ^
src/services/selective_backup_service.py:489:80: E501 line too long (122 > 79 characters)
                                    f"INSERT OR REPLACE INTO conversations ({', '.join(fields)}) VALUES ({placeholders})",
                                                                               ^
src/services/tax_optimization_service.py:15:1: F401 'typing.Optional' imported but unused
from typing import Dict, List, Optional, Tuple
^
src/services/tax_optimization_service.py:16:1: F401 'datetime.datetime' imported but unused
from datetime import datetime, date
^
src/services/tax_optimization_service.py:16:1: F401 'datetime.date' imported but unused
from datetime import datetime, date
^
src/services/tax_optimization_service.py:17:1: F401 'math' imported but unused
import math
^
src/services/tax_optimization_service.py:112:80: E501 line too long (92 > 79 characters)
# Social Security Taxation Thresholds (Combined Income = AGI + 50% SS + Tax-exempt interest)
                                                                               ^
src/services/tax_optimization_service.py:280:80: E501 line too long (83 > 79 characters)
    def get_standard_deduction(self, age: int = 65, spouse_age: int = 65) -> float:
                                                                               ^
src/services/tax_optimization_service.py:346:80: E501 line too long (88 > 79 characters)
    def calculate_ltcg_tax(self, capital_gains: float, ordinary_income: float) -> float:
                                                                               ^
src/services/tax_optimization_service.py:366:80: E501 line too long (82 > 79 characters)
                gains_in_bracket = min(capital_gains, bracket_end - bracket_start)
                                                                               ^
src/services/tax_optimization_service.py:411:80: E501 line too long (82 > 79 characters)
            base_taxable = (threshold_2 - threshold_1) * 0.5  # 50% of middle tier
                                                                               ^
src/services/tax_optimization_service.py:423:80: E501 line too long (84 > 79 characters)
        self, full_retirement_age: int, pia_at_fra: float, life_expectancy: int = 90
                                                                               ^
src/services/tax_optimization_service.py:447:80: E501 line too long (83 > 79 characters)
                        36 * (5 / 9) * 0.01 + (months_early - 36) * (5 / 12) * 0.01
                                                                               ^
src/services/tax_optimization_service.py:468:80: E501 line too long (85 > 79 characters)
                    "vs_fra_pct": round((monthly_benefit / pia_at_fra - 1) * 100, 1),
                                                                               ^
src/services/tax_optimization_service.py:478:80: E501 line too long (88 > 79 characters)
                    monthly_diff = analysis["monthly_benefit"] - prev["monthly_benefit"]
                                                                               ^
src/services/tax_optimization_service.py:480:80: E501 line too long (81 > 79 characters)
                    lost_benefits = prev["annual_benefit"]  # One year of waiting
                                                                               ^
src/services/tax_optimization_service.py:492:80: E501 line too long (81 > 79 characters)
    """Calculates IRMAA (Income-Related Monthly Adjustment Amount) surcharges."""
                                                                               ^
src/services/tax_optimization_service.py:524:80: E501 line too long (83 > 79 characters)
                    "room_to_next": upper - magi if upper < float("inf") else None,
                                                                               ^
src/services/tax_optimization_service.py:534:80: E501 line too long (83 > 79 characters)
                    "room_to_next": upper - magi if upper < float("inf") else None,
                                                                               ^
src/services/tax_optimization_service.py:548:80: E501 line too long (83 > 79 characters)
    def calculate_bracket_space(self, current_taxable_income: float) -> List[Dict]:
                                                                               ^
src/services/tax_optimization_service.py:583:80: E501 line too long (81 > 79 characters)
        current_tax, _, current_marginal = self.calculator.calculate_federal_tax(
                                                                               ^
src/services/tax_optimization_service.py:589:80: E501 line too long (81 > 79 characters)
        new_tax, breakdown, new_marginal = self.calculator.calculate_federal_tax(
                                                                               ^
src/services/tax_optimization_service.py:619:80: E501 line too long (81 > 79 characters)
            "traditional_balance_after": traditional_balance - conversion_amount,
                                                                               ^
src/services/tax_optimization_service.py:631:80: E501 line too long (80 > 79 characters)
        """
        Find optimal Roth conversion amount to stay within target marginal rate.

        Args:
            current_taxable_income: Current taxable income before conversion
            traditional_balance: Balance available for conversion
            max_rate: Maximum marginal rate willing to pay (default 24%)

        Returns:
            Optimal conversion analysis
        """
           
                                                                   ^
src/services/tax_optimization_service.py:691:80: E501 line too long (97 > 79 characters)
                "message": f"RMDs begin at age 73. You have {73 - age} years before RMDs start.",
                                                                               ^
src/services/tax_optimization_service.py:694:80: E501 line too long (82 > 79 characters)
        divisor = RMD_UNIFORM_TABLE.get(age, 2.0)  # Default to 2.0 for ages > 120
                                                                               ^
src/services/tax_optimization_service.py:779:80: E501 line too long (87 > 79 characters)
        self.roth_optimizer = RothConversionOptimizer(self.calculator, self.irmaa_calc)
                                                                               ^
src/services/tax_optimization_service.py:820:80: E501 line too long (84 > 79 characters)
        ltcg_tax = self.calculator.calculate_ltcg_tax(capital_gains, taxable_income)
                                                                               ^
src/services/tax_optimization_service.py:823:80: E501 line too long (87 > 79 characters)
        state_tax = self.calculator.calculate_state_tax(taxable_income + capital_gains)
                                                                               ^
src/services/tax_optimization_service.py:825:80: E501 line too long (80 > 79 characters)
        # IRMAA - Use MAGI (AGI + tax-exempt interest + excluded foreign income)
                                                                               ^
src/services/tax_optimization_service.py:826:80: E501 line too long (99 > 79 characters)
        # For most retirees, MAGI  AGI since they don't have tax-exempt interest or foreign income
                                                                               ^
src/services/tax_optimization_service.py:827:80: E501 line too long (98 > 79 characters)
        # IMPORTANT: Use taxable_ss (not total SS) since AGI already includes only taxable portion
                                                                               ^
src/services/tax_optimization_service.py:828:80: E501 line too long (86 > 79 characters)
        magi = agi + capital_gains  # AGI already includes taxable SS and other income
                                                                               ^
src/services/tax_optimization_service.py:829:80: E501 line too long (86 > 79 characters)
        irmaa_surcharge, irmaa_tier, irmaa_info = self.irmaa_calc.calculate_surcharge(
                                                                               ^
src/services/tax_optimization_service.py:838:80: E501 line too long (84 > 79 characters)
        effective_rate = (total_tax / total_income) * 100 if total_income > 0 else 0
                                                                               ^
src/services/tax_optimization_service.py:850:80: E501 line too long (81 > 79 characters)
                    "itemized" if deductions > standard_deduction else "standard"
                                                                               ^
src/services/tax_optimization_service.py:920:80: E501 line too long (84 > 79 characters)
            "recommendation": self._get_roth_recommendation(optimal, bracket_space),
                                                                               ^
src/services/tax_optimization_service.py:943:80: E501 line too long (83 > 79 characters)
            (a for a in analyses if a["claiming_age"] == full_retirement_age), None
                                                                               ^
src/services/tax_optimization_service.py:971:80: E501 line too long (87 > 79 characters)
        projections = RMDCalculator.project_rmds(age, traditional_balance, growth_rate)
                                                                               ^
src/services/tax_optimization_service.py:1007:80: E501 line too long (82 > 79 characters)
        current_tax = taxable_income * STATE_TAX_RATES.get(self.settings.state, 0)
                                                                               ^
src/services/tax_optimization_service.py:1009:80: E501 line too long (86 > 79 characters)
            comp["savings_vs_current"] = round(current_tax - comp["estimated_tax"], 2)
                                                                               ^
src/services/tax_optimization_service.py:1020:9: F841 local variable 'tax_settings' is assigned to but never used
        tax_settings = profile_data.get("tax_settings", {})
        ^
src/services/tax_optimization_service.py:1024:80: E501 line too long (89 > 79 characters)
        # Get income components - try financial first, then calculate from income_streams
                                                                               ^
src/services/tax_optimization_service.py:1044:80: E501 line too long (92 > 79 characters)
        # Get Social Security - combine primary from financial and spouse from spouse object
                                                                               ^
src/services/tax_optimization_service.py:1047:80: E501 line too long (81 > 79 characters)
            (spouse.get("social_security_benefit", 0) or 0) * 12 if spouse else 0
                                                                               ^
src/services/tax_optimization_service.py:1060:80: E501 line too long (89 > 79 characters)
        # The route already resolved these from address/tax_settings with proper fallback
                                                                               ^
src/services/tax_optimization_service.py:1061:80: E501 line too long (87 > 79 characters)
        # and passed them to __init__, so just use the already-configured self.settings
                                                                               ^
src/services/tax_optimization_service.py:1063:80: E501 line too long (89 > 79 characters)
        # Get age for RMD calculations (use from self.settings which was set in __init__)
                                                                               ^
src/services/tax_optimization_service.py:1065:9: F841 local variable 'spouse_age' is assigned to but never used
        spouse_age = self.settings.spouse_age
        ^
src/services/tax_optimization_service.py:1072:13: W503 line break before binary operator
            or "401k" in a.get("type", "").lower()
            ^
src/services/tax_optimization_service.py:1092:80: E501 line too long (85 > 79 characters)
        state_comparison = self.compare_states(snapshot["summary"]["taxable_income"])
                                                                               ^
src/services/tax_optimization_service.py:1107:80: E501 line too long (88 > 79 characters)
    def _get_roth_recommendation(self, optimal: Dict, bracket_space: List[Dict]) -> str:
                                                                               ^
src/services/tax_optimization_service.py:1110:80: E501 line too long (133 > 79 characters)
            return "You're already at your target marginal rate. Consider conversions only if you expect higher rates in the future."
                                                                               ^
src/services/tax_optimization_service.py:1115:80: E501 line too long (136 > 79 characters)
        return f"Consider converting ${amount:,.0f} to stay within the {rate:.0f}% bracket. Tax cost: ${optimal['conversion_tax']:,.0f}"
                                                                               ^
src/services/tax_optimization_service.py:1122:80: E501 line too long (87 > 79 characters)
            return "You should be claiming Social Security now if you haven't already."
                                                                               ^
src/services/tax_optimization_service.py:1128:80: E501 line too long (145 > 79 characters)
            return f"With life expectancy of {life_expectancy}, delaying to age {claim_age} maximizes lifetime benefits (${benefit:,.0f}/month)."
                                                                               ^
src/services/tax_optimization_service.py:1130:20: F541 f-string is missing placeholders
            return f"Consider your health and financial needs. Earlier claiming may be appropriate if concerned about longevity."
                   ^
src/services/tax_optimization_service.py:1130:80: E501 line too long (129 > 79 characters)
            return f"Consider your health and financial needs. Earlier claiming may be appropriate if concerned about longevity."
                                                                               ^
src/services/tax_optimization_service.py:1136:80: E501 line too long (142 > 79 characters)
            return f"Consider Roth conversions during the next {years_until} years before RMDs begin to reduce future required distributions."
                                                                               ^
src/services/tax_optimization_service.py:1140:80: E501 line too long (133 > 79 characters)
            return f"Your RMD is ${amount:,.0f}. Consider using QCDs (up to $105,000) to satisfy RMDs while reducing taxable income."
                                                                               ^
src/services/tax_optimization_service.py:1142:80: E501 line too long (97 > 79 characters)
        return f"Your required RMD is ${amount:,.0f}. Ensure this is withdrawn by December 31st."
                                                                               ^
src/services/tax_optimization_service.py:1157:80: E501 line too long (126 > 79 characters)
                    "description": f"Convert ${roth['optimal_24pct']['conversion_amount']:,.0f} from Traditional to Roth IRA",
                                                                               ^
src/services/tax_optimization_service.py:1158:80: E501 line too long (170 > 79 characters)
                    "impact": f"Tax cost: ${roth['optimal_24pct']['conversion_tax']:,.0f} at {roth['optimal_24pct']['effective_rate_on_conversion']:.1f}% effective rate",
                                                                               ^
src/services/tax_optimization_service.py:1171:80: E501 line too long (105 > 79 characters)
                    "description": f"You're ${irmaa['room_to_next']:,.0f} away from the next IRMAA tier",
                                                                               ^
src/services/tax_optimization_service.py:1172:80: E501 line too long (82 > 79 characters)
                    "impact": "Could increase Medicare premiums by ~$1,000+/year",
                                                                               ^
src/services/tax_optimization_service.py:1178:80: E501 line too long (85 > 79 characters)
        if not rmd["current"]["required"] and rmd["summary"]["years_until_rmd"] <= 8:
                                                                               ^
src/services/tax_optimization_service.py:1184:80: E501 line too long (97 > 79 characters)
                    "description": f"{rmd['summary']['years_until_rmd']} years until RMDs begin",
                                                                               ^
src/services/tax_optimization_service.py:1185:80: E501 line too long (91 > 79 characters)
                    "impact": "Opportunity to reduce future RMDs through Roth conversions",
                                                                               ^
src/services/tax_optimization_service.py:1186:80: E501 line too long (89 > 79 characters)
                    "action": "Maximize conversions in lower brackets before RMDs start",
                                                                               ^
src/services/tax_optimization_service.py:1197:80: E501 line too long (99 > 79 characters)
                    "description": f"Use QCDs to satisfy ${rmd['current']['rmd_amount']:,.0f} RMD",
                                                                               ^
src/services/tax_optimization_service.py:1198:80: E501 line too long (88 > 79 characters)
                    "impact": "Reduce taxable income while fulfilling charitable goals",
                                                                               ^
src/services/tax_optimization_service.py:1199:80: E501 line too long (83 > 79 characters)
                    "action": "Direct RMD to qualified charities (up to $105,000)",
                                                                               ^
src/services/tax_optimization_service.py:1207:80: E501 line too long (82 > 79 characters)
                (s["savings_vs_current"] for s in states if s["no_income_tax"]), 0
                                                                               ^
src/services/tax_optimization_service.py:1215:80: E501 line too long (113 > 79 characters)
                        "description": f"Moving to a no-income-tax state could save ${no_tax_savings:,.0f}/year",
                                                                               ^
src/services/tax_optimization_service.py:1217:80: E501 line too long (88 > 79 characters)
                        "action": "Consider if relocation aligns with retirement goals",
                                                                               ^
src/services/tax_optimization_service.py:1230:80: E501 line too long (80 > 79 characters)
                    "impact": "Consider income timing and deduction strategies",
                                                                               ^
src/services/tax_optimization_service.py:1231:80: E501 line too long (94 > 79 characters)
                    "action": "Review opportunities to defer income or accelerate deductions",
                                                                               ^
src/services/transaction_analyzer.py:11:1: F401 'typing.Tuple' imported but unused
from typing import List, Dict, Optional, Tuple
^
src/services/transaction_analyzer.py:12:1: F401 'dataclasses.asdict' imported but unused
from dataclasses import dataclass, asdict
^
src/services/transaction_analyzer.py:13:1: F401 'datetime.timedelta' imported but unused
from datetime import datetime, timedelta, date
^
src/services/transaction_analyzer.py:111:80: E501 line too long (88 > 79 characters)
AMOUNT_PATTERNS = ["amount", "transaction amount", "trans amount", "transaction_amount"]
                                                                               ^
src/services/transaction_analyzer.py:168:80: E501 line too long (98 > 79 characters)
            "Could not detect amount column(s). Need either 'amount' or 'debit'+'credit' columns."
                                                                               ^
src/services/transaction_analyzer.py:221:80: E501 line too long (89 > 79 characters)
            f"Not enough valid transactions found (minimum 3, found {len(transactions)})"
                                                                               ^
src/services/transaction_analyzer.py:315:36: E203 whitespace before ':'
            desc = desc[len(prefix) :].strip()
                                   ^
src/services/transaction_analyzer.py:324:80: E501 line too long (87 > 79 characters)
    desc = re.sub(r"\s+\d{8,}$", "", desc)  # 8+ digits to avoid removing store numbers
                                                                               ^
src/services/transaction_analyzer.py:386:80: E501 line too long (83 > 79 characters)
                    variance=round(stdev(amounts) if len(amounts) > 1 else 0.0, 2),
                                                                               ^
src/services/transaction_analyzer.py:419:80: E501 line too long (80 > 79 characters)
        amounts = [abs(t.amount) for t in group]  # Absolute values for expenses
                                                                               ^
src/services/transaction_analyzer.py:442:80: E501 line too long (83 > 79 characters)
                    variance=round(stdev(amounts) if len(amounts) > 1 else 0.0, 2),
                                                                               ^
src/services/transaction_analyzer.py:453:80: E501 line too long (85 > 79 characters)
        patterns_by_category[category].sort(key=lambda p: p.confidence, reverse=True)
                                                                               ^
src/services/transaction_analyzer.py:585:80: E501 line too long (82 > 79 characters)
    count_bonus = min(len(amounts) / 10, 0.3)  # Max 30% bonus at 10+ transactions
                                                                               ^
src/services/transaction_analyzer.py:588:80: E501 line too long (85 > 79 characters)
    confidence = amount_consistency * 0.4 + frequency_score * 0.4 + count_bonus * 0.2
                                                                               ^
src/services/transaction_analyzer.py:663:80: E501 line too long (85 > 79 characters)
        "insurance": ["INSURANCE", "GEICO", "STATE FARM", "PROGRESSIVE", "ALLSTATE"],
                                                                               ^
src/services/transaction_analyzer.py:711:21: W503 line break before binary operator
                    / max(spec_monthly, detected_monthly)
                    ^
src/services/transaction_analyzer.py:719:80: E501 line too long (81 > 79 characters)
            # If amounts are too different (>40%), require higher name similarity
                                                                               ^
src/services/transaction_analyzer.py:815:80: E501 line too long (82 > 79 characters)
    """
    Calculate simple name similarity (0-1).
    Uses word overlap approach with partial word matching and semantic similarity.
    """
       
                                           
                           ^
src/services/transaction_analyzer.py:873:80: E501 line too long (83 > 79 characters)
    semantic_bonus = 0.6 if semantic_match else 0.0  # 60% bonus for semantic match
                                                                               ^
src/services/user_backup_service.py:5:1: F401 'os' imported but unused
import os
^
src/services/user_backup_service.py:7:1: F401 'base64' imported but unused
import base64
^
src/services/user_backup_service.py:8:1: F401 'zipfile' imported but unused
import zipfile
^
src/services/user_backup_service.py:9:1: F401 'tempfile' imported but unused
import tempfile
^
src/services/user_backup_service.py:29:80: E501 line too long (83 > 79 characters)
    def create_backup(user_id: int, label: Optional[str] = None) -> Dict[str, Any]:
                                                                               ^
src/services/user_backup_service.py:32:80: E501 line too long (83 > 79 characters)
        """
        Create a backup of all data for a specific user.
        Includes profiles, scenarios, action items, conversations, and preferences.
        """
           
                                                        
          ^
src/services/user_backup_service.py:56:80: E501 line too long (84 > 79 characters)
        profiles = db.execute("SELECT * FROM profile WHERE user_id = ?", (user_id,))
                                                                               ^
src/services/user_backup_service.py:57:9: F841 local variable 'profile_map' is assigned to but never used
        profile_map = {}  # Maps old ID to new ID during restore, not used here
        ^
src/services/user_backup_service.py:63:80: E501 line too long (87 > 79 characters)
        scenarios = db.execute("SELECT * FROM scenarios WHERE user_id = ?", (user_id,))
                                                                               ^
src/services/user_backup_service.py:86:80: E501 line too long (80 > 79 characters)
                "".join(c for c in label if c.isalnum() or c in (" ", "_", "-"))
                                                                               ^
src/services/user_backup_service.py:118:39: W291 trailing whitespace
            """
            SELECT * FROM user_backups 
            WHERE user_id = ? 
            ORDER BY created_at DESC
        """,
               
                      ^
src/services/user_backup_service.py:119:30: W291 trailing whitespace
            """
            SELECT * FROM user_backups 
            WHERE user_id = ? 
            ORDER BY created_at DESC
        """,
               
             ^
src/services/user_backup_service.py:163:80: E501 line too long (80 > 79 characters)
            raise FileNotFoundError(f"Backup file {filename} not found on disk")
                                                                               ^
src/services/user_backup_service.py:174:80: E501 line too long (84 > 79 characters)
            cursor.execute("DELETE FROM action_items WHERE user_id = ?", (user_id,))
                                                                               ^
src/services/user_backup_service.py:175:80: E501 line too long (81 > 79 characters)
            cursor.execute("DELETE FROM scenarios WHERE user_id = ?", (user_id,))
                                                                               ^
src/services/user_backup_service.py:176:80: E501 line too long (85 > 79 characters)
            cursor.execute("DELETE FROM conversations WHERE user_id = ?", (user_id,))
                                                                               ^
src/services/user_backup_service.py:197:80: E501 line too long (88 > 79 characters)
                    f"INSERT INTO profile ({', '.join(fields)}) VALUES ({placeholders})"
                                                                               ^
src/services/user_backup_service.py:215:80: E501 line too long (94 > 79 characters)
                query = f"INSERT INTO scenarios ({', '.join(fields)}) VALUES ({placeholders})"
                                                                               ^
src/services/user_backup_service.py:229:80: E501 line too long (97 > 79 characters)
                query = f"INSERT INTO action_items ({', '.join(fields)}) VALUES ({placeholders})"
                                                                               ^
src/services/user_backup_service.py:243:80: E501 line too long (98 > 79 characters)
                query = f"INSERT INTO conversations ({', '.join(fields)}) VALUES ({placeholders})"
                                                                               ^
src/utils/error_sanitizer.py:52:80: E501 line too long (95 > 79 characters)
                return f"Validation failed: {'; '.join(errors[:3])} (and {len(errors)-3} more)"
                                                                               ^
src/utils/error_sanitizer.py:52:86: E226 missing whitespace around arithmetic operator
                return f"Validation failed: {'; '.join(errors[:3])} (and {len(errors)-3} more)"
                                                                                     ^
1     E203 whitespace before ':'
6     E226 missing whitespace around arithmetic operator
7     E402 module level import not at top of file
1171  E501 line too long (85 > 79 characters)
1     E712 comparison to False should be 'if cond is False:' or 'if not cond:'
34    E722 do not use bare 'except'
46    F401 'typing.Any' imported but unused
2     F541 f-string is missing placeholders
3     F811 redefinition of unused 'Profile' from line 17
2     F821 undefined name 'current_app'
28    F841 local variable 'e' is assigned to but never used
15    W291 trailing whitespace
5     W293 blank line contains whitespace
98    W503 line break before binary operator
